<!doctype html><html lang="en">
 <head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <meta content="#3c790a" name="theme-color">
  <title>Fetch Standard</title>
  <link href="https://resources.whatwg.org/standard.css" rel="stylesheet">
  <link href="https://resources.whatwg.org/bikeshed.css" rel="stylesheet">
  <link href="https://resources.whatwg.org/logo-fetch.svg" rel="icon">
  <meta content="Bikeshed 1.0.0" name="generator">
<style>/* style-syntax-highlighting */
pre.idl.highlight { color: #708090; }
        .highlight:not(.idl) { background: hsl(24, 20%, 95%); }
        code.highlight { padding: .1em; border-radius: .3em; }
        pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
        .highlight .c { color: #708090 } /* Comment */
        .highlight .k { color: #990055 } /* Keyword */
        .highlight .l { color: #000000 } /* Literal */
        .highlight .n { color: #0077aa } /* Name */
        .highlight .o { color: #999999 } /* Operator */
        .highlight .p { color: #999999 } /* Punctuation */
        .highlight .cm { color: #708090 } /* Comment.Multiline */
        .highlight .cp { color: #708090 } /* Comment.Preproc */
        .highlight .c1 { color: #708090 } /* Comment.Single */
        .highlight .cs { color: #708090 } /* Comment.Special */
        .highlight .kc { color: #990055 } /* Keyword.Constant */
        .highlight .kd { color: #990055 } /* Keyword.Declaration */
        .highlight .kn { color: #990055 } /* Keyword.Namespace */
        .highlight .kp { color: #990055 } /* Keyword.Pseudo */
        .highlight .kr { color: #990055 } /* Keyword.Reserved */
        .highlight .kt { color: #990055 } /* Keyword.Type */
        .highlight .ld { color: #000000 } /* Literal.Date */
        .highlight .m { color: #000000 } /* Literal.Number */
        .highlight .s { color: #a67f59 } /* Literal.String */
        .highlight .na { color: #0077aa } /* Name.Attribute */
        .highlight .nc { color: #0077aa } /* Name.Class */
        .highlight .no { color: #0077aa } /* Name.Constant */
        .highlight .nd { color: #0077aa } /* Name.Decorator */
        .highlight .ni { color: #0077aa } /* Name.Entity */
        .highlight .ne { color: #0077aa } /* Name.Exception */
        .highlight .nf { color: #0077aa } /* Name.Function */
        .highlight .nl { color: #0077aa } /* Name.Label */
        .highlight .nn { color: #0077aa } /* Name.Namespace */
        .highlight .py { color: #0077aa } /* Name.Property */
        .highlight .nt { color: #669900 } /* Name.Tag */
        .highlight .nv { color: #222222 } /* Name.Variable */
        .highlight .ow { color: #999999 } /* Operator.Word */
        .highlight .mb { color: #000000 } /* Literal.Number.Bin */
        .highlight .mf { color: #000000 } /* Literal.Number.Float */
        .highlight .mh { color: #000000 } /* Literal.Number.Hex */
        .highlight .mi { color: #000000 } /* Literal.Number.Integer */
        .highlight .mo { color: #000000 } /* Literal.Number.Oct */
        .highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
        .highlight .sc { color: #a67f59 } /* Literal.String.Char */
        .highlight .sd { color: #a67f59 } /* Literal.String.Doc */
        .highlight .s2 { color: #a67f59 } /* Literal.String.Double */
        .highlight .se { color: #a67f59 } /* Literal.String.Escape */
        .highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
        .highlight .si { color: #a67f59 } /* Literal.String.Interpol */
        .highlight .sx { color: #a67f59 } /* Literal.String.Other */
        .highlight .sr { color: #a67f59 } /* Literal.String.Regex */
        .highlight .s1 { color: #a67f59 } /* Literal.String.Single */
        .highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
        .highlight .vc { color: #0077aa } /* Name.Variable.Class */
        .highlight .vg { color: #0077aa } /* Name.Variable.Global */
        .highlight .vi { color: #0077aa } /* Name.Variable.Instance */
        .highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
        </style>
 <body class="h-entry status-LS">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://whatwg.org/"> <img alt="WHATWG" height="100" src="https://resources.whatwg.org/logo-fetch.svg"> </a> </p>
   <hgroup>
    <h1 class="p-name no-ref" id="title">Fetch</h1>
    <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Living Standard — Last Updated <time class="dt-updated" datetime="2016-11-01">1 November 2016</time></span></h2>
   </hgroup>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>Participate:
     <dd><span><a href="https://github.com/whatwg/fetch">GitHub whatwg/fetch</a> (<a href="https://github.com/whatwg/fetch/issues/new">file an issue</a>, <a href="https://github.com/whatwg/fetch/issues">open issues</a>)</span>
     <dd><span><a href="https://wiki.whatwg.org/wiki/IRC">IRC: #whatwg on Freenode</a></span>
     <dt>Commits:
     <dd><span><a href="https://github.com/whatwg/fetch/commits">GitHub whatwg/fetch/commits</a></span>
     <dd><span><a href="https://twitter.com/fetchstandard">@fetchstandard</a></span>
     <dt>Translation (non-normative):
     <dd><span><span title="Japanese"><a href="https://triple-underscore.github.io/Fetch-ja.html" hreflang="ja" lang="ja" rel="alternate">日本語</a></span></span>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
  <div class="p-summary" data-fill-with="abstract">
   <p>The Fetch standard defines requests, responses, and the process that binds them: fetching.</p>
  </div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#goals"><span class="secno"></span> <span class="content">Goals</span></a>
    <li><a href="#preface"><span class="secno">1</span> <span class="content">Preface</span></a>
    <li><a href="#conformance"><span class="secno">2</span> <span class="content">Conformance</span></a>
    <li>
     <a href="#infrastructure"><span class="secno">3</span> <span class="content">Infrastructure</span></a>
     <ol class="toc">
      <li>
       <a href="#http"><span class="secno">3.1</span> <span class="content">HTTP</span></a>
       <ol class="toc">
        <li><a href="#methods"><span class="secno">3.1.1</span> <span class="content">Methods</span></a>
        <li><a href="#terminology-headers"><span class="secno">3.1.2</span> <span class="content">Headers</span></a>
        <li><a href="#statuses"><span class="secno">3.1.3</span> <span class="content">Statuses</span></a>
        <li><a href="#bodies"><span class="secno">3.1.4</span> <span class="content">Bodies</span></a>
        <li><a href="#requests"><span class="secno">3.1.5</span> <span class="content">Requests</span></a>
        <li><a href="#responses"><span class="secno">3.1.6</span> <span class="content">Responses</span></a>
       </ol>
      <li><a href="#authentication-entries"><span class="secno">3.2</span> <span class="content">Authentication entries</span></a>
      <li><a href="#fetch-groups"><span class="secno">3.3</span> <span class="content">Fetch groups</span></a>
      <li><a href="#connections"><span class="secno">3.4</span> <span class="content">Connections</span></a>
      <li><a href="#port-blocking"><span class="secno">3.5</span> <span class="content">Port blocking</span></a>
      <li><a href="#should-response-to-request-be-blocked-due-to-mime-type?"><span class="secno">3.6</span> <span class="content">Should <var>response</var> to <var>request</var> be blocked due to its MIME type?</span></a>
      <li><a href="#client-hints-list"><span class="secno">3.7</span> <span class="content">Client hints list</span></a>
      <li>
       <a href="#streams"><span class="secno">3.8</span> <span class="content">Streams</span></a>
       <ol class="toc">
        <li><a href="#readablestream"><span class="secno">3.8.1</span> <span class="content">ReadableStream</span></a>
       </ol>
     </ol>
    <li>
     <a href="#http-extensions"><span class="secno">4</span> <span class="content">HTTP extensions</span></a>
     <ol class="toc">
      <li><a href="#origin-header"><span class="secno">4.1</span> <span class="content">`<code>Origin</code>` header</span></a>
      <li>
       <a href="#http-cors-protocol"><span class="secno">4.2</span> <span class="content">CORS protocol</span></a>
       <ol class="toc">
        <li><a href="#general"><span class="secno">4.2.1</span> <span class="content">General</span></a>
        <li><a href="#http-requests"><span class="secno">4.2.2</span> <span class="content">HTTP requests</span></a>
        <li><a href="#http-responses"><span class="secno">4.2.3</span> <span class="content">HTTP responses</span></a>
        <li><a href="#http-new-header-syntax"><span class="secno">4.2.4</span> <span class="content">HTTP new-header syntax</span></a>
        <li><a href="#cors-protocol-and-credentials"><span class="secno">4.2.5</span> <span class="content">CORS protocol and credentials</span></a>
        <li><a href="#cors-protocol-examples"><span class="secno">4.2.6</span> <span class="content">Examples</span></a>
       </ol>
      <li>
       <a href="#x-content-type-options-header"><span class="secno">4.3</span> <span class="content">`<code>X-Content-Type-Options</code>` header</span></a>
       <ol class="toc">
        <li><a href="#should-response-to-request-be-blocked-due-to-nosniff?"><span class="secno">4.3.1</span> <span class="content">Should <var>response</var> to <var>request</var> be blocked due to nosniff?</span></a>
       </ol>
     </ol>
    <li>
     <a href="#fetching"><span class="secno">5</span> <span class="content">Fetching</span></a>
     <ol class="toc">
      <li><a href="#main-fetch"><span class="secno">5.1</span> <span class="content">Main fetch</span></a>
      <li><a href="#basic-fetch"><span class="secno">5.2</span> <span class="content">Basic fetch</span></a>
      <li><a href="#http-fetch"><span class="secno">5.3</span> <span class="content">HTTP fetch</span></a>
      <li><a href="#http-redirect-fetch"><span class="secno">5.4</span> <span class="content">HTTP-redirect fetch</span></a>
      <li><a href="#http-network-or-cache-fetch"><span class="secno">5.5</span> <span class="content">HTTP-network-or-cache fetch</span></a>
      <li><a href="#http-network-fetch"><span class="secno">5.6</span> <span class="content">HTTP-network fetch</span></a>
      <li><a href="#cors-preflight-fetch"><span class="secno">5.7</span> <span class="content">CORS-preflight fetch</span></a>
      <li><a href="#cors-preflight-cache"><span class="secno">5.8</span> <span class="content">CORS-preflight cache</span></a>
      <li><a href="#cors-check"><span class="secno">5.9</span> <span class="content">CORS check</span></a>
     </ol>
    <li>
     <a href="#fetch-api"><span class="secno">6</span> <span class="content">Fetch API</span></a>
     <ol class="toc">
      <li><a href="#headers-class"><span class="secno">6.1</span> <span class="content">Headers class</span></a>
      <li><a href="#body-mixin"><span class="secno">6.2</span> <span class="content">Body mixin</span></a>
      <li><a href="#request-class"><span class="secno">6.3</span> <span class="content">Request class</span></a>
      <li><a href="#response-class"><span class="secno">6.4</span> <span class="content">Response class</span></a>
      <li><a href="#fetch-method"><span class="secno">6.5</span> <span class="content">Fetch method</span></a>
      <li><a href="#garbage-collection"><span class="secno">6.6</span> <span class="content">Garbage collection</span></a>
     </ol>
    <li>
     <a href="#websocket-protocol"><span class="secno">7</span> <span class="content">WebSocket protocol alterations</span></a>
     <ol class="toc">
      <li><a href="#websocket-connections"><span class="secno">7.1</span> <span class="content">Connections</span></a>
      <li><a href="#websocket-opening-handshake"><span class="secno">7.2</span> <span class="content">Opening handshake</span></a>
     </ol>
    <li>
     <a href="#background-reading"><span class="secno"></span> <span class="content">Background reading</span></a>
     <ol class="toc">
      <li><a href="#http-header-layer-division"><span class="secno"></span> <span class="content">HTTP header layer division</span></a>
      <li><a href="#atomic-http-redirect-handling"><span class="secno"></span> <span class="content">Atomic HTTP redirect handling</span></a>
      <li><a href="#basic-safe-cors-protocol-setup"><span class="secno"></span> <span class="content">Basic safe CORS protocol setup</span></a>
      <li><a href="#cors-protocol-and-http-caches"><span class="secno"></span> <span class="content">CORS protocol and HTTP caches</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#acknowledgments"><span class="secno"></span> <span class="content">Acknowledgments</span></a>
   </ol>
  </nav>
  <main>
<script async="" src="https://resources.whatwg.org/file-issue.js"></script>
<script defer="" id="head" src="https://resources.whatwg.org/dfn.js"></script>
   <h2 class="no-num short heading settled" id="goals"><span class="content">Goals</span></h2>
   <p>To unify fetching across the web platform this specification supplants a number of algorithms and
specifications: </p>
   <ul class="brief no-backref">
    <li>HTML Standard’s fetch and potentially CORS-enabled fetch algorithms <a data-link-type="biblio" href="#biblio-html">[HTML]</a> 
    <li>CORS <a data-link-type="biblio" href="#biblio-cors">[CORS]</a> 
    <li>HTTP `<a data-link-type="http-header" href="#http-origin"><code>Origin</code></a>` header semantics <a data-link-type="biblio" href="#biblio-origin">[ORIGIN]</a> 
   </ul>
   <p>Unifying fetching provides consistent handling of: </p>
   <ul class="brief">
    <li>URL schemes 
    <li>Redirects 
    <li>Cross-origin semantics 
    <li>CSP <a data-link-type="biblio" href="#biblio-csp">[CSP]</a> 
    <li>Service workers <a data-link-type="biblio" href="#biblio-sw">[SW]</a> 
    <li>Mixed Content <a data-link-type="biblio" href="#biblio-mix">[MIX]</a> 
    <li>`<code>Referer</code>` <a data-link-type="biblio" href="#biblio-referrer">[REFERRER]</a> 
   </ul>
   <h2 class="short heading settled" data-level="1" id="preface"><span class="secno">1. </span><span class="content">Preface</span><a class="self-link" href="#preface"></a></h2>
   <p>At a high level, fetching a resource is a fairly simple operation. A request goes in, a
response comes out. The details of that operation are
however quite involved and used to not be written down carefully and differ from one API
to the next. </p>
   <p>Numerous APIs provide the ability to fetch a resource, e.g. HTML’s <code>img</code> and <code>script</code> element, CSS' <code>cursor</code> and <code>list-style-image</code>,
the <code>navigator.sendBeacon()</code> and <code>self.importScripts()</code> JavaScript
APIs. The Fetch Standard provides a unified architecture for these features so they are
all consistent when it comes to various aspects of fetching, such as redirects and the
CORS protocol. </p>
   <p>The Fetch Standard also defines the <a data-link-type="functionish" href="#dom-global-fetch"><code>fetch()</code></a> JavaScript API, which exposes most of the networking functionality at a fairly low level
of abstraction. </p>
   <h2 class="short heading settled" data-level="2" id="conformance"><span class="secno">2. </span><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <p>All diagrams, examples, and notes in this specification are
non-normative, as are all sections explicitly marked non-normative.
Everything else in this specification is normative. </p>
   <p>The key words "MUST", "MUST NOT", "REQUIRED", 
 "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
"OPTIONAL" in the normative parts of this specification are to be
interpreted as described in RFC2119. For readability, these words do
not appear in all uppercase letters in this specification. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <h2 class="heading settled" data-level="3" id="infrastructure"><span class="secno">3. </span><span class="content">Infrastructure</span><a class="self-link" href="#infrastructure"></a></h2>
   <p>This specification uses terminology from the ABNF, Encoding, HTML, IDL, Streams, and URL Standards. <a data-link-type="biblio" href="#biblio-abnf">[ABNF]</a> <a data-link-type="biblio" href="#biblio-encoding">[ENCODING]</a> <a data-link-type="biblio" href="#biblio-html">[HTML]</a> <a data-link-type="biblio" href="#biblio-webidl">[WEBIDL]</a> <a data-link-type="biblio" href="#biblio-streams">[STREAMS]</a> <a data-link-type="biblio" href="#biblio-url">[URL]</a> </p>
   <p>A <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#byte">byte</a> sequence with bytes in the range 0x00 to
0x7F, inclusive, is represented as a <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8">utf-8</a>-encoded <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#string">string</a> with code points in the range U+0000 to
U+007F, inclusive. To avoid confusion with an actual string, backticks are used. </p>
   <p class="example" id="example-string-vs-byte"><a class="self-link" href="#example-string-vs-byte"></a>"<code>true</code>" is a <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#string">string</a>, while `<code>true</code>` is a
byte sequence. </p>
   <p>Comparing two byte sequences in a <dfn data-dfn-type="dfn" data-noexport="" id="byte-case-insensitive">byte-case-insensitive<a class="self-link" href="#byte-case-insensitive"></a></dfn> manner means
comparing them exactly, byte for byte, except that the bytes in the range 0x41 to 0x5A,
inclusive, are considered to also match their corresponding byte in the range 0x61 to
0x7A, inclusive. </p>
   <p>A <dfn data-dfn-type="dfn" data-noexport="" id="case-insensitive-byte-sequence">case-insensitive byte sequence<a class="self-link" href="#case-insensitive-byte-sequence"></a></dfn> is a byte sequence that when compared to
another byte sequence does so in a <a data-link-type="dfn" href="#byte-case-insensitive">byte-case-insensitive</a> manner. </p>
   <p class="example" id="example-case-insensitive-byte-sequence"><a class="self-link" href="#example-case-insensitive-byte-sequence"></a>The <a data-link-type="dfn" href="#case-insensitive-byte-sequence">case-insensitive byte sequences</a> `<code>Content-Type</code>` and `<code>content-TYPE</code>` are equal. </p>
   <p>To <dfn data-dfn-type="dfn" data-noexport="" id="byte-lowercase">byte-lowercase<a class="self-link" href="#byte-lowercase"></a></dfn> a byte sequence, increase each byte it contains, in the
range 0x41 to 0x5A, inclusive, by 0x20. </p>
   <p>To <dfn data-dfn-type="dfn" data-noexport="" id="byte-uppercase">byte-uppercase<a class="self-link" href="#byte-uppercase"></a></dfn> a byte sequence, subtract each byte it contains, in the
range 0x61 to 0x7A, inclusive, by 0x20. </p>
   <hr>
   <p id="fetch-url">A <dfn data-dfn-type="dfn" data-noexport="" id="response-url">response URL<a class="self-link" href="#response-url"></a></dfn> is a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url">URL</a> for which implementations need not
store the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-fragment">fragment</a> as it is never exposed. When <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer">serialized</a>, the <i>exclude fragment flag</i> is set, meaning
implementations can store the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-fragment">fragment</a> nonetheless. </p>
   <hr>
   <p><dfn data-dfn-type="dfn" data-noexport="" id="credentials">Credentials<a class="self-link" href="#credentials"></a></dfn> are HTTP cookies, TLS client certificates, and <a data-link-type="dfn" href="#authentication-entry">authentication entries</a>. </p>
   <hr>
   <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">Tasks</a> that are <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">queued</a> by this standard are annotated as one
of: </p>
   <ul class="brief">
    <li><dfn data-dfn-type="dfn" data-noexport="" id="process-request-body">process request body<a class="self-link" href="#process-request-body"></a></dfn> 
    <li id="process-request-end-of-file"><a class="self-link" href="#process-request-end-of-file"></a><dfn data-dfn-type="dfn" data-noexport="" id="process-request-end-of-body">process request end-of-body<a class="self-link" href="#process-request-end-of-body"></a></dfn> 
    <li><dfn data-dfn-type="dfn" data-noexport="" id="process-response">process response<a class="self-link" href="#process-response"></a></dfn> 
    <li id="process-response-end-of-file"><a class="self-link" href="#process-response-end-of-file"></a><dfn data-dfn-type="dfn" data-noexport="" id="process-response-end-of-body">process response end-of-body<a class="self-link" href="#process-response-end-of-body"></a></dfn> 
    <li><dfn data-dfn-type="dfn" data-noexport="" id="process-response-done">process response done<a class="self-link" href="#process-response-done"></a></dfn> 
   </ul>
   <p>To <dfn data-dfn-type="dfn" data-noexport="" id="queue-a-fetch-task">queue a fetch task<a class="self-link" href="#queue-a-fetch-task"></a></dfn> on <a data-link-type="dfn" href="#concept-request">request</a> <var>request</var> to <var>run an operation</var>, run these steps: </p>
   <ol>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-client">client</a> is
 null, terminate these steps. </p>
    <li>
     <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">Queue a task</a> to <var>run an operation</var> on <var>request</var>’s <a data-link-type="dfn" href="#concept-request-client">client</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop">responsible event loop</a> using the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source">networking task source</a>. </p>
   </ol>
   <p>To <dfn data-dfn-type="dfn" data-noexport="" id="queue-a-fetch-request-done-task">queue a fetch-request-done task<a class="self-link" href="#queue-a-fetch-request-done-task"></a></dfn>, given a <var>request</var>, <a data-link-type="dfn" href="#queue-a-fetch-task">queue a fetch task</a> on <var>request</var> to <a data-link-type="dfn" href="#process-request-end-of-body">process request end-of-body</a> for <var>request</var>. </p>
   <hr>
   <p>To <dfn data-dfn-type="dfn" data-noexport="" id="read-a-request">read a <var>request</var><a class="self-link" href="#read-a-request"></a></dfn>, if <var>request</var>’s <a data-link-type="dfn" href="#concept-request-body">body</a> is non-null, whenever <var>request</var>’s <a data-link-type="dfn" href="#concept-request-body">body</a> is read from (i.e.
is transmitted or read by script), increase <var>request</var>’s <a data-link-type="dfn" href="#concept-request-body">body</a>’s <a data-link-type="dfn" href="#concept-body-transmitted">transmitted bytes</a> with the amount of payload body
bytes transmitted and then <a data-link-type="dfn" href="#queue-a-fetch-task">queue a fetch task</a> on <var>request</var> to <a data-link-type="dfn" href="#process-request-body">process request body</a> for <var>request</var>. </p>
   <h3 class="heading settled" data-level="3.1" id="http"><span class="secno">3.1. </span><span class="content">HTTP</span><a class="self-link" href="#http"></a></h3>
   <p>While <a data-link-type="dfn" href="#concept-fetch">fetching</a> encompasses more than just HTTP, it
borrows a number of concepts from HTTP and applies these to resources obtained via other
means (e.g., <code>data</code> URLs). </p>
   <p>The <dfn data-dfn-type="dfn" data-export="" id="http-whitespace-bytes">HTTP whitespace bytes<a class="self-link" href="#http-whitespace-bytes"></a></dfn> are 0x09, 0x0A, 0x0D, and 0x20. </p>
   <p>An <dfn data-dfn-type="dfn" data-export="" id="concept-https-state-value">HTTPS state value<a class="self-link" href="#concept-https-state-value"></a></dfn> is "<code>none</code>",
"<code>deprecated</code>", or "<code>modern</code>". </p>
   <p class="note no-backref" role="note">A <a data-link-type="dfn" href="#concept-response">response</a> delivered over HTTPS will
typically have its <a data-link-type="dfn" href="#concept-response-https-state">HTTPS state</a> set to
"<code>modern</code>". A user agent can use "<code>deprecated</code>" in a transition
period. E.g., while removing support for a hash function, weak cypher suites, certificates for an
"Internal Name", or certificates with an overly long validity period. How exactly a user agent can
use "<code>deprecated</code>" is not defined by this specification. An <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a> typically derives its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#https-state">HTTPS state</a> from a <a data-link-type="dfn" href="#concept-response">response</a>. </p>
   <h4 class="heading settled" data-level="3.1.1" id="methods"><span class="secno">3.1.1. </span><span class="content">Methods</span><a class="self-link" href="#methods"></a></h4>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="concept-method">method<a class="self-link" href="#concept-method"></a></dfn> is a byte sequence that matches the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.1.1">method</a> token production. </p>
   <p id="simple-method">A <dfn data-dfn-type="dfn" data-export="" id="cors-safelisted-method">CORS-safelisted method<a class="self-link" href="#cors-safelisted-method"></a></dfn> is a <a data-link-type="dfn" href="#concept-method">method</a> that is `<code>GET</code>`,
`<code>HEAD</code>`, or `<code>POST</code>`. </p>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="forbidden-method">forbidden method<a class="self-link" href="#forbidden-method"></a></dfn> is a <a data-link-type="dfn" href="#concept-method">method</a> that is a <a data-link-type="dfn" href="#byte-case-insensitive">byte-case-insensitive</a> match for `<code>CONNECT</code>`,
`<code>TRACE</code>`, or `<code>TRACK</code>`. <a data-link-type="biblio" href="#biblio-httpverbsec1">[HTTPVERBSEC1]</a>, <a data-link-type="biblio" href="#biblio-httpverbsec2">[HTTPVERBSEC2]</a>, <a data-link-type="biblio" href="#biblio-httpverbsec3">[HTTPVERBSEC3]</a> </p>
   <p>To <dfn data-dfn-for="method" data-dfn-type="dfn" data-export="" id="concept-method-normalize">normalize<a class="self-link" href="#concept-method-normalize"></a></dfn> a <a data-link-type="dfn" href="#concept-method">method</a>, if it is a <a data-link-type="dfn" href="#byte-case-insensitive">byte-case-insensitive</a> match for `<code>DELETE</code>`, `<code>GET</code>`,
`<code>HEAD</code>`, `<code>OPTIONS</code>`, `<code>POST</code>`, or
`<code>PUT</code>`, <a data-link-type="dfn" href="#byte-uppercase">byte-uppercase</a> it. </p>
   <p class="note no-backref" role="note"><a data-link-type="dfn" href="#concept-method-normalize">Normalization</a> is
done for backwards compatibility and consistency across APIs as <a data-link-type="dfn" href="#concept-method">methods</a> are actually "case-sensitive". </p>
   <p class="example" id="example-normalization"><a class="self-link" href="#example-normalization"></a>Using `<code>patch</code>` is highly likely to result in a
`<code>405 Method Not Allowed</code>`. `<code>PATCH</code>` is much more likely to
succeed. </p>
   <p class="note no-backref" role="note">There are no restrictions on <a data-link-type="dfn" href="#concept-method">methods</a>.
`<code>CHICKEN</code>` is perfectly acceptable (and not a misspelling of
`<code>CHECKIN</code>`). Other than those that are <a data-link-type="dfn" href="#concept-method-normalize">normalized</a> there are no casing restrictions either.
`<code>Egg</code>` or `<code>eGg</code>` would be fine, though uppercase is encouraged
for consistency. </p>
   <h4 class="heading settled" data-level="3.1.2" id="terminology-headers"><span class="secno">3.1.2. </span><span class="content">Headers</span><a class="self-link" href="#terminology-headers"></a></h4>
   <p>A <dfn data-dfn-for="header" data-dfn-type="dfn" data-export="" id="concept-header-list">header list<a class="self-link" href="#concept-header-list"></a></dfn> consists of zero or more <a data-link-type="dfn" href="#concept-header">headers</a>. </p>
   <p class="note no-backref" role="note">A <a data-link-type="dfn" href="#concept-header-list">header list</a> is essentially a
specialized multimap. An ordered list of key-value pairs with potentially duplicate keys. </p>
   <p>To <dfn data-dfn-for="header list" data-dfn-type="dfn" data-export="" id="concept-header-list-append">append<a class="self-link" href="#concept-header-list-append"></a></dfn> a <a data-link-type="dfn" href="#concept-header-name">name</a>/<a data-link-type="dfn" href="#concept-header-value">value</a> (<var>name</var>/<var>value</var>) pair to a <a data-link-type="dfn" href="#concept-header-list">header list</a> (<var>list</var>), append a new <a data-link-type="dfn" href="#concept-header">header</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is <var>name</var>, <a data-link-type="dfn" href="#byte-lowercase">byte-lowercased</a>, and <a data-link-type="dfn" href="#concept-header-value">value</a> is <var>value</var>, to <var>list</var>. </p>
   <p>To <dfn data-dfn-for="header list" data-dfn-type="dfn" data-export="" id="concept-header-list-delete">delete<a class="self-link" href="#concept-header-list-delete"></a></dfn> a <a data-link-type="dfn" href="#concept-header-name">name</a> (<var>name</var>) from a <a data-link-type="dfn" href="#concept-header-list">header list</a> (<var>list</var>), remove all <a data-link-type="dfn" href="#concept-header">headers</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is <var>name</var>, <a data-link-type="dfn" href="#byte-lowercase">byte-lowercased</a>, from <var>list</var>. </p>
   <p>To <dfn data-dfn-for="header list" data-dfn-type="dfn" data-export="" id="concept-header-list-set">set<a class="self-link" href="#concept-header-list-set"></a></dfn> a <a data-link-type="dfn" href="#concept-header-name">name</a>/<a data-link-type="dfn" href="#concept-header-value">value</a> (<var>name</var>/<var>value</var>) pair in a <a data-link-type="dfn" href="#concept-header-list">header list</a> (<var>list</var>), run these
steps: </p>
   <ol>
    <li>
     <p><a data-link-type="dfn" href="#byte-lowercase">Byte-lowercase</a> <var>name</var>. </p>
    <li>
     <p>If there are any <a data-link-type="dfn" href="#concept-header">headers</a> in <var>list</var> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is <var>name</var>, set the <a data-link-type="dfn" href="#concept-header-value">value</a> of the first
 such <a data-link-type="dfn" href="#concept-header">header</a> to <var>value</var> and remove the
 others. </p>
    <li>
     <p>Otherwise, append a new <a data-link-type="dfn" href="#concept-header">header</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is <var>name</var> and <a data-link-type="dfn" href="#concept-header-value">value</a> is <var>value</var>, to <var>list</var>. </p>
   </ol>
   <p>To <dfn data-dfn-type="dfn" data-export="" id="concept-header-list-combine">combine<a class="self-link" href="#concept-header-list-combine"></a></dfn> a <a data-link-type="dfn" href="#concept-header-name">name</a>/<a data-link-type="dfn" href="#concept-header-value">value</a> (<var>name</var>/<var>value</var>) pair in a <a data-link-type="dfn" href="#concept-header-list">header list</a> (<var>list</var>), run these
steps: </p>
   <ol>
    <li>
     <p><a data-link-type="dfn" href="#byte-lowercase">Byte-lowercase</a> <var>name</var>. </p>
    <li>
     <p>If there are any <a data-link-type="dfn" href="#concept-header">headers</a> in <var>list</var> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is <var>name</var>, set the <a data-link-type="dfn" href="#concept-header-value">value</a> of the first such <a data-link-type="dfn" href="#concept-header">header</a> to its <a data-link-type="dfn" href="#concept-header-value">value</a>,
 followed by `<code>,</code>`, followed by <var>value</var>. </p>
    <li>
     <p>Otherwise, append a new <a data-link-type="dfn" href="#concept-header">header</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is <var>name</var> and <a data-link-type="dfn" href="#concept-header-value">value</a> is <var>value</var>, to <var>list</var>. </p>
   </ol>
   <p class="note no-backref" role="note"><a data-link-type="dfn" href="#concept-header-list-combine">Combine</a> is used by <code class="idl"><a data-link-type="idl" href="https://xhr.spec.whatwg.org/#xmlhttprequest">XMLHttpRequest</a></code> and the <a data-link-type="dfn" href="#concept-websocket-establish">WebSocket protocol handshake</a>. </p>
   <p>To <dfn data-dfn-for="header list" data-dfn-type="dfn" data-export="" id="concept-header-list-sort-and-combine">sort and combine<a class="self-link" href="#concept-header-list-sort-and-combine"></a></dfn> a <a data-link-type="dfn" href="#concept-header-list">header list</a> (<var>list</var>), run these steps: </p>
   <ol>
    <li>
     <p>Let <var>headers</var> be an empty list of <a data-link-type="dfn" href="#concept-header-name">name</a>-<a data-link-type="dfn" href="#concept-header-value">value</a> pairs
 with the key being the <a data-link-type="dfn" href="#concept-header-name">name</a> and value the <a data-link-type="dfn" href="#concept-header-value">value</a>. </p>
    <li>
     <p>Let <var>names</var> be all the <a data-link-type="dfn" href="#concept-header-name">names</a> of the <a data-link-type="dfn" href="#concept-header">headers</a> in <var>list</var>, with duplicates removed, and sorted
 lexicographically. </p>
    <li>
     <p>For each <var>name</var> in <var>names</var>, run these substeps: </p>
     <ol>
      <li>
       <p>Let <var>value</var> be the <a data-link-type="dfn" href="#concept-header-value-combined">combined value</a> given <var>name</var> and <var>list</var>. </p>
      <li>
       <p>Append <var>name</var>-<var>value</var> to <var>headers</var>. </p>
     </ol>
    <li>
     <p>Return <var>headers</var>. </p>
   </ol>
   <hr>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="concept-header">header<a class="self-link" href="#concept-header"></a></dfn> consists of a <dfn data-dfn-for="header" data-dfn-type="dfn" data-export="" id="concept-header-name">name<a class="self-link" href="#concept-header-name"></a></dfn> and <dfn data-dfn-for="header" data-dfn-type="dfn" data-export="" id="concept-header-value">value<a class="self-link" href="#concept-header-value"></a></dfn>.
A <a data-link-type="dfn" href="#concept-header-name">name</a> is a <a data-link-type="dfn" href="#case-insensitive-byte-sequence">case-insensitive byte sequence</a> that matches the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.2">field-name</a> token production. A <a data-link-type="dfn" href="#concept-header-value">value</a> is a byte sequence that matches the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.2">field-content</a> token production. </p>
   <p class="XXX">The definition of <a data-link-type="dfn" href="#concept-header-value">value</a> <a href="https://github.com/whatwg/fetch/issues/332">needs serious work</a>. </p>
   <p class="note no-backref" role="note"><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.2">field-value</a> allows 0x0A and
0x0D bytes which can lead to reparsing issues. </p>
   <p>To <dfn data-dfn-for="header" data-dfn-type="dfn" data-export="" id="concept-header-value-normalize">normalize<a class="self-link" href="#concept-header-value-normalize"></a></dfn> a <a data-link-type="dfn" href="#concept-header-value">value</a>, remove any leading and trailing <a data-link-type="dfn" href="#http-whitespace-bytes">HTTP whitespace bytes</a> from it. </p>
   <p>A <dfn data-dfn-for="header" data-dfn-type="dfn" data-export="" id="concept-header-value-combined">combined value<a class="self-link" href="#concept-header-value-combined"></a></dfn>,
given a <a data-link-type="dfn" href="#concept-header-name">name</a> (<var>name</var>) and <a data-link-type="dfn" href="#concept-header-list">header list</a> (<var>list</var>), is the <a data-link-type="dfn" href="#concept-header-value">values</a> of all <a data-link-type="dfn" href="#concept-header">headers</a> in <var>list</var> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is <var>name</var>, separated from
each other by `<code>,</code>`, in order. </p>
   <hr>
   <p id="simple-header">A <dfn data-dfn-type="dfn" data-export="" id="cors-safelisted-request-header">CORS-safelisted request-header<a class="self-link" href="#cors-safelisted-request-header"></a></dfn> is a <a data-link-type="dfn" href="#concept-header">header</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is one of </p>
   <ul class="brief">
    <li>`<code>Accept</code>` 
    <li>`<code>Accept-Language</code>` 
    <li>`<code>Content-Language</code>` 
    <li>`<code>Content-Type</code>` and whose <a data-link-type="dfn" href="#concept-header-value">value</a>, <a data-link-type="dfn" href="#concept-header-parse">once parsed</a>, has a MIME type (ignoring parameters)
 that is `<code>application/x-www-form-urlencoded</code>`,
 `<code>multipart/form-data</code>`, or `<code>text/plain</code>` 
   </ul>
   <p>or whose <a data-link-type="dfn" href="#concept-header-name">name</a> is one of </p>
   <ul class="brief">
    <li>`<code><a href="http://httpwg.org/http-extensions/client-hints.html#dpr">DPR</a></code>` 
    <li>`<code><a href="http://httpwg.org/http-extensions/client-hints.html#downlink">Downlink</a></code>` 
    <li>`<code><a href="http://httpwg.org/http-extensions/client-hints.html#save-data">Save-Data</a></code>` 
    <li>`<code><a href="http://httpwg.org/http-extensions/client-hints.html#viewport-width">Viewport-Width</a></code>` 
    <li>`<code><a href="http://httpwg.org/http-extensions/client-hints.html#width">Width</a></code>` 
   </ul>
   <p>and whose <a data-link-type="dfn" href="#concept-header-value">value</a>, <a data-link-type="dfn" href="#concept-header-parse">once parsed</a>, is not a failure. </p>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="cors-non-wildcard-request-header-name">CORS non-wildcard request-header name<a class="self-link" href="#cors-non-wildcard-request-header-name"></a></dfn> is
`<code>Authorization</code>`. </p>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="cors-safelisted-response-header-name">CORS-safelisted response-header name<a class="self-link" href="#cors-safelisted-response-header-name"></a></dfn>, given a <a data-link-type="dfn" href="#concept-response-cors-exposed-header-name-list">CORS-exposed header-name list</a> <var>list</var>, is a <a data-link-type="dfn" href="#concept-header">header</a> <a data-link-type="dfn" href="#concept-header-name">name</a> that is one of </p>
   <ul class="brief">
    <li>`<code>Cache-Control</code>` 
    <li>`<code>Content-Language</code>` 
    <li>`<code>Content-Type</code>` 
    <li>`<code>Expires</code>` 
    <li>`<code>Last-Modified</code>` 
    <li>`<code>Pragma</code>` 
    <li>Any <a data-link-type="dfn" href="#concept-header-value">value</a> in <var>list</var> that is not a <a data-link-type="dfn" href="#forbidden-response-header-name">forbidden response-header name</a>. 
   </ul>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="forbidden-header-name">forbidden header name<a class="self-link" href="#forbidden-header-name"></a></dfn> is a <a data-link-type="dfn" href="#concept-header">header</a> <a data-link-type="dfn" href="#concept-header-name">name</a> that is one of </p>
   <ul class="brief">
    <li>`<code>Accept-Charset</code>` 
    <li>`<code>Accept-Encoding</code>` 
    <li>`<code>Access-Control-Request-Headers</code>` 
    <li>`<code>Access-Control-Request-Method</code>` 
    <li>`<code>Connection</code>` 
    <li>`<code>Content-Length</code>` 
    <li>`<code>Cookie</code>` 
    <li>`<code>Cookie2</code>` 
    <li>`<code>Date</code>` 
    <li>`<code>DNT</code>` 
    <li>`<code>Expect</code>` 
    <li>`<code>Host</code>` 
    <li>`<code>Keep-Alive</code>` 
    <li>`<a data-link-type="http-header" href="#http-origin"><code>Origin</code></a>` 
    <li>`<code>Referer</code>` 
    <li>`<code>TE</code>` 
    <li>`<code>Trailer</code>` 
    <li>`<code>Transfer-Encoding</code>` 
    <li>`<code>Upgrade</code>` 
    <li>`<code>Via</code>` 
   </ul>
   <p>or a <a data-link-type="dfn" href="#concept-header">header</a> <a data-link-type="dfn" href="#concept-header-name">name</a> that
starts with `<code>Proxy-</code>` or `<code>Sec-</code>` (including being just
`<code>Proxy-</code>` or `<code>Sec-</code>`). </p>
   <p class="note" role="note">These are forbidden so the user agent remains in full control over them. <a data-link-type="dfn" href="#concept-header-name">Names</a> starting with `<code>Sec-</code>` are
reserved to allow new <a data-link-type="dfn" href="#concept-header">headers</a> to be minted that are safe
from APIs using <a data-link-type="dfn" href="#concept-fetch">fetch</a> that allow control over <a data-link-type="dfn" href="#concept-header">headers</a> by developers, such as <code class="idl"><a data-link-type="idl" href="https://xhr.spec.whatwg.org/#xmlhttprequest">XMLHttpRequest</a></code>. <a data-link-type="biblio" href="#biblio-xhr">[XHR]</a> </p>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="forbidden-response-header-name">forbidden response-header name<a class="self-link" href="#forbidden-response-header-name"></a></dfn> is a <a data-link-type="dfn" href="#concept-header">header</a> <a data-link-type="dfn" href="#concept-header-name">name</a> that is one of: </p>
   <ul class="brief">
    <li>`<code>Set-Cookie</code>` 
    <li>`<code>Set-Cookie2</code>` 
   </ul>
   <hr>
   <p>To <dfn data-dfn-for="header" data-dfn-type="dfn" data-export="" id="concept-header-parse">parse a header value<a class="self-link" href="#concept-header-parse"></a></dfn> given a <a data-link-type="dfn" href="#concept-header-name">name</a> (<var>name</var>)  and a <a data-link-type="dfn" href="#concept-header">header</a> or a <a data-link-type="dfn" href="#concept-header-list">header list</a> (<var>headers</var>), run these steps: </p>
   <ol>
    <li>
     <p>If <var>name</var> is not in <var>headers</var>, return null. </p>
    <li>
     <p>If the ABNF for <var>name</var> allows a single <a data-link-type="dfn" href="#concept-header">header</a> and <var>headers</var> contains more than
  one, return failure. </p>
     <p class="note no-backref" role="note">If different error handling is needed, extract the desired <a data-link-type="dfn" href="#concept-header">header</a> first. </p>
    <li>
     <p>If parsing all the <a data-link-type="dfn" href="#concept-header">headers</a> <a data-link-type="dfn" href="#concept-header-name">named</a> <var>name</var> in <var>headers</var>, per the ABNF for <var>name</var>, failed, return failure. </p>
    <li>
     <p>Return one or more <a data-link-type="dfn" href="#concept-header-value">values</a> resulting from
 parsing all the <a data-link-type="dfn" href="#concept-header">headers</a> <a data-link-type="dfn" href="#concept-header-name">named</a> <var>name</var> in <var>headers</var>, per the ABNF for <var>name</var>. </p>
   </ol>
   <p>To <dfn data-dfn-for="header list" data-dfn-type="dfn" data-export="" id="concept-header-extract-mime-type">extract a MIME type<a class="self-link" href="#concept-header-extract-mime-type"></a></dfn> from a <a data-link-type="dfn" href="#concept-header-list">header list</a> (<var>headers</var>), run these steps: </p>
   <ol>
    <li>
     <p>Let <var>MIMEType</var> be the result of <a data-link-type="dfn" href="#concept-header-parse">parsing</a> `<code>Content-Type</code>` in <var>headers</var>. </p>
    <li>
     <p>If <var>MIMEType</var> is null or failure, return the empty byte sequence. </p>
    <li>
     <p>Return <var>MIMEType</var>, <a data-link-type="dfn" href="#byte-lowercase">byte-lowercased</a>. </p>
   </ol>
   <hr>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="default-user-agent-value">default `<code>User-Agent</code>` value<a class="self-link" href="#default-user-agent-value"></a></dfn> is a
user-agent-defined <a data-link-type="dfn" href="#concept-header-value">value</a> for the
`<code>User-Agent</code>` <a data-link-type="dfn" href="#concept-header">header</a>. </p>
   <h4 class="heading settled" data-level="3.1.3" id="statuses"><span class="secno">3.1.3. </span><span class="content">Statuses</span><a class="self-link" href="#statuses"></a></h4>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="concept-status">status<a class="self-link" href="#concept-status"></a></dfn> is a code. </p>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="null-body-status">null body status<a class="self-link" href="#null-body-status"></a></dfn> is a <a data-link-type="dfn" href="#concept-status">status</a> that is <code>101</code>, <code>204</code>, <code>205</code>, or <code>304</code>. </p>
   <p>An <dfn data-dfn-type="dfn" data-export="" id="ok-status">ok status<a class="self-link" href="#ok-status"></a></dfn> is any <a data-link-type="dfn" href="#concept-status">status</a> in the range <code>200</code> to <code>299</code>, inclusive. </p>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="redirect-status">redirect status<a class="self-link" href="#redirect-status"></a></dfn> is a <a data-link-type="dfn" href="#concept-status">status</a> that is <code>301</code>, <code>302</code>, <code>303</code>, <code>307</code>, or <code>308</code>. </p>
   <h4 class="heading settled" data-level="3.1.4" id="bodies"><span class="secno">3.1.4. </span><span class="content">Bodies</span><a class="self-link" href="#bodies"></a></h4>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="concept-body">body<a class="self-link" href="#concept-body"></a></dfn> consists of: </p>
   <ul>
    <li>
     <p>A <dfn data-dfn-for="body" data-dfn-type="dfn" data-export="" id="concept-body-stream">stream<a class="self-link" href="#concept-body-stream"></a></dfn> (a <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object). </p>
     <p class="XXX"><a href="https://github.com/whatwg/streams/issues/379">This might become a <code>ReadableByteStream</code> object</a>. While the type might change, the behavior specified
  will be equivalent since the hypothetical <code>ReadableByteStream</code> object will have
  the same members as the <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object has today. </p>
    <li>
     <p>A <dfn data-dfn-for="body" data-dfn-type="dfn" data-export="" id="concept-body-transmitted">transmitted bytes<a class="self-link" href="#concept-body-transmitted"></a></dfn> (an integer), initially 0. </p>
    <li>
     <p>A <dfn data-dfn-for="body" data-dfn-type="dfn" data-export="" id="concept-body-total-bytes">total bytes<a class="self-link" href="#concept-body-total-bytes"></a></dfn> (an
 integer), initially 0. </p>
   </ul>
   <p>A <a data-link-type="dfn" href="#concept-body">body</a> <var>body</var> is said to be <dfn data-dfn-for="body" data-dfn-type="dfn" data-export="" id="concept-body-done">done<a class="self-link" href="#concept-body-done"></a></dfn> if <var>body</var> is null or <var>body</var>’s <a data-link-type="dfn" href="#concept-body-stream">stream</a> is <a data-link-type="dfn" href="#concept-readablestream-closed">closed</a> or <a data-link-type="dfn" href="#concept-readablestream-errored">errored</a>. </p>
   <p>To <dfn data-dfn-for="body" data-dfn-type="dfn" data-export="" id="concept-body-wait">wait<a class="self-link" href="#concept-body-wait"></a></dfn> for a <a data-link-type="dfn" href="#concept-body">body</a> <var>body</var>, wait for <var>body</var> to be <a data-link-type="dfn" href="#concept-body-done">done</a>. </p>
   <p>To <dfn data-dfn-for="body" data-dfn-type="dfn" data-export="" id="concept-body-clone">clone<a class="self-link" href="#concept-body-clone"></a></dfn> a <a data-link-type="dfn" href="#concept-body">body</a> <var>body</var>, run these steps: </p>
   <ol>
    <li>
     <p>Let «<var>out1</var>, <var>out2</var>» be the result of <a data-link-type="dfn" href="#concept-tee-readablestream">teeing</a> <var>body</var>’s <a data-link-type="dfn" href="#concept-body-stream">stream</a>. Rethrow any exceptions. </p>
    <li>
     <p>Set <var>body</var>’s <a data-link-type="dfn" href="#concept-body-stream">stream</a> to <var>out1</var>. </p>
    <li>
     <p>Return a <a data-link-type="dfn" href="#concept-body">body</a> whose <a data-link-type="dfn" href="#concept-body-stream">stream</a> is <var>out2</var> and other members are copied from <var>body</var>. </p>
   </ol>
   <p>To <dfn data-dfn-type="dfn" data-export="" id="handle-content-codings">handle content codings<a class="self-link" href="#handle-content-codings"></a></dfn> given <var>codings</var> and <var>bytes</var>, run these substeps: </p>
   <ol>
    <li>
     <p>If <var>codings</var> are not supported, return <var>bytes</var>. </p>
    <li>
     <p>Return the result of decoding bytes with the given <var>codings</var> as explained in HTTP. <a data-link-type="biblio" href="#biblio-http">[HTTP]</a> <a data-link-type="biblio" href="#biblio-http-semantics">[HTTP-SEMANTICS]</a> <a data-link-type="biblio" href="#biblio-http-cond">[HTTP-COND]</a> <a data-link-type="biblio" href="#biblio-http-caching">[HTTP-CACHING]</a> <a data-link-type="biblio" href="#biblio-http-auth">[HTTP-AUTH]</a> </p>
   </ol>
   <h4 class="heading settled" data-level="3.1.5" id="requests"><span class="secno">3.1.5. </span><span class="content">Requests</span><a class="self-link" href="#requests"></a></h4>
   <p>The input to <a data-link-type="dfn" href="#concept-fetch">fetch</a> is a <dfn data-dfn-type="dfn" data-export="" id="concept-request">request<a class="self-link" href="#concept-request"></a></dfn>. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-method">method<a class="self-link" href="#concept-request-method"></a></dfn> (a <a data-link-type="dfn" href="#concept-method">method</a>). Unless stated otherwise it is
`<code>GET</code>`. </p>
   <p class="note no-backref" role="note">This can be updated during redirects to `<code>GET</code>` as
described in <a data-link-type="dfn" href="#concept-http-fetch">HTTP fetch</a>. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-url">url<a class="self-link" href="#concept-request-url"></a></dfn> (a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url">URL</a>). </p>
   <p class="note no-backref" role="note">Implementations are encouraged to make this a pointer to the first <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url">URL</a> in <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-url-list">url list</a>. It is provided as a distinct
field solely for the convenience of other standards hooking into Fetch. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-type="dfn" data-export="" id="local-urls-only-flag">local-URLs-only flag<a class="self-link" href="#local-urls-only-flag"></a></dfn>. Unless stated otherwise it is
unset. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-type="dfn" data-export="" id="sandboxed-storage-area-urls-flag">sandboxed-storage-area-URLs flag<a class="self-link" href="#sandboxed-storage-area-urls-flag"></a></dfn>. Unless stated
otherwise it is unset. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-header-list">header list<a class="self-link" href="#concept-request-header-list"></a></dfn> (a <a data-link-type="dfn" href="#concept-header-list">header list</a>). Unless stated otherwise it is empty. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-type="dfn" data-export="" id="unsafe-request-flag">unsafe-request flag<a class="self-link" href="#unsafe-request-flag"></a></dfn>. Unless stated otherwise it is
unset. </p>
   <p class="note no-backref" role="note">The <a data-link-type="dfn" href="#unsafe-request-flag">unsafe-request flag</a> is set by APIs such as <a data-link-type="functionish" href="#dom-global-fetch"><code>fetch()</code></a> and <code class="idl"><a data-link-type="idl" href="https://xhr.spec.whatwg.org/#xmlhttprequest">XMLHttpRequest</a></code> to ensure a <a data-link-type="dfn" href="#cors-preflight-fetch-0">CORS-preflight fetch</a> is done based on the supplied <a data-link-type="dfn" href="#concept-request-method">method</a> and <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. It does not free an API from
outlawing <a data-link-type="dfn" href="#forbidden-method">forbidden methods</a> and <a data-link-type="dfn" href="#forbidden-header-name">forbidden header names</a>. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-body">body<a class="self-link" href="#concept-request-body"></a></dfn> (null or a <a data-link-type="dfn" href="#concept-body">body</a>). Unless stated otherwise it is null. </p>
   <p class="note no-backref" role="note">This can be updated during redirects to null as described in <a data-link-type="dfn" href="#concept-http-fetch">HTTP fetch</a>. </p>
   <hr>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-client">client<a class="self-link" href="#concept-request-client"></a></dfn> (null or an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a>). </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-reserved-client">reserved client<a class="self-link" href="#concept-request-reserved-client"></a></dfn> (null, an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment">environment</a>, or an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a>). Unless stated otherwise it is null. </p>
   <p class="note no-backref" role="note">This is only used by <a data-link-type="dfn" href="#navigation-request">navigation requests</a> and worker
requests, but not service worker requests. It references an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment">environment</a> for a <a data-link-type="dfn" href="#navigation-request">navigation request</a> and an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a> for a worker request. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-target-client-id">target client id<a class="self-link" href="#concept-request-target-client-id"></a></dfn> (a string). Unless stated otherwise it is the empty string. </p>
   <p class="note no-backref" role="note">This is only used by <a data-link-type="dfn" href="#navigation-request">navigation requests</a>. It is the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id">id</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context">target browsing context</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#active-document">active document</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a>. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-window">window<a class="self-link" href="#concept-request-window"></a></dfn> ("<code>no-window</code>", "<code>client</code>", or an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a> whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global">global object</a> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/browsers.html#window">Window</a></code> object). Unless stated otherwise it is
"<code>client</code>". </p>
   <p class="note no-backref" role="note">The "<code>client</code>" value is changed to "<code>no-window</code>" or <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-client">client</a> during <a data-link-type="dfn" href="#concept-fetch">fetching</a>. It provides a convenient way for standards to not have to
explicitly set <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-window">window</a>. </p>
   <p id="keep-alive-flag">A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-type="dfn" data-noexport="" id="keepalive-flag">keepalive flag<a class="self-link" href="#keepalive-flag"></a></dfn>. Unless stated otherwise it is unset. </p>
   <p class="note no-backref" role="note">This can be used to allow the request to outlive the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a>, e.g., <code>navigator.sendBeacon</code> and the HTML <code>img</code> element set this flag. Requests with
this flag set are subject to additional processing requirements. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-type="dfn" data-export="" id="skip-service-worker-flag">skip-service-worker flag<a class="self-link" href="#skip-service-worker-flag"></a></dfn>. Unless stated otherwise it is
unset. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-initiator">initiator<a class="self-link" href="#concept-request-initiator"></a></dfn>, which is
the empty string,
"<code>download</code>",
"<code>imageset</code>",
"<code>manifest</code>", or
"<code>xslt</code>". Unless stated otherwise it is the empty string. </p>
   <p class="note no-backref" role="note">A <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-initiator">initiator</a> is not particularly granular for
the time being as other specifications do not require it to. It is primarily a
specification device to assist defining CSP and Mixed Content. It is not exposed to
JavaScript. <a data-link-type="biblio" href="#biblio-csp">[CSP]</a> <a data-link-type="biblio" href="#biblio-mix">[MIX]</a> </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-type">type<a class="self-link" href="#concept-request-type"></a></dfn>, which is
the empty string,
"<code>audio</code>",
"<code>font</code>",
"<code>image</code>",
"<code>script</code>",
"<code>style</code>",
"<code>track</code>", or
"<code>video</code>". Unless stated otherwise it is the empty string. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-destination">destination<a class="self-link" href="#concept-request-destination"></a></dfn>, which is
the empty string,
"<code>document</code>",
"<code>embed</code>",
"<code>font</code>",
"<code>image</code>",
"<code>manifest</code>",
"<code>media</code>",
"<code>object</code>",
"<code>report</code>",
"<code>script</code>",
"<code>serviceworker</code>",
"<code>sharedworker</code>",
"<code>style</code>",
"<code>worker</code>", or
"<code>xslt</code>". Unless stated otherwise it is the empty string. </p>
   <div class="note" role="note">
    <p>The following table illustrates the relationship between a <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-initiator">initiator</a>, <a data-link-type="dfn" href="#concept-request-type">type</a>, <a data-link-type="dfn" href="#concept-request-destination">destination</a>, CSP directives, and features. </p>
    <table>
     <tbody>
      <tr>
       <th><a data-link-type="dfn" href="#concept-request-initiator">Initiator</a> 
       <th><a data-link-type="dfn" href="#concept-request-type">Type</a> 
       <th><a data-link-type="dfn" href="#concept-request-destination">Destination</a> 
       <th>CSP directive 
       <th>Features 
      <tr>
       <td rowspan="16&quot;">"" 
       <td rowspan="6&quot;">"" 
       <td>"<code>report</code>" 
       <td rowspan="2">? 
       <td>CSP, NEL reports. 
      <tr>
       <td>"<code>document</code>" 
       <td>HTML’s navigate algorithm. 
      <tr>
       <td>"<code>document</code>" 
       <td><code>child-src</code> 
       <td>HTML’s <code>&lt;iframe></code> and <code>&lt;frame></code> 
      <tr>
       <td>"" 
       <td><code>connect-src</code> 
       <td><code>navigator.sendBeacon()</code>, <code>EventSource</code>,
   HTML’s <code>ping=""</code>, <a data-link-type="functionish" href="#dom-global-fetch"><code>fetch()</code></a>, <code>XMLHttpRequest</code>, <code>WebSocket</code>, Cache API? 
      <tr>
       <td>"<code>object</code>" 
       <td><code>object-src</code> 
       <td>HTML’s <code>&lt;object></code> 
      <tr>
       <td>"<code>embed</code>" 
       <td><code>object-src</code> 
       <td>HTML’s <code>&lt;embed></code> 
      <tr>
       <td>"<code>audio</code>" 
       <td>"<code>media</code>" 
       <td><code>media-src</code> 
       <td>HTML’s <code>&lt;audio></code> 
      <tr>
       <td>"<code>font</code>" 
       <td>"<code>font</code>" 
       <td><code>font-src</code> 
       <td>CSS' <code>@font-face</code> 
      <tr>
       <td>"<code>image</code>" 
       <td>"<code>image</code>" 
       <td><code>img-src</code> 
       <td>HTML’s <code>&lt;img src></code>, <code>/favicon.ico</code> resource,
   SVG’s <code>&lt;image></code>, CSS' <code>background-image</code>, CSS' <code>cursor</code>, CSS' <code>list-style-image</code>, … 
      <tr>
       <td rowspan="4&quot;">"<code>script</code>" 
       <td>"<code>script</code>" 
       <td><code>script-src</code> 
       <td>HTML’s <code>&lt;script></code>, <code>importScripts()</code> 
      <tr>
       <td>"<code>serviceworker</code>" 
       <td>? 
       <td><code>navigator.serviceWorker.register()</code> 
      <tr>
       <td>"<code>sharedworker</code>" 
       <td><code>child-src</code> 
       <td><code>SharedWorker</code> 
      <tr>
       <td>"<code>worker</code>" 
       <td><code>child-src</code> 
       <td><code>Worker</code> 
      <tr>
       <td>"<code>style</code>" 
       <td>"<code>style</code>" 
       <td><code>style-src</code> 
       <td>HTML’s <code>&lt;link rel=stylesheet></code>, CSS' <code>@import</code> 
      <tr>
       <td>"<code>track</code>" 
       <td>"<code>media</code>" 
       <td><code>media-src</code> 
       <td>HTML’s <code>&lt;track></code> 
      <tr>
       <td>"<code>video</code>" 
       <td>"<code>media</code>" 
       <td><code>media-src</code> 
       <td>HTML’s <code>&lt;video></code> element 
      <tr>
       <td>"<code>download</code>" 
       <td>"" 
       <td>"" 
       <td>? 
       <td>HTML’s <code>download=""</code>, "Save Link As…" UI 
      <tr>
       <td>"<code>imageset</code>" 
       <td>"<code>image</code>" 
       <td>"<code>image</code>" 
       <td><code>img-src</code> 
       <td>HTML’s <code>&lt;img srcset></code> and <code>&lt;picture></code> 
      <tr>
       <td>"<code>manifest</code>" 
       <td rowspan="2&quot;">"" 
       <td>"<code>manifest</code>" 
       <td><code>manifest-src</code> 
       <td>HTML’s <code>&lt;link rel=manifest></code> 
      <tr>
       <td>"<code>xslt</code>" 
       <td>"<code>xslt</code>" 
       <td><code>script-src</code> 
       <td><code>&lt;?xml-stylesheet></code> 
    </table>
    <p>CSP’s <code>form-action</code> needs to be a hook directly in HTML’s navigate or form
 submission algorithm. </p>
    <p>CSP will also need to check <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-client">client</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-browsing-context">responsible browsing context</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ancestor-browsing-context">ancestor browsing contexts</a> for various CSP directives. </p>
   </div>
   <hr>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-priority">priority<a class="self-link" href="#concept-request-priority"></a></dfn> (null or a
user-agent-defined object). Unless otherwise stated it is null. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-origin">origin<a class="self-link" href="#concept-request-origin"></a></dfn>, which is
"<code>client</code>" or an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">origin</a>. Unless stated otherwise it is
"<code>client</code>". </p>
   <p class="note no-backref" role="note">"<code>client</code>" is changed to an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">origin</a> during <a data-link-type="dfn" href="#concept-fetch">fetching</a>. It
provides a convenient way for standards to not have to set <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-origin">origin</a>. <a data-link-type="dfn" href="#concept-request">Request</a>’s <a data-link-type="dfn" href="#concept-request-origin">origin</a> can be
changed during redirects too. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-type="dfn" data-export="" id="omit-origin-header-flag">omit-<code>Origin</code>-header flag<a class="self-link" href="#omit-origin-header-flag"></a></dfn>. Unless stated
otherwise it is unset. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-referrer">referrer<a class="self-link" href="#concept-request-referrer"></a></dfn>, which is
"<code>no-referrer</code>", "<code>client</code>", or a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url">URL</a>. Unless stated otherwise it
is "<code>client</code>". </p>
   <p class="note no-backref" role="note">"<code>client</code>" is changed to "<code>no-referrer</code>" or a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url">URL</a> during <a data-link-type="dfn" href="#concept-fetch">fetching</a>. It provides a convenient way for standards
to not have to set <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-referrer">referrer</a>. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-referrer-policy">referrer policy<a class="self-link" href="#concept-request-referrer-policy"></a></dfn>,
which is a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-referrer-policy/#referrer-policy">referrer policy</a>. Unless stated otherwise it is
the empty string. <a data-link-type="biblio" href="#biblio-referrer">[REFERRER]</a> </p>
   <p class="note no-backref" role="note">This can be used to override a referrer policy associated with an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a>. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-client-hints-list">client hints list<a class="self-link" href="#concept-request-client-hints-list"></a></dfn>,
which is a <a data-link-type="dfn" href="#concept-client-hints-list">client-hints list</a>. Unless stated
otherwise, it is the empty list. </p>
   <p class="note no-backref" role="note">This will be used to override a client hints list associated with
an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a>. <a data-link-type="biblio" href="#biblio-client-hints">[CLIENT-HINTS]</a> </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-type="dfn" data-export="" id="synchronous-flag">synchronous flag<a class="self-link" href="#synchronous-flag"></a></dfn>. Unless stated otherwise it is unset. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-mode">mode<a class="self-link" href="#concept-request-mode"></a></dfn>, which is
"<code>same-origin</code>", "<code>cors</code>", "<code>no-cors</code>",
"<code>navigate</code>", or "<code>websocket</code>". Unless stated otherwise, it is
"<code>no-cors</code>". </p>
   <p class="note no-backref" role="note">Even though the default <a data-link-type="dfn" href="#concept-request">request</a> <a data-link-type="dfn" href="#concept-request-mode">mode</a> is "<code>no-cors</code>", standards are highly
discouraged from using it for new features. It is rather unsafe. "<code>navigate</code>" and
"<code>websocket</code>" are special values for the HTML Standard. <a data-link-type="biblio" href="#biblio-html">[HTML]</a> </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-type="dfn" data-export="" id="use-cors-preflight-flag">use-CORS-preflight flag<a class="self-link" href="#use-cors-preflight-flag"></a></dfn>. Unless stated otherwise, it is
unset. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-credentials-mode">credentials mode<a class="self-link" href="#concept-request-credentials-mode"></a></dfn>,
which is "<code>omit</code>", "<code>same-origin</code>", or
"<code>include</code>". Unless stated otherwise, it is "<code>omit</code>". </p>
   <p class="note no-backref" role="note"><a data-link-type="dfn" href="#concept-request">Request</a>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> controls the flow of <a data-link-type="dfn" href="#credentials">credentials</a> during a <a data-link-type="dfn" href="#concept-fetch">fetch</a>. When <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-mode">mode</a> is
"<code>navigate</code>", its <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is assumed to be
"<code>include</code>" and <a data-link-type="dfn" href="#concept-fetch">fetch</a> does not currently account
for other values. If <cite>HTML</cite> changes here, this standard will need corresponding changes. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-use-url-credentials-flag">use-URL-credentials flag<a class="self-link" href="#concept-request-use-url-credentials-flag"></a></dfn>.
Unless stated otherwise, it is unset. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-cache-mode">cache mode<a class="self-link" href="#concept-request-cache-mode"></a></dfn>, which is
"<code>default</code>", "<code>no-store</code>", "<code>reload</code>",
"<code>no-cache</code>", "<code>force-cache</code>", or
"<code>only-if-cached</code>". Unless stated otherwise, it is "<code>default</code>". </p>
   <div class="note no-backref" role="note">
    <dl>
     <dt>"<code>default</code>" 
     <dd><a data-link-type="dfn" href="#concept-fetch">Fetch</a> will inspect the HTTP cache on the way to the network.
  If there is a fresh response it will be used. If there is a stale response a conditional request
  will be created, and a normal request otherwise. It then updates the HTTP cache with the response. <a data-link-type="biblio" href="#biblio-http">[HTTP]</a> <a data-link-type="biblio" href="#biblio-http-semantics">[HTTP-SEMANTICS]</a> <a data-link-type="biblio" href="#biblio-http-cond">[HTTP-COND]</a> <a data-link-type="biblio" href="#biblio-http-caching">[HTTP-CACHING]</a> <a data-link-type="biblio" href="#biblio-http-auth">[HTTP-AUTH]</a> 
     <dt>"<code>no-store</code>" 
     <dd>Fetch behaves as if there is no HTTP cache at all. 
     <dt>"<code>reload</code>" 
     <dd>Fetch behaves as if there is no HTTP cache on the way to the network. Ergo, it creates a
  normal request and updates the HTTP cache with the response. 
     <dt>"<code>no-cache</code>" 
     <dd>Fetch creates a conditional request if there is a response in the HTTP cache and a normal
  request otherwise. It then updates the HTTP cache with the response. 
     <dt>"<code>force-cache</code>" 
     <dd>Fetch uses any response in the HTTP cache matching the request, not paying attention to
  staleness. If there was no response, it creates a normal request and updates the HTTP cache with
  the response. 
     <dt>"<code>only-if-cached</code>" 
     <dd>Fetch uses any response in the HTTP cache matching the request, not paying attention to
  staleness. If there was no response, it returns a network error. (Can only be used when <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-mode">mode</a> is
  "<code>same-origin</code>". Any cached redirects will be followed assuming <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-redirect-mode">redirect mode</a> is "<code>follow</code>" and the
  redirects do not violate <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-mode">mode</a>.) 
    </dl>
    <p>If <a data-link-type="dfn" href="#concept-request-header-list">header list</a> contains a <a data-link-type="dfn" href="#concept-header">header</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is one
 of
 `<code>If-Modified-Since</code>`,
 `<code>If-None-Match</code>`,
 `<code>If-Unmodified-Since</code>`,
 `<code>If-Match</code>`, and
 `<code>If-Range</code>`, <a data-link-type="dfn" href="#concept-fetch">fetch</a> will set <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> to "<code>no-store</code>" if it is
 "<code>default</code>". </p>
   </div>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-redirect-mode">redirect mode<a class="self-link" href="#concept-request-redirect-mode"></a></dfn>, which is
"<code>follow</code>", "<code>error</code>", or "<code>manual</code>".
Unless stated otherwise, it is "<code>follow</code>". </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-integrity-metadata">integrity metadata<a class="self-link" href="#concept-request-integrity-metadata"></a></dfn> (a string). Unless stated otherwise, it is the empty string. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-nonce-metadata">cryptographic nonce metadata<a class="self-link" href="#concept-request-nonce-metadata"></a></dfn> (a string). Unless stated otherwise, it is the empty string. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-parser-metadata">parser metadata<a class="self-link" href="#concept-request-parser-metadata"></a></dfn> which is the empty string, "<code>parser-inserted</code>", or
"<code>not-parser-inserted</code>". Unless otherwise stated, it is the empty string. </p>
   <p class="note no-backref" role="note">A <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-url-list">cryptographic nonce metadata</a> and <a data-link-type="dfn" href="#concept-request-parser-metadata">parser metadata</a> are generally populated from
attributes and flags on the HTML element responsible for triggering a fetch. They are used by
various algorithms in <a data-link-type="biblio" href="#biblio-csp">[CSP]</a> to determine whether requests or responses
should be blocked in a given context. </p>
   <hr>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-url-list">url list<a class="self-link" href="#concept-request-url-list"></a></dfn> (a list of one or more <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url">URLs</a>). Unless stated otherwise, it is a list containing a copy of <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-url">url</a>. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-current-url">current url<a class="self-link" href="#concept-request-current-url"></a></dfn>. It is a pointer to the
last <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url">URL</a> in <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-url-list">url list</a>. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-redirect-count">redirect count<a class="self-link" href="#concept-request-redirect-count"></a></dfn>.
Unless stated otherwise, it is zero. </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-response-tainting">response tainting<a class="self-link" href="#concept-request-response-tainting"></a></dfn>,
which is "<code>basic</code>", "<code>cors</code>", or "<code>opaque</code>".
Unless stated otherwise, it is "<code>basic</code>". </p>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a> has an associated <dfn data-dfn-type="dfn" data-export="" id="done-flag">done flag<a class="self-link" href="#done-flag"></a></dfn>. Unless stated otherwise, it is unset. </p>
   <p class="note no-backref" role="note">A <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-url-list">url list</a>, <a data-link-type="dfn" href="#concept-request-current-url">current url</a>, <a data-link-type="dfn" href="#concept-request-redirect-count">redirect count</a>, <a data-link-type="dfn" href="#concept-request-response-tainting">response tainting</a>, and <a data-link-type="dfn" href="#done-flag">done flag</a> are used as bookkeeping details by the <a data-link-type="dfn" href="#concept-fetch">fetch</a> algorithm. </p>
   <hr>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="subresource-request">subresource request<a class="self-link" href="#subresource-request"></a></dfn> is a <a data-link-type="dfn" href="#concept-request">request</a> whose <a data-link-type="dfn" href="#concept-request-destination">destination</a> is "<code>font</code>",
"<code>image</code>", "<code>manifest</code>", "<code>media</code>",
"<code>script</code>", "<code>style</code>", "<code>xslt</code>", or the empty
string. </p>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="potential-navigation-or-subresource-request">potential-navigation-or-subresource request<a class="self-link" href="#potential-navigation-or-subresource-request"></a></dfn> is a <a data-link-type="dfn" href="#concept-request">request</a> whose <a data-link-type="dfn" href="#concept-request-destination">destination</a> is
"<code>object</code>" or "<code>embed</code>". </p>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="non-subresource-request">non-subresource request<a class="self-link" href="#non-subresource-request"></a></dfn> is a <a data-link-type="dfn" href="#concept-request">request</a> whose <a data-link-type="dfn" href="#concept-request-destination">destination</a> is "<code>document</code>",
"<code>report</code>", "<code>serviceworker</code>", "<code>sharedworker</code>",
or "<code>worker</code>". </p>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="navigation-request">navigation request<a class="self-link" href="#navigation-request"></a></dfn> is a <a data-link-type="dfn" href="#concept-request">request</a> whose <a data-link-type="dfn" href="#concept-request-destination">destination</a> is
"<code>document</code>". </p>
   <p class="note" role="note">See <a data-link-type="dfn" href="https://w3c.github.io/ServiceWorker/#on-fetch-request-algorithm">handle fetch</a> for usage of these terms. <a data-link-type="biblio" href="#biblio-sw">[SW]</a> </p>
   <p>To <dfn data-dfn-for="request" data-dfn-type="dfn" data-export="" id="concept-request-clone">clone<a class="self-link" href="#concept-request-clone"></a></dfn> a <a data-link-type="dfn" href="#concept-request">request</a> <var>request</var>, run these steps: </p>
   <ol>
    <li>
     <p>Let <var>newRequest</var> be a copy of <var>request</var>, except for its <a data-link-type="dfn" href="#concept-request-body">body</a>. </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-body">body</a> is non-null, set <var>newRequest</var>’s <a data-link-type="dfn" href="#concept-request-body">body</a> to the result of <a data-link-type="dfn" href="#concept-body-clone">cloning</a> <var>request</var>’s <a data-link-type="dfn" href="#concept-request-body">body</a>. Rethrow any exceptions. </p>
    <li>
     <p>Return <var>newRequest</var>. </p>
   </ol>
   <h4 class="heading settled" data-level="3.1.6" id="responses"><span class="secno">3.1.6. </span><span class="content">Responses</span><a class="self-link" href="#responses"></a></h4>
   <p>The result of <a data-link-type="dfn" href="#concept-fetch">fetch</a> is a <dfn data-dfn-type="dfn" data-export="" id="concept-response">response<a class="self-link" href="#concept-response"></a></dfn>. A <a data-link-type="dfn" href="#concept-response">response</a> evolves over time. That is, not all its fields are available straight away. </p>
   <p>A <a data-link-type="dfn" href="#concept-response">response</a> has an associated <dfn data-dfn-for="response" data-dfn-type="dfn" data-export="" id="concept-response-type">type<a class="self-link" href="#concept-response-type"></a></dfn> which is
"<code>basic</code>",
"<code>cors</code>",
"<code>default</code>",
"<code>error</code>",
"<code>opaque</code>", or
"<code>opaqueredirect</code>".
Unless stated otherwise, it is "<code>default</code>". </p>
   <p>A <a data-link-type="dfn" href="#concept-response">response</a> can have an associated <dfn data-dfn-for="response" data-dfn-type="dfn" data-export="" id="concept-response-termination-reason">termination reason<a class="self-link" href="#concept-response-termination-reason"></a></dfn> which is <i>end-user abort</i>, <i>fatal</i>, or <i>timeout</i>. </p>
   <p>A <a data-link-type="dfn" href="#concept-response">response</a> has an associated <dfn data-dfn-for="response" data-dfn-type="dfn" data-export="" id="concept-response-url">url<a class="self-link" href="#concept-response-url"></a></dfn>. It is a pointer to the
last <a data-link-type="dfn" href="#response-url">response URL</a> in <a data-link-type="dfn" href="#concept-response">response</a>’s <a data-link-type="dfn" href="#concept-response-url-list">url list</a> and null if <a data-link-type="dfn" href="#concept-response">response</a>’s <a data-link-type="dfn" href="#concept-response-url-list">url list</a> is the empty list. </p>
   <p>A <a data-link-type="dfn" href="#concept-response">response</a> has an associated <dfn data-dfn-for="response" data-dfn-type="dfn" data-export="" id="concept-response-url-list">url list<a class="self-link" href="#concept-response-url-list"></a></dfn> (a list of
zero or more <a data-link-type="dfn" href="#response-url">response URLs</a>). Unless stated otherwise, it is the
empty list. </p>
   <p class="note no-backref" role="note">Except for the last <a data-link-type="dfn" href="#response-url">response URL</a>, if any, a <a data-link-type="dfn" href="#concept-response">response</a>’s <a data-link-type="dfn" href="#concept-response-url-list">url list</a> cannot be exposed to script. That would violate <a data-link-type="dfn" href="#atomic-http-redirect-handling">atomic HTTP redirect handling</a>. </p>
   <p>A <a data-link-type="dfn" href="#concept-response">response</a> has an associated <dfn data-dfn-for="response" data-dfn-type="dfn" data-export="" id="concept-response-status">status<a class="self-link" href="#concept-response-status"></a></dfn>, which is a <a data-link-type="dfn" href="#concept-status">status</a>. Unless stated otherwise it is <code>200</code>. </p>
   <p>A <a data-link-type="dfn" href="#concept-response">response</a> has an associated <dfn data-dfn-for="response" data-dfn-type="dfn" data-export="" id="concept-response-status-message">status message<a class="self-link" href="#concept-response-status-message"></a></dfn>.
Unless stated otherwise it is `<code>OK</code>`. </p>
   <p>A <a data-link-type="dfn" href="#concept-response">response</a> has an associated <dfn data-dfn-for="response" data-dfn-type="dfn" data-export="" id="concept-response-header-list">header list<a class="self-link" href="#concept-response-header-list"></a></dfn> (a <a data-link-type="dfn" href="#concept-header-list">header list</a>). Unless stated otherwise it is empty. </p>
   <p>A <a data-link-type="dfn" href="#concept-response">response</a> has an associated <dfn data-dfn-for="response" data-dfn-type="dfn" data-export="" id="concept-response-body">body<a class="self-link" href="#concept-response-body"></a></dfn> (null or a <a data-link-type="dfn" href="#concept-body">body</a>). Unless stated otherwise it is null. </p>
   <p>A <a data-link-type="dfn" href="#concept-response">response</a> has an associated <dfn data-dfn-for="response" data-dfn-type="dfn" data-export="" id="concept-response-trailer">trailer<a class="self-link" href="#concept-response-trailer"></a></dfn> (a <a data-link-type="dfn" href="#concept-header-list">header list</a>). Unless stated otherwise it is empty. </p>
   <p>A <a data-link-type="dfn" href="#concept-response">response</a> has an associated <dfn data-dfn-for="response" data-dfn-type="dfn" data-export="" id="concept-response-https-state">HTTPS state<a class="self-link" href="#concept-response-https-state"></a></dfn> (an <a data-link-type="dfn" href="#concept-https-state-value">HTTPS state value</a>). Unless stated otherwise, it is
"<code>none</code>". </p>
   <p>A <a data-link-type="dfn" href="#concept-response">response</a> has an associated <dfn data-dfn-for="response" data-dfn-type="dfn" data-export="" id="concept-response-csp-list">CSP list<a class="self-link" href="#concept-response-csp-list"></a></dfn>, which is a
list of <a href="https://w3c.github.io/webappsec-csp/#policy">Content Security Policy objects</a> for the <a data-link-type="dfn" href="#concept-response">response</a>. The list is empty unless otherwise
specified. <a data-link-type="biblio" href="#biblio-csp">[CSP]</a> </p>
   <p>A <a data-link-type="dfn" href="#concept-response">response</a> has an associated <dfn data-dfn-for="response" data-dfn-type="dfn" data-export="" id="concept-response-cors-exposed-header-name-list">CORS-exposed header-name list<a class="self-link" href="#concept-response-cors-exposed-header-name-list"></a></dfn> (a list of zero or more <a data-link-type="dfn" href="#concept-header">header</a> <a data-link-type="dfn" href="#concept-header-name">names</a>). The list is empty unless otherwise specified. </p>
   <p class="note no-backref" role="note">A <a data-link-type="dfn" href="#concept-response">response</a> will typically get its <a data-link-type="dfn" href="#concept-response-cors-exposed-header-name-list">CORS-exposed header-name list</a> set by <a data-link-type="dfn" href="#concept-header-parse">parsing</a> the
`<a data-link-type="dfn" href="#http-access-control-expose-headers"><code>Access-Control-Expose-Headers</code></a>` header. This
list is used by a <a data-link-type="dfn" href="#concept-filtered-response-cors">CORS filtered response</a> to
determine which headers to expose. </p>
   <p>A <a data-link-type="dfn" href="#concept-response">response</a> can have an associated <dfn data-dfn-for="response" data-dfn-type="dfn" data-export="" id="concept-response-location-url">location URL<a class="self-link" href="#concept-response-location-url"></a></dfn> (null, failure, or a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url">URL</a>). Unless specified otherwise, <a data-link-type="dfn" href="#concept-response">response</a> has no <a data-link-type="dfn" href="#concept-response-location-url">location URL</a>. </p>
   <p class="note no-backref" role="note">This concept is used for redirect handling in Fetch and in HTML’s
navigate algorithm. It ensures `<code>Location</code>` is <a data-link-type="dfn" href="#concept-header-parse">parsed</a> consistently and only once. <a data-link-type="biblio" href="#biblio-html">[HTML]</a> </p>
   <hr>
   <p>A <a data-link-type="dfn" href="#concept-response">response</a> whose <a data-link-type="dfn" href="#concept-response-type">type</a> is "<code>error</code>" is known as a <dfn data-dfn-type="dfn" data-export="" id="concept-network-error">network error<a class="self-link" href="#concept-network-error"></a></dfn>. </p>
   <p>A <a data-link-type="dfn" href="#concept-network-error">network error</a> is a <a data-link-type="dfn" href="#concept-response">response</a> whose <a data-link-type="dfn" href="#concept-response-status">status</a> is always <code>0</code>, <a data-link-type="dfn" href="#concept-response-status-message">status message</a> is always the empty byte sequence, <a data-link-type="dfn" href="#concept-response-header-list">header list</a> is always empty, <a data-link-type="dfn" href="#concept-response-body">body</a> is always null, and <a data-link-type="dfn" href="#concept-response-trailer">trailer</a> is always empty. </p>
   <hr>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="concept-filtered-response">filtered response<a class="self-link" href="#concept-filtered-response"></a></dfn> is a limited view on a <a data-link-type="dfn" href="#concept-response">response</a> that is not a <a data-link-type="dfn" href="#concept-network-error">network error</a>. This <a data-link-type="dfn" href="#concept-response">response</a> is referred to as the <a data-link-type="dfn" href="#concept-filtered-response">filtered response</a>’s associated <dfn data-dfn-for="internal" data-dfn-type="dfn" data-export="" id="concept-internal-response">internal response<a class="self-link" href="#concept-internal-response"></a></dfn>. </p>
   <p class="note no-backref" role="note">The <a data-link-type="dfn" href="#concept-fetch">fetch</a> algorithm returns
such a view to ensure APIs do not accidentally leak information. If the information is
required, e.g., to feed image data to a decoder, the associated <a data-link-type="dfn" href="#concept-internal-response">internal response</a> can be used, which is only
"accessible" to internal specification algorithms. </p>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="concept-filtered-response-basic">basic filtered response<a class="self-link" href="#concept-filtered-response-basic"></a></dfn> is a <a data-link-type="dfn" href="#concept-filtered-response">filtered response</a> whose <a data-link-type="dfn" href="#concept-response-type">type</a> is "<code>basic</code>" and <a data-link-type="dfn" href="#concept-response-header-list">header list</a> excludes any <a data-link-type="dfn" href="#concept-header">headers</a> in <a data-link-type="dfn" href="#concept-internal-response">internal response</a>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is a <a data-link-type="dfn" href="#forbidden-response-header-name">forbidden response-header name</a>. </p>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="concept-filtered-response-cors">CORS filtered response<a class="self-link" href="#concept-filtered-response-cors"></a></dfn> is a <a data-link-type="dfn" href="#concept-filtered-response">filtered response</a> whose <a data-link-type="dfn" href="#concept-response-type">type</a> is "<code>cors</code>", <a data-link-type="dfn" href="#concept-response-header-list">header list</a> excludes any <a data-link-type="dfn" href="#concept-header">headers</a> in <a data-link-type="dfn" href="#concept-internal-response">internal response</a>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is <em>not</em> a <a data-link-type="dfn" href="#cors-safelisted-response-header-name">CORS-safelisted response-header name</a>, given <a data-link-type="dfn" href="#concept-internal-response">internal response</a>’s <a data-link-type="dfn" href="#concept-response-cors-exposed-header-name-list">CORS-exposed header-name list</a>, and <a data-link-type="dfn" href="#concept-response-trailer">trailer</a> is empty. </p>
   <p>An <dfn data-dfn-type="dfn" data-export="" id="concept-filtered-response-opaque">opaque filtered response<a class="self-link" href="#concept-filtered-response-opaque"></a></dfn> is a <a data-link-type="dfn" href="#concept-filtered-response">filtered response</a> whose <a data-link-type="dfn" href="#concept-response-type">type</a> is "<code>opaque</code>", <a data-link-type="dfn" href="#concept-response-url-list">url list</a> is the empty list, <a data-link-type="dfn" href="#concept-response-status">status</a> is <code>0</code>, <a data-link-type="dfn" href="#concept-response-status-message">status message</a> is the empty byte sequence, <a data-link-type="dfn" href="#concept-response-header-list">header list</a> is empty, <a data-link-type="dfn" href="#concept-response-body">body</a> is null, and <a data-link-type="dfn" href="#concept-response-trailer">trailer</a> is empty. </p>
   <p>An <dfn data-dfn-type="dfn" data-export="" id="concept-filtered-response-opaque-redirect">opaque-redirect filtered response<a class="self-link" href="#concept-filtered-response-opaque-redirect"></a></dfn> is a <a data-link-type="dfn" href="#concept-filtered-response">filtered response</a> whose <a data-link-type="dfn" href="#concept-response-type">type</a> is "<code>opaqueredirect</code>", <a data-link-type="dfn" href="#concept-response-status">status</a> is <code>0</code>, <a data-link-type="dfn" href="#concept-response-status-message">status message</a> is the empty byte sequence, <a data-link-type="dfn" href="#concept-response-header-list">header list</a> is empty, <a data-link-type="dfn" href="#concept-response-body">body</a> is null, and <a data-link-type="dfn" href="#concept-response-trailer">trailer</a> is empty. </p>
   <div class="note no-backref" role="note">
    <p>Exposing the <a data-link-type="dfn" href="#concept-response-url-list">url list</a> for <a data-link-type="dfn" href="#concept-filtered-response-opaque-redirect">opaque-redirect filtered responses</a> is
 harmless since no redirects are followed. </p>
    <p>In other words, an <a data-link-type="dfn" href="#concept-filtered-response-opaque">opaque filtered response</a> and an <a data-link-type="dfn" href="#concept-filtered-response-opaque-redirect">opaque-redirect filtered response</a> are
 nearly indistinguishable from a <a data-link-type="dfn" href="#concept-network-error">network error</a>. When
 introducing new APIs, do not use the <a data-link-type="dfn" href="#concept-internal-response">internal response</a> for internal specification algorithms as that will leak information. </p>
    <p>This also means that JavaScript APIs, such as <a class="idl-code" data-link-type="attribute" href="#dom-response-ok"><code>response.ok</code></a>,
 will return rather useless results. </p>
   </div>
   <p>To <dfn data-dfn-for="response" data-dfn-type="dfn" data-export="" id="concept-response-clone">clone<a class="self-link" href="#concept-response-clone"></a></dfn> a <a data-link-type="dfn" href="#concept-response">response</a> <var>response</var>, run these steps: </p>
   <ol>
    <li>
     <p>If <var>response</var> is a <a data-link-type="dfn" href="#concept-filtered-response">filtered response</a>,
 return a new identical filtered response whose <a data-link-type="dfn" href="#concept-internal-response">internal
 response</a> is a <a data-link-type="dfn" href="#concept-response-clone">clone</a> of <var>response</var>’s <a data-link-type="dfn" href="#concept-internal-response">internal response</a>. Rethrow any exceptions. </p>
    <li>
     <p>Let <var>newResponse</var> be a copy of <var>response</var>, except for its <a data-link-type="dfn" href="#concept-response-body">body</a>. </p>
    <li>
     <p>If <var>response</var>’s <a data-link-type="dfn" href="#concept-response-body">body</a> is non-null, set <var>newResponse</var>’s <a data-link-type="dfn" href="#concept-response-body">body</a> to the result of <a data-link-type="dfn" href="#concept-body-clone">cloning</a> <var>response</var>’s <a data-link-type="dfn" href="#concept-response-body">body</a>. Rethrow any exceptions. </p>
    <li>
     <p>Return <var>newResponse</var>. </p>
   </ol>
   <h3 class="heading settled" data-level="3.2" id="authentication-entries"><span class="secno">3.2. </span><span class="content">Authentication entries</span><a class="self-link" href="#authentication-entries"></a></h3>
   <p>An <dfn data-dfn-type="dfn" data-export="" id="authentication-entry">authentication entry<a class="self-link" href="#authentication-entry"></a></dfn> and a <dfn data-dfn-type="dfn" data-export="" id="proxy-authentication-entry">proxy-authentication entry<a class="self-link" href="#proxy-authentication-entry"></a></dfn> are tuples of username, password, and realm,
associated with one or more <a data-link-type="dfn" href="#concept-request">requests</a>. </p>
   <p>User agents should allow both to be cleared together with HTTP cookies and similar tracking
functionality. </p>
   <p>Further details are defined by HTTP. <a data-link-type="biblio" href="#biblio-http">[HTTP]</a> <a data-link-type="biblio" href="#biblio-http-semantics">[HTTP-SEMANTICS]</a> <a data-link-type="biblio" href="#biblio-http-cond">[HTTP-COND]</a> <a data-link-type="biblio" href="#biblio-http-caching">[HTTP-CACHING]</a> <a data-link-type="biblio" href="#biblio-http-auth">[HTTP-AUTH]</a> </p>
   <h3 class="heading settled" data-level="3.3" id="fetch-groups"><span class="secno">3.3. </span><span class="content">Fetch groups</span><a class="self-link" href="#fetch-groups"></a></h3>
   <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a> has an associated <dfn data-dfn-for="fetch" data-dfn-type="dfn" data-export="" id="concept-fetch-group">fetch group<a class="self-link" href="#concept-fetch-group"></a></dfn>. </p>
   <p>A <a data-link-type="dfn" href="#concept-fetch-group">fetch group</a> holds an ordered list of <dfn data-dfn-for="fetch group" data-dfn-type="dfn" data-export="" data-lt="fetch record" id="concept-fetch-record">fetch records<a class="self-link" href="#concept-fetch-record"></a></dfn>. </p>
   <p>A <a data-link-type="dfn" href="#concept-fetch-record">fetch record</a> has an associated <dfn data-dfn-for="fetch record" data-dfn-type="dfn" data-export="" id="concept-fetch-record-request">request<a class="self-link" href="#concept-fetch-record-request"></a></dfn> (a <a data-link-type="dfn" href="#concept-request">request</a>). </p>
   <p>A <a data-link-type="dfn" href="#concept-fetch-record">fetch record</a> has an associated <dfn data-dfn-for="fetch record" data-dfn-type="dfn" data-export="" id="concept-fetch-record-fetch">fetch<a class="self-link" href="#concept-fetch-record-fetch"></a></dfn> (a <a data-link-type="dfn" href="#concept-fetch">fetch</a> algorithm or null). </p>
   <hr>
   <p>When a <a data-link-type="dfn" href="#concept-fetch-group">fetch group</a> is <dfn data-dfn-for="fetch group" data-dfn-type="dfn" data-export="" id="concept-fetch-group-terminate">terminated<a class="self-link" href="#concept-fetch-group-terminate"></a></dfn>,
for each associated <a data-link-type="dfn" href="#concept-fetch-record">fetch record</a> whose <a data-link-type="dfn" href="#concept-fetch-record-request">request</a>’s <a data-link-type="dfn" href="#done-flag">done flag</a> or <a data-link-type="dfn" href="#keepalive-flag">keepalive flag</a> is unset, <a data-link-type="dfn" href="#concept-fetch-terminate">terminate</a> the <a data-link-type="dfn" href="#concept-fetch-record">fetch record</a>’s <a data-link-type="dfn" href="#concept-fetch-record-fetch">fetch</a> with reason <i>fatal</i>. </p>
   <h3 class="heading settled" data-level="3.4" id="connections"><span class="secno">3.4. </span><span class="content">Connections</span><a class="self-link" href="#connections"></a></h3>
   <p>A user agent has an associated <dfn data-dfn-for="connection" data-dfn-type="dfn" data-export="" id="concept-connection-pool">connection pool<a class="self-link" href="#concept-connection-pool"></a></dfn>. A <a data-link-type="dfn" href="#concept-connection-pool">connection pool</a> consists of zero or more <dfn data-dfn-type="dfn" data-export="" data-lt="connection" id="concept-connection">connections<a class="self-link" href="#concept-connection"></a></dfn>. Each <a data-link-type="dfn" href="#concept-connection">connection</a> is identified by an <b>origin</b> (an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">origin</a>) and <b>credentials</b> (a boolean). </p>
   <p>To <dfn data-dfn-for="connection" data-dfn-type="dfn" data-export="" id="concept-connection-obtain">obtain a connection<a class="self-link" href="#concept-connection-obtain"></a></dfn>, given an <var>origin</var> and <var>credentials</var>, run these steps: </p>
   <ol>
    <li>
     <p>If <a data-link-type="dfn" href="#concept-connection-pool">connection pool</a> contains a <a data-link-type="dfn" href="#concept-connection">connection</a> whose <b>origin</b> is <var>origin</var> and <b>credentials</b> is <var>credentials</var>, return that <a data-link-type="dfn" href="#concept-connection">connection</a>. </p>
    <li>
     <p>Let <var>connection</var> be the result of establishing an HTTP connection to <var>origin</var>. <a data-link-type="biblio" href="#biblio-http">[HTTP]</a> <a data-link-type="biblio" href="#biblio-http-semantics">[HTTP-SEMANTICS]</a> <a data-link-type="biblio" href="#biblio-http-cond">[HTTP-COND]</a> <a data-link-type="biblio" href="#biblio-http-caching">[HTTP-CACHING]</a> <a data-link-type="biblio" href="#biblio-http-auth">[HTTP-AUTH]</a> <a data-link-type="biblio" href="#biblio-tls">[TLS]</a> </p>
     <p>If <var>credentials</var> is false, do <em>not</em> send a TLS client certificate. </p>
     <p>If establishing a connection does not succeed (e.g., a DNS, TCP, or TLS error), return failure. </p>
    <li>
     <p>Add <var>connection</var> to the <a data-link-type="dfn" href="#concept-connection-pool">connection pool</a> with <b>origin</b> being <var>origin</var> and <b>credentials</b> being <var>credentials</var>. </p>
    <li>
     <p>Return <var>connection</var>. </p>
   </ol>
   <p class="note no-backref" role="note">This is intentionally a little vague as the finer points are still
evolving. Describing this helps explain the <code>&lt;link rel=preconnect></code> feature and
clearly stipulates that <a data-link-type="dfn" href="#concept-connection">connections</a> are keyed on <b>credentials</b>. The latter clarifies that e.g., TLS session identifiers are not reused across <a data-link-type="dfn" href="#concept-connection">connections</a> whose <b>credentials</b> are false with <a data-link-type="dfn" href="#concept-connection">connections</a> whose <b>credentials</b> are true. </p>
   <h3 class="heading settled" data-level="3.5" id="port-blocking"><span class="secno">3.5. </span><span class="content">Port blocking</span><a class="self-link" href="#port-blocking"></a></h3>
   <p>To determine whether fetching a <a data-link-type="dfn" href="#concept-request">request</a> <var>request</var> <dfn data-dfn-type="dfn" data-export="" data-lt="block bad port" id="block-bad-port">should be blocked due to a bad port<a class="self-link" href="#block-bad-port"></a></dfn>,
run these steps: </p>
   <ol>
    <li>
     <p>Let <var>url</var> be <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>. </p>
    <li>
     <p>Let <var>scheme</var> be <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a>. </p>
    <li>
     <p>Let <var>port</var> be <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-port">port</a>. </p>
    <li>
     <p>If <var>scheme</var> is "<code>ftp</code>" and <var>port</var> is 20 or 21, then
 return <b>allowed</b>. </p>
    <li>
     <p>Otherwise, if <var>scheme</var> is a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#network-scheme">network scheme</a> and <var>port</var> is a <a data-link-type="dfn" href="#bad-port">bad port</a>, then return <b>blocked</b>. </p>
    <li>
     <p>Return <b>allowed</b>. </p>
   </ol>
   <p>A <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-port">port</a> is a <dfn data-dfn-type="dfn" data-export="" id="bad-port">bad port<a class="self-link" href="#bad-port"></a></dfn> if it is listed in the first column of the following table. </p>
   <table>
    <tbody>
     <tr>
      <th>Port
      <th>Typical service 
     <tr>
      <td>1
      <td>tcpmux 
     <tr>
      <td>7
      <td>echo 
     <tr>
      <td>9
      <td>discard 
     <tr>
      <td>11
      <td>systat 
     <tr>
      <td>13
      <td>daytime 
     <tr>
      <td>15
      <td>netstat 
     <tr>
      <td>17
      <td>qotd 
     <tr>
      <td>19
      <td>chargen 
     <tr>
      <td>20
      <td>ftp-data 
     <tr>
      <td>21
      <td>ftp 
     <tr>
      <td>22
      <td>ssh 
     <tr>
      <td>23
      <td>telnet 
     <tr>
      <td>25
      <td>smtp 
     <tr>
      <td>37
      <td>time 
     <tr>
      <td>42
      <td>name 
     <tr>
      <td>43
      <td>nicname 
     <tr>
      <td>53
      <td>domain 
     <tr>
      <td>77
      <td>priv-rjs 
     <tr>
      <td>79
      <td>finger 
     <tr>
      <td>87
      <td>ttylink 
     <tr>
      <td>95
      <td>supdup 
     <tr>
      <td>101
      <td>hostriame 
     <tr>
      <td>102
      <td>iso-tsap 
     <tr>
      <td>103
      <td>gppitnp 
     <tr>
      <td>104
      <td>acr-nema 
     <tr>
      <td>109
      <td>pop2 
     <tr>
      <td>110
      <td>pop3 
     <tr>
      <td>111
      <td>sunrpc 
     <tr>
      <td>113
      <td>auth 
     <tr>
      <td>115
      <td>sftp 
     <tr>
      <td>117
      <td>uucp-path 
     <tr>
      <td>119
      <td>nntp 
     <tr>
      <td>123
      <td>ntp 
     <tr>
      <td>135
      <td>loc-srv / epmap 
     <tr>
      <td>139
      <td>netbios 
     <tr>
      <td>143
      <td>imap2 
     <tr>
      <td>179
      <td>bgp 
     <tr>
      <td>389
      <td>ldap 
     <tr>
      <td>465
      <td>smtp+ssl 
     <tr>
      <td>512
      <td>print / exec 
     <tr>
      <td>513
      <td>login 
     <tr>
      <td>514
      <td>shell 
     <tr>
      <td>515
      <td>printer 
     <tr>
      <td>526
      <td>tempo 
     <tr>
      <td>530
      <td>courier 
     <tr>
      <td>531
      <td>chat 
     <tr>
      <td>532
      <td>netnews 
     <tr>
      <td>540
      <td>uucp 
     <tr>
      <td>556
      <td>remotefs 
     <tr>
      <td>563
      <td>nntp+ssl 
     <tr>
      <td>587
      <td>smtp 
     <tr>
      <td>601
      <td>syslog-conn 
     <tr>
      <td>636
      <td>ldap+ssl 
     <tr>
      <td>993
      <td>ldap+ssl 
     <tr>
      <td>995
      <td>pop3+ssl 
     <tr>
      <td>2049
      <td>nfs 
     <tr>
      <td>3659
      <td>apple-sasl 
     <tr>
      <td>4045
      <td>lockd 
     <tr>
      <td>6000
      <td>x11 
     <tr>
      <td>6665
      <td>irc (alternate) 
     <tr>
      <td>6666
      <td>irc (alternate) 
     <tr>
      <td>6667
      <td>irc (default) 
     <tr>
      <td>6668
      <td>irc (alternate) 
     <tr>
      <td>6669
      <td>irc (alternate) 
   </table>
   <h3 class="heading settled" data-dfn-type="dfn" data-export="" data-level="3.6" data-lt="should response to request be blocked due to mime type" id="should-response-to-request-be-blocked-due-to-mime-type?"><span class="secno">3.6. </span><span class="content">Should <var>response</var> to <var>request</var> be blocked due to its MIME type?</span><a class="self-link" href="#should-response-to-request-be-blocked-due-to-mime-type%3F"></a></h3>
   <p>Run these steps: </p>
   <ol>
    <li>
     <p>Let <var>MIMEType</var> be the result of <a data-link-type="dfn" href="#concept-header-extract-mime-type">extracting a MIME type</a> from <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
    <li>
     <p>Let <var>type</var> be <var>request</var>’s <a data-link-type="dfn" href="#concept-request-type">type</a>. </p>
    <li>
     <p>If <var>type</var> is "<code>script</code>" and one of the following is true, then return <b>blocked</b>: </p>
     <ul class="brief">
      <li><var>MIMEType</var> starts with `<code>audio/</code>`, `<code>image/</code>`, or
   `<code>video/</code>`. 
      <li><var>MIMEType</var> is `<code>text/csv</code>`. 
     </ul>
    <li>
     <p>Return <b>allowed</b>. </p>
   </ol>
   <h3 class="heading settled" data-level="3.7" id="client-hints-list"><span class="secno">3.7. </span><span class="content">Client hints list</span><a class="self-link" href="#client-hints-list"></a></h3>
   <p class="note" role="note">This section will be integrated into HTTP Client Hints. <a data-link-type="biblio" href="#biblio-client-hints">[CLIENT-HINTS]</a> </p>
   <p>A <dfn data-dfn-for="client" data-dfn-type="dfn" data-export="" id="concept-client-hints-list">client hints list<a class="self-link" href="#concept-client-hints-list"></a></dfn> is a list of <a href="http://httpwg.org/http-extensions/client-hints.html#accept-ch">Client hint tokens</a>,
each of which is one of `<code>dpr</code>`,
`<code>save-data</code>`, `<code>viewport-width</code>`, or
`<code>width</code>`. </p>
   <h3 class="heading settled" data-level="3.8" id="streams"><span class="secno">3.8. </span><span class="content">Streams</span><a class="self-link" href="#streams"></a></h3>
   <p class="note no-backref" role="note">This section might be integrated into other standards, such as IDL. </p>
   <h4 class="heading settled" data-level="3.8.1" id="readablestream"><span class="secno">3.8.1. </span><span class="content">ReadableStream</span><a class="self-link" href="#readablestream"></a></h4>
   <p>A <dfn class="idl-code" data-dfn-type="interface" data-export="" id="concept-readablestream">ReadableStream<a class="self-link" href="#concept-readablestream"></a></dfn> object represents a <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#rs-class">stream of data</a>. In
this section, we define common operations for <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> objects. <a data-link-type="biblio" href="#biblio-streams">[STREAMS]</a> </p>
   <p>To <dfn data-dfn-for="ReadableStream" data-dfn-type="dfn" data-export="" id="concept-enqueue-readablestream">enqueue<a class="self-link" href="#concept-enqueue-readablestream"></a></dfn> <var>chunk</var> into a <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object <var>stream</var>, run these steps: </p>
   <ol>
    <li>
     <p>Call <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readable-stream-default-controller-enqueue">ReadableStreamDefaultControllerEnqueue</a>(<var>stream</var>.[[readableStreamController]], <var>chunk</var>). Rethrow any exceptions. </p>
   </ol>
   <p>To <dfn data-dfn-for="ReadableStream" data-dfn-type="abstract-op" data-export="" id="concept-close-readablestream">close<a class="self-link" href="#concept-close-readablestream"></a></dfn> a <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object <var>stream</var>, run these steps: </p>
   <ol>
    <li>
     <p>Call <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readable-stream-default-controller-close">ReadableStreamDefaultControllerClose</a>(<var>stream</var>.[[readableStreamController]]).
 Rethrow any exceptions. </p>
   </ol>
   <p>To <dfn data-dfn-for="ReadableStream" data-dfn-type="abstract-op" data-export="" id="concept-error-readablestream">error<a class="self-link" href="#concept-error-readablestream"></a></dfn> a <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object <var>stream</var> with given <var>reason</var>, run these steps: </p>
   <ol>
    <li>
     <p>Call <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readable-stream-default-controller-error">ReadableStreamDefaultControllerError</a>(<var>stream</var>.[[readableStreamController]]). <var>reason</var>). Rethrow any exceptions. </p>
   </ol>
   <p>To <dfn data-dfn-for="ReadableStream" data-dfn-type="dfn" data-export="" id="concept-construct-readablestream">construct a <code>ReadableStream</code> object<a class="self-link" href="#concept-construct-readablestream"></a></dfn> with given <var>strategy</var>, <var>pull</var> action and <var>cancel</var> action, all of which
are optional, run these steps: </p>
   <ol>
    <li>
     <p>Let <var>init</var> be a new object. </p>
    <li>
     <p>Set <var>init</var>["pull"] to a function that runs <var>pull</var> if <var>pull</var> is given. </p>
    <li>
     <p>Set <var>init</var>["cancel"] to a function that runs <var>cancel</var> if <var>cancel</var> is given. </p>
    <li>
     <p>Let <var>stream</var> be the result of calling the initial value of <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> as constructor with <var>init</var> and <var>strategy</var> if given. Rethrow any exceptions. </p>
    <li>
     <p>Return <var>stream</var>. </p>
   </ol>
   <p>To <dfn data-dfn-for="ReadableStream" data-dfn-type="dfn" data-export="" id="concept-construct-fixed-readablestream">construct a fixed <code>ReadableStream</code> object<a class="self-link" href="#concept-construct-fixed-readablestream"></a></dfn> with given <var>chunks</var>, run these steps: </p>
   <ol>
    <li>
     <p>Let <var>stream</var> be the result of <a data-link-type="dfn" href="#concept-construct-readablestream">constructing</a> a <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object. Rethrow any exceptions. </p>
    <li>
     <p>For each <var>chunk</var> in <var>chunks</var>, <a data-link-type="dfn" href="#concept-enqueue-readablestream">enqueue</a> <var>chunk</var> into <var>stream</var>. Rethrow any exceptions. </p>
    <li>
     <p><a data-link-type="abstract-op" href="#concept-close-readablestream">Close</a> <var>stream</var>. Rethrow any
 exceptions. </p>
    <li>Return <var>stream</var>. 
   </ol>
   <p>To <dfn data-dfn-for="ReadableStream" data-dfn-type="dfn" data-export="" id="concept-get-reader">get a reader<a class="self-link" href="#concept-get-reader"></a></dfn> from
a <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object <var>stream</var>, run these
steps: </p>
   <ol>
    <li>
     <p>Let <var>reader</var> be the result of calling <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#acquire-readable-stream-reader">AcquireReadableStreamDefaultReader</a>(<var>stream</var>).
 Rethrow any exceptions. </p>
    <li>
     <p>Return <var>reader</var>. </p>
   </ol>
   <p>To <dfn data-dfn-for="ReadableStream" data-dfn-type="dfn" data-export="" id="concept-read-chunk-from-readablestream">read a chunk<a class="self-link" href="#concept-read-chunk-from-readablestream"></a></dfn> from a <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object with <var>reader</var>,
return the result of calling <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readable-stream-default-reader-read">ReadableStreamDefaultReaderRead</a>(<var>reader</var>). </p>
   <p>To <dfn data-dfn-for="ReadableStream" data-dfn-type="dfn" data-export="" id="concept-read-all-bytes-from-readablestream">read all bytes<a class="self-link" href="#concept-read-all-bytes-from-readablestream"></a></dfn> from a <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object with <var>reader</var>, run
these steps: </p>
   <ol>
    <li>
     <p>Let <var>promise</var> be a new promise. </p>
    <li>
     <p>Let <var>bytes</var> be an empty byte sequence. </p>
    <li>
     <p>Let <var>read</var> be the result of calling <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readable-stream-default-reader-read">ReadableStreamDefaultReaderRead</a>(<var>reader</var>). </p>
     <ul>
      <li>
       <p>When <var>read</var> is fulfilled with an object whose <code>done</code> property is false and whose <code>value</code> property is a <code>Uint8Array</code> object, append the <code>value</code> property to <var>bytes</var> and run the above step again. </p>
      <li>
       <p>When <var>read</var> is fulfilled with an object whose <code>done</code> property is true, resolve <var>promise</var> with <var>bytes</var>. </p>
      <li>
       <p>When <var>read</var> is fulfilled with a value that matches with neither of the
  above patterns, reject <var>promise</var> with a <code>TypeError</code>. </p>
      <li>
       <p>When <var>read</var> is rejected with an error, reject <var>promise</var> with that error. </p>
     </ul>
    <li>
     <p>Return <var>promise</var>. </p>
   </ol>
   <p>To <dfn data-dfn-for="ReadableStream" data-dfn-type="dfn" data-export="" id="concept-cancel-readablestream">cancel<a class="self-link" href="#concept-cancel-readablestream"></a></dfn> a <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object with <var>reader</var> and <var>reason</var>, return the result of calling <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readable-stream-cancel">ReadableStreamCancel</a>(<var>reader</var>, <var>reason</var>). </p>
   <p class="note no-backref" role="note">Because the reader grants exclusive access, the actual mechanism of how
to read cannot be observed. Implementations could use more direct mechanism if convenient. </p>
   <p>To <dfn data-dfn-for="ReadableStream" data-dfn-type="dfn" data-export="" id="concept-tee-readablestream">tee<a class="self-link" href="#concept-tee-readablestream"></a></dfn> a <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object <var>stream</var>, run these steps: </p>
   <ol>
    <li>
     <p>Return the result of calling <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readable-stream-tee">ReadableStreamTee</a>(<var>stream</var>, true).
 Rethrow any exception. </p>
   </ol>
   <p>An <dfn data-dfn-type="dfn" data-export="" id="concept-empty-readablestream">empty<a class="self-link" href="#concept-empty-readablestream"></a></dfn> <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object is the result of <a data-link-type="dfn" href="#concept-construct-fixed-readablestream">constructing</a> a fixed <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object with an empty list. </p>
   <p class="note no-backref" role="note">Constructing an <a data-link-type="dfn" href="#concept-empty-readablestream">empty</a> <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object will not throw an exception. </p>
   <p>A <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object <var>stream</var> is said to be <dfn data-dfn-for="ReadableStream" data-dfn-type="dfn" data-export="" id="concept-readablestream-readable">readable<a class="self-link" href="#concept-readablestream-readable"></a></dfn> if <var>stream</var>.[[state]] is "readable". </p>
   <p>A <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object <var>stream</var> is said to be <dfn data-dfn-for="ReadableStream" data-dfn-type="dfn" data-export="" id="concept-readablestream-closed">closed<a class="self-link" href="#concept-readablestream-closed"></a></dfn> if <var>stream</var>.[[state]] is "closed". </p>
   <p>A <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object <var>stream</var> is said to be <dfn data-dfn-for="ReadableStream" data-dfn-type="dfn" data-export="" id="concept-readablestream-errored">errored<a class="self-link" href="#concept-readablestream-errored"></a></dfn> if <var>stream</var>.[[state]] is "errored". </p>
   <p>A <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object <var>stream</var> is said to be <dfn data-dfn-for="ReadableStream" data-dfn-type="dfn" data-export="" id="concept-readablestream-locked">locked<a class="self-link" href="#concept-readablestream-locked"></a></dfn> if the
result of calling <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#is-readable-stream-locked">IsReadableStreamLocked</a>(<var>stream</var>) is
true. </p>
   <p>A <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object <var>stream</var> is said to <dfn data-dfn-for="ReadableStream" data-dfn-type="dfn" data-export="" id="concept-readablestream-need-more-data">need more data<a class="self-link" href="#concept-readablestream-need-more-data"></a></dfn> if the following conditions hold: </p>
   <ul>
    <li>
     <p><var>stream</var> is <a data-link-type="dfn" href="#concept-readablestream-readable">readable</a>. </p>
    <li>
     <p>The result of calling <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readable-stream-default-controller-get-desired-size">ReadableStreamDefaultControllerGetDesiredSize</a>(<var>stream</var>.[[readableStreamController]]).
 is positive. </p>
   </ul>
   <p>A <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object <var>stream</var> is said to be <dfn data-dfn-for="ReadableStream" data-dfn-type="dfn" data-export="" id="concept-readablestream-disturbed">disturbed<a class="self-link" href="#concept-readablestream-disturbed"></a></dfn> if the result of calling <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#is-readable-stream-disturbed">IsReadableStreamDisturbed</a>(<var>stream</var>) is true. </p>
   <h2 class="heading settled" data-level="4" id="http-extensions"><span class="secno">4. </span><span class="content">HTTP extensions</span><a class="self-link" href="#http-extensions"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="origin-header"><span class="secno">4.1. </span><span class="content">`<code>Origin</code>` header</span><a class="self-link" href="#origin-header"></a></h3>
   <p>The `<dfn data-dfn-type="http-header" data-export="" id="http-origin"><code>Origin</code><a class="self-link" href="#http-origin"></a></dfn>`
request <a data-link-type="dfn" href="#concept-header">header</a> indicates where a <a data-link-type="dfn" href="#concept-fetch">fetch</a> originates from. </p>
   <p class="note no-backref" role="note">The `<a data-link-type="http-header" href="#http-origin"><code>Origin</code></a>` header is a version
of the `<code>Referer</code>` [sic] header that does not reveal a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path">path</a>. It is used for
all <a data-link-type="dfn" href="#concept-http-fetch">HTTP fetches</a> whose <i>CORS flag</i> is
set as well as those where <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-method">method</a> is `<code>POST</code>`. Due to
compatibility constraints it is not included in all <a data-link-type="dfn" href="#concept-fetch">fetches</a>. </p>
   <p>Its <a data-link-type="dfn" href="#concept-header-value">value</a> ABNF: </p>
<pre>Origin                           = origin-or-null

origin-or-null                   = origin / %x6E.75.6C.6C ; "null", case-sensitive
origin                           = <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> "://" <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host">host</a> [ ":" <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-port">port</a> ]</pre>
   <p class="note no-backref" role="note">This supplants the `<code>Origin</code>` <a data-link-type="dfn" href="#concept-header">header</a>. <a data-link-type="biblio" href="#biblio-origin">[ORIGIN]</a> </p>
   <h3 class="heading settled" data-level="4.2" id="http-cors-protocol"><span class="secno">4.2. </span><span class="content">CORS protocol</span><a class="self-link" href="#http-cors-protocol"></a></h3>
   <p>To allow sharing responses cross-origin and allow for more versatile <a data-link-type="dfn" href="#concept-fetch">fetches</a> than possible with HTML’s <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/forms.html#the-form-element">form</a></code> element, the <dfn data-dfn-type="dfn" data-export="" id="cors-protocol">CORS protocol<a class="self-link" href="#cors-protocol"></a></dfn> exists. It
is layered on top of HTTP and allows responses to declare they can be shared with other <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">origin</a>. </p>
   <p class="note" role="note">It needs to be an opt-in mechanism to prevent leaking data from responses behind a
firewall (intranets). Additionally, for <a data-link-type="dfn" href="#concept-request">requests</a> including <a data-link-type="dfn" href="#credentials">credentials</a> it needs to be opt-in to prevent leaking potentially-sensitive data. </p>
   <p>This section explains the <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a> as it pertains to server developers.
Requirements for user agents are part of the <a data-link-type="dfn" href="#concept-fetch">fetch</a> algorithm,
except for the <a href="#http-new-header-syntax">new HTTP header syntax</a>. </p>
   <h4 class="heading settled" data-level="4.2.1" id="general"><span class="secno">4.2.1. </span><span class="content">General</span><a class="self-link" href="#general"></a></h4>
   <p>The <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a> consists of a set of headers that indicates whether a response can
be shared cross-origin. </p>
   <p>For <a data-link-type="dfn" href="#concept-request">requests</a> that are more involved than what is possible with
HTML’s <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/forms.html#the-form-element">form</a></code> element, a <a data-link-type="dfn" href="#cors-preflight-request">CORS-preflight request</a> is
performed, to ensure <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a> supports the <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a>. </p>
   <h4 class="heading settled" data-level="4.2.2" id="http-requests"><span class="secno">4.2.2. </span><span class="content">HTTP requests</span><a class="self-link" href="#http-requests"></a></h4>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="cors-request">CORS request<a class="self-link" href="#cors-request"></a></dfn> is an HTTP request that includes an
`<a data-link-type="http-header" href="#http-origin"><code>Origin</code></a>` header. It cannot be reliably identified as particpating in
the <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a> as the `<a data-link-type="http-header" href="#http-origin"><code>Origin</code></a>` header is sometimes
included for other purposes too. </p>
   <p>A <dfn data-dfn-type="dfn" data-export="" id="cors-preflight-request">CORS-preflight request<a class="self-link" href="#cors-preflight-request"></a></dfn> is a <a data-link-type="dfn" href="#cors-request">CORS request</a> that checks to see
if the <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a> is understood. It uses `<code>OPTIONS</code>` as <a data-link-type="dfn" href="#concept-method">method</a> and includes these <a data-link-type="dfn" href="#concept-header">headers</a>: </p>
   <dl>
    <dt>`<dfn data-dfn-type="dfn" data-export="" id="http-access-control-request-method" type="http-header"><code>Access-Control-Request-Method</code><a class="self-link" href="#http-access-control-request-method"></a></dfn>` 
    <dd>
     <p>Indicates which <a data-link-type="dfn" href="#concept-method">method</a> a future <a data-link-type="dfn" href="#cors-request">CORS request</a> to the same resource might use. </p>
    <dt>`<dfn data-dfn-type="dfn" data-export="" id="http-access-control-request-headers" type="http-header"><code>Access-Control-Request-Headers</code><a class="self-link" href="#http-access-control-request-headers"></a></dfn>` 
    <dd>
     <p>Indicates which <a data-link-type="dfn" href="#concept-header">headers</a> a future <a data-link-type="dfn" href="#cors-request">CORS request</a> to the same resource might use. </p>
   </dl>
   <h4 class="heading settled" data-level="4.2.3" id="http-responses"><span class="secno">4.2.3. </span><span class="content">HTTP responses</span><a class="self-link" href="#http-responses"></a></h4>
   <p>An HTTP response to a <a data-link-type="dfn" href="#cors-request">CORS request</a> can include the following <a data-link-type="dfn" href="#concept-header">headers</a>: </p>
   <dl>
    <dt>`<dfn data-dfn-type="dfn" data-export="" id="http-access-control-allow-origin" type="http-header"><code>Access-Control-Allow-Origin</code><a class="self-link" href="#http-access-control-allow-origin"></a></dfn>` 
    <dd>
     <p>Indicates whether the response can be shared, via returning the literal <a data-link-type="dfn" href="#concept-header-value">value</a> of the
 `<a data-link-type="http-header" href="#http-origin"><code>Origin</code></a>` request <a data-link-type="dfn" href="#concept-header">header</a> (which can be `<code>null</code>`) or `<code>*</code>` in a response. </p>
    <dt>`<dfn data-dfn-type="dfn" data-export="" id="http-access-control-allow-credentials" type="http-header"><code>Access-Control-Allow-Credentials</code><a class="self-link" href="#http-access-control-allow-credentials"></a></dfn>` 
    <dd>
     <p>Indicates whether the response can be shared when <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is
  "<code>include</code>". </p>
     <p class="note" role="note">For a <a data-link-type="dfn" href="#cors-preflight-request">CORS-preflight request</a>, <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is always
  "<code>omit</code>", but for any subsequent <a data-link-type="dfn" href="#cors-request">CORS requests</a> it might not be. Support therefore needs
  to be indicated as part of the HTTP response to the <a data-link-type="dfn" href="#cors-preflight-request">CORS-preflight request</a> as well. </p>
   </dl>
   <p>An HTTP response to a <a data-link-type="dfn" href="#cors-preflight-request">CORS-preflight request</a> can include the following <a data-link-type="dfn" href="#concept-header">headers</a>: </p>
   <dl>
    <dt>`<dfn data-dfn-type="dfn" data-export="" id="http-access-control-allow-methods" type="http-header"><code>Access-Control-Allow-Methods</code><a class="self-link" href="#http-access-control-allow-methods"></a></dfn>` 
    <dd>
     <p>Indicates which <a data-link-type="dfn" href="#concept-method">methods</a> are supported by the <a data-link-type="dfn" href="#concept-response">response</a>’s <a data-link-type="dfn" href="#concept-response-url">url</a> for the
  purposes of the <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a>. </p>
     <p class="note" role="note">The `<code>Allow</code>` <a data-link-type="dfn" href="#concept-header">header</a> is
  not relevant for the purposes of the <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a>. </p>
    <dt>`<dfn data-dfn-type="dfn" data-export="" id="http-access-control-allow-headers" type="http-header"><code>Access-Control-Allow-Headers</code><a class="self-link" href="#http-access-control-allow-headers"></a></dfn>` 
    <dd>
     <p>Indicates which <a data-link-type="dfn" href="#concept-header">headers</a> are supported by the <a data-link-type="dfn" href="#concept-response">response</a>’s <a data-link-type="dfn" href="#concept-response-url">url</a> for the
 purposes of the <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a>. </p>
    <dt>`<dfn data-dfn-type="dfn" data-export="" id="http-access-control-max-age" type="http-header"><code>Access-Control-Max-Age</code><a class="self-link" href="#http-access-control-max-age"></a></dfn>` 
    <dd>
     <p>Indicates how long the information provided by the
 `<a data-link-type="dfn" href="#http-access-control-allow-methods"><code>Access-Control-Allow-Methods</code></a>` and
 `<a data-link-type="dfn" href="#http-access-control-allow-headers"><code>Access-Control-Allow-Headers</code></a>` <a data-link-type="dfn" href="#concept-header">headers</a> can be cached. </p>
   </dl>
   <p>An HTTP response to a <a data-link-type="dfn" href="#cors-request">CORS request</a> that is not a <a data-link-type="dfn" href="#cors-preflight-request">CORS-preflight request</a> can also include the following <a data-link-type="dfn" href="#concept-header">header</a>: </p>
   <dl>
    <dt>`<dfn data-dfn-type="dfn" data-export="" id="http-access-control-expose-headers" type="http-header"><code>Access-Control-Expose-Headers</code><a class="self-link" href="#http-access-control-expose-headers"></a></dfn>` 
    <dd>
     <p>Indicates which <a data-link-type="dfn" href="#concept-header">headers</a> can be exposed as part
 of the response by listing their <a data-link-type="dfn" href="#concept-header-name">names</a>. </p>
   </dl>
   <h4 class="heading settled" data-level="4.2.4" id="http-new-header-syntax"><span class="secno">4.2.4. </span><span class="content">HTTP new-header syntax</span><a class="self-link" href="#http-new-header-syntax"></a></h4>
   <p>ABNF for the <a data-link-type="dfn" href="#concept-header-value">values</a> of the <a data-link-type="dfn" href="#concept-header">headers</a> used by the <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a>: </p>
<pre>Access-Control-Request-Method    = <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.1.1">method</a>
Access-Control-Request-Headers   = #<a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.2">field-name</a>

wildcard                         = "*"
Access-Control-Allow-Origin      = origin-or-null / wildcard
Access-Control-Allow-Credentials = %x74.72.75.65 ; "true", case-sensitive
Access-Control-Expose-Headers    = #<a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.2">field-name</a> / wildcard
Access-Control-Max-Age           = <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7234#section-1.2.1">delta-seconds</a>
Access-Control-Allow-Methods     = #<a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.1.1">method</a> / wildcard
Access-Control-Allow-Headers     = #field-name-or-wildcard
field-name-or-wildcard           = <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.2">field-name</a> / wildcard</pre>
   <p class="note" role="note">The difference between the <code>Access-Control-Expose-Headers</code> and <code>Access-Control-Allow-Headers</code> production is that the latter needs to be able to
handle `<code>*, Authorization</code>` as header value whereas the former does not. </p>
   <h4 class="heading settled" data-level="4.2.5" id="cors-protocol-and-credentials"><span class="secno">4.2.5. </span><span class="content">CORS protocol and credentials</span><a class="self-link" href="#cors-protocol-and-credentials"></a></h4>
   <p>When <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is "<code>include</code>" it
has an impact on the functioning of the <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a> other than including <a data-link-type="dfn" href="#credentials">credentials</a> in the <a data-link-type="dfn" href="#concept-fetch">fetch</a>. </p>
   <div class="example" id="example-xhr-credentials">
    <a class="self-link" href="#example-xhr-credentials"></a> 
    <p>In the old days, <code class="idl"><a data-link-type="idl" href="https://xhr.spec.whatwg.org/#xmlhttprequest">XMLHttpRequest</a></code> could be used to set <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> to "<code>include</code>": </p>
<pre>var client = new XMLHttpRequest()
client.open("GET", "./")
client.withCredentials = true
/* … */</pre>
    <p>Nowadays, <code>fetch("./", { credentials:"include" }).then(/* … */)</code> suffices. </p>
   </div>
   <p>A <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is not necessarily observable
on the server; only when <a data-link-type="dfn" href="#credentials">credentials</a> exist for a <a data-link-type="dfn" href="#concept-request">request</a> can it be observed by virtue of the <a data-link-type="dfn" href="#credentials">credentials</a> being included. Note that even so, a <a data-link-type="dfn" href="#cors-preflight-request">CORS-preflight request</a> never includes <a data-link-type="dfn" href="#credentials">credentials</a>. </p>
   <p>The server developer therefore needs to decide whether or not responses "tainted" with <a data-link-type="dfn" href="#credentials">credentials</a> can be shared. And also needs to decide if <a data-link-type="dfn" href="#concept-request">requests</a> necessitating a <a data-link-type="dfn" href="#cors-preflight-request">CORS-preflight request</a> can
include <a data-link-type="dfn" href="#credentials">credentials</a>. Generally speaking, both sharing responses and allowing requests
with <a data-link-type="dfn" href="#credentials">credentials</a> is rather unsafe, and extreme care has to be taken to avoid the <a href="https://en.wikipedia.org/wiki/Confused_deputy_problem">confused deputy problem</a>. </p>
   <p>To share responses with <a data-link-type="dfn" href="#credentials">credentials</a>, the
`<a data-link-type="dfn" href="#http-access-control-allow-origin"><code>Access-Control-Allow-Origin</code></a>` and
`<a data-link-type="dfn" href="#http-access-control-allow-credentials"><code>Access-Control-Allow-Credentials</code></a>` <a data-link-type="dfn" href="#concept-header">headers</a> are important. The following table serves to illustrate
the various legal and illegal combinations for a request to <code>https://rabbit.invalid/</code>: </p>
   <table>
    <tbody>
     <tr>
      <th>Request’s credentials mode 
      <th>`<code>Access-Control-Allow-Origin</code>` 
      <th>`<code>Access-Control-Allow-Credentials</code>` 
      <th>Shared? 
      <th>Notes 
     <tr>
      <td>"<code>omit</code>" 
      <td>`<code>*</code>` 
      <td>Omitted 
      <td>✅ 
      <td>—<wbr>
     <tr>
      <td>"<code>omit</code>" 
      <td>`<code>*</code>` 
      <td>`<code>true</code>` 
      <td>✅ 
      <td>If credentials mode is not "<code>include</code>", then
  `<a data-link-type="dfn" href="#http-access-control-allow-credentials"><code>Access-Control-Allow-Credentials</code></a>` is
  ignored. 
     <tr>
      <td>"<code>omit</code>" 
      <td>`<code>https://rabbit.invalid/`</code> 
      <td>Omitted 
      <td>❌ 
      <td>A serialized origin has no trailing slash. 
     <tr>
      <td>"<code>omit</code>" 
      <td>`<code>https://rabbit.invalid`</code> 
      <td>Omitted 
      <td>✅ 
      <td>—<wbr>
     <tr>
      <td>"<code>include</code>" 
      <td>`<code>*</code>` 
      <td>`<code>true</code>` 
      <td>❌ 
      <td>If credentials mode is "<code>include</code>", then
  `<a data-link-type="dfn" href="#http-access-control-allow-origin"><code>Access-Control-Allow-Origin</code></a>` cannot be
  `<code>*</code>`. 
     <tr>
      <td>"<code>include</code>" 
      <td>`<code>https://rabbit.invalid`</code> 
      <td>`<code>true</code>` 
      <td>✅ 
      <td>—<wbr>
     <tr>
      <td>"<code>include</code>" 
      <td>`<code>https://rabbit.invalid`</code> 
      <td>`<code>True</code>` 
      <td>❌ 
      <td>`<code>true</code>` is (byte) case-sensitive. 
   </table>
   <p>Similarly, `<a data-link-type="dfn" href="#http-access-control-expose-headers"><code>Access-Control-Expose-Headers</code></a>`,
`<a data-link-type="dfn" href="#http-access-control-allow-methods"><code>Access-Control-Allow-Methods</code></a>`, and
`<a data-link-type="dfn" href="#http-access-control-allow-headers"><code>Access-Control-Allow-Headers</code></a>` response
headers can only use `<code>*</code>` as value when <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is not "<code>include</code>". </p>
   <h4 class="heading settled" data-level="4.2.6" id="cors-protocol-examples"><span class="secno">4.2.6. </span><span class="content">Examples</span><a class="self-link" href="#cors-protocol-examples"></a></h4>
   <div class="example" id="example-simple-cors">
    <a class="self-link" href="#example-simple-cors"></a> 
    <p>A script at <code>https://foo.invalid/</code> wants to fetch some data from <code>https://bar.invalid/</code>. (Neither <a data-link-type="dfn" href="#credentials">credentials</a> nor response header access is
 important.) </p>
<pre id="unicorn">var url = "https://bar.invalid/api?key=730d67a37d7f3d802e96396d00280768773813fbe726d116944d814422fc1a45&amp;data=about:unicorn";
fetch(url).then(success, failure)</pre>
    <p>This will use the <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a>, though this is entirely transparent to the
 developer from <code>foo.invalid</code>. As part of the <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a>, the user agent
 will include the `<a data-link-type="http-header" href="#http-origin"><code>Origin</code></a>` header in the request: </p>
<pre>Origin: https://foo.invalid</pre>
    <p>Upon receiving a response from <code>bar.com</code>, the user agent will verify the
 `<a data-link-type="dfn" href="#http-access-control-allow-origin"><code>Access-Control-Allow-Origin</code></a>` response header.
 If its value is either `<code>https://foo.invalid</code>` or `<code>*</code>`, the user agent will
 invoke the <code>success</code> callback. If it has any other value, or is simply missing, the user
 agent will invoke the <code>failure</code> callback. </p>
   </div>
   <div class="example" id="example-cors-with-response-header">
    <a class="self-link" href="#example-cors-with-response-header"></a> 
    <p>The developer of <code>foo.invalid</code> is back, and now wants to fetch some data from <code>bar.invalid</code> while also accessing a response header. </p>
<pre>fetch(url).then(response => {
  var hsts = response.headers.get("strict-transport-security"),
      csp = response.headers.get("content-security-policy")
  log(hsts, csp)
})</pre>
    <p><code>bar.invalid</code> provides a correct
 `<a data-link-type="dfn" href="#http-access-control-allow-origin"><code>Access-Control-Allow-Origin</code></a>` response header
 per the earlier example. The values of <code>hsts</code> and <code>csp</code> will depend on the
 `<a data-link-type="dfn" href="#http-access-control-expose-headers"><code>Access-Control-Expose-Headers</code></a>` response
 header. For example, if the response included the following headers </p>
<pre>Content-Security-Policy: default-src 'self'
Strict-Transport-Security: max-age=31536000; includeSubdomains; preload
Access-Control-Expose-Headers: Content-Security-Policy</pre>
    <p>then <code>hsts</code> would be null and <code>csp</code> would be
 "<code>default-src 'self'</code>", even though the response did include both headers. This is
 because <code>bar.invalid</code> needs to explicitly share each header by listing their names in
 the `<a data-link-type="dfn" href="#http-access-control-expose-headers"><code>Access-Control-Expose-Headers</code></a>` response
 header. </p>
    <p>Alternatively, if <code>bar.invalid</code> wanted to share all its response headers, for
 requests that do not include <a data-link-type="dfn" href="#credentials">credentials</a>, it could use `<code>*</code>` as value for
 the `<a data-link-type="dfn" href="#http-access-control-expose-headers"><code>Access-Control-Expose-Headers</code></a>` response
 header. If the request would have included <a data-link-type="dfn" href="#credentials">credentials</a>, the response header names
 would have to be listed explicitly and `<code>*</code>` could not be used. </p>
   </div>
   <div class="example" id="example-cors-with-credentials">
    <a class="self-link" href="#example-cors-with-credentials"></a> 
    <p>The developer of <code>foo.invalid</code> returns, now fetching some data from <code>bar.invalid</code> while including <a data-link-type="dfn" href="#credentials">credentials</a>. This time around the <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a> is no longer transparent to the developer as <a data-link-type="dfn" href="#credentials">credentials</a> require an explicit opt-in: </p>
<pre>fetch(url, { credentials:"include" }).then(success, failure)</pre>
    <p>This also makes any `<code>Set-Cookie</code>` response headers <code>bar.invalid</code> includes fully functional (they are ignored otherwise). </p>
    <p>The user agent will make sure to include any relevant <a data-link-type="dfn" href="#credentials">credentials</a> in the request.
 It will also put stricter requirements on the response. Not only will <code>bar.invalid</code> be
 required to list `<code>https://foo.invalid</code>` as value for
 `<a data-link-type="dfn" href="#http-access-control-allow-origin"><code>Access-Control-Allow-Origin</code></a>` (`<code>*</code>`
 is not allowed when <a data-link-type="dfn" href="#credentials">credentials</a> are involved), the
 `<a data-link-type="dfn" href="#http-access-control-allow-credentials"><code>Access-Control-Allow-Credentials</code></a>` has to
 be present too: </p>
<pre>Access-Control-Allow-Origin: https://foo.invalid
Access-Control-Allow-Credentials: true</pre>
    <p>If the response does not include those two headers with those values, the <code>failure</code> callback will be invoked and any `<code>Set-Cookie</code>` response headers will end up being
 ignored. </p>
   </div>
   <h3 class="heading settled" data-level="4.3" id="x-content-type-options-header"><span class="secno">4.3. </span><span class="content">`<code>X-Content-Type-Options</code>` header</span><a class="self-link" href="#x-content-type-options-header"></a></h3>
   <p>The
`<dfn data-dfn-type="dfn" data-export="" id="http-x-content-type-options" type="http-header"><code>X-Content-Type-Options</code><a class="self-link" href="#http-x-content-type-options"></a></dfn>`
response <a data-link-type="dfn" href="#concept-header">header</a> can be used to require checking of a <a data-link-type="dfn" href="#concept-response">response</a>’s `<code>Content-Type</code>` <a data-link-type="dfn" href="#concept-header">header</a> against the <a data-link-type="dfn" href="#concept-request-type">type</a> of a <a data-link-type="dfn" href="#concept-request">request</a>. </p>
   <p>Its <a data-link-type="dfn" href="#concept-header-value">value</a> ABNF: </p>
<pre>X-Content-Type-Options           = "nosniff" ; case-insensitive</pre>
   <h4 class="heading settled" data-dfn-type="dfn" data-level="4.3.1" data-lt="should response to request be blocked due to nosniff" data-noexport="" id="should-response-to-request-be-blocked-due-to-nosniff?"><span class="secno">4.3.1. </span><span class="content">Should <var>response</var> to <var>request</var> be blocked due to nosniff?</span><a class="self-link" href="#should-response-to-request-be-blocked-due-to-nosniff%3F"></a></h4>
   <p>Run these steps: </p>
   <ol>
    <li>
     <p>If <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a> has no <a data-link-type="dfn" href="#concept-header">header</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is
 `<a data-link-type="dfn" href="#http-x-content-type-options"><code>X-Content-Type-Options</code></a>`, return <b>allowed</b>. </p>
    <li>
     <p>Let <var>nosniff</var> be the result of <a data-link-type="dfn" href="#concept-header-parse">parsing</a> the <em>first</em> <a data-link-type="dfn" href="#concept-header">header</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is
 `<a data-link-type="dfn" href="#http-x-content-type-options"><code>X-Content-Type-Options</code></a>` in <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
    <li>
     <p>If <var>nosniff</var> is failure, return <b>allowed</b>. </p>
    <li>
     <p>Let <var>MIMEType</var> be the result of <a data-link-type="dfn" href="#concept-header-extract-mime-type">extracting a MIME type</a> from <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
    <li>
     <p>Let <var>type</var> be <var>request</var>’s <a data-link-type="dfn" href="#concept-request-type">type</a>. </p>
    <li>
     <p class="XXX&quot;">"<code>audio</code>", "<code>video</code>" ... </p>
    <li>
     <p>If <var>type</var> is "<code>image</code>", and <var>MIMEType</var> does <em>not</em> start with `<code>image/</code>`, return <b>blocked</b>. </p>
    <li>
     <p>If <var>type</var> is "<code>font</code>" and <var>MIMEType</var> (ignoring parameters) is <em>not</em> a <a class="XXX" href="https://lists.w3.org/Archives/Public/www-style/2015Apr/0027.html">font MIME type</a>,
 return <b>blocked</b>. </p>
    <li>
     <p>If <var>type</var> is "<code>script</code>", and <var>MIMEType</var> (ignoring parameters) is <em>not</em> a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/scripting.html#javascript-mime-type">JavaScript MIME type</a>,
 return <b>blocked</b>. </p>
    <li>
     <p>If <var>type</var> is "<code>style</code>" and <var>MIMEType</var> (ignoring parameters) is <em>not</em> `<code>text/css</code>`, return <b>blocked</b>. </p>
    <li>
     <p>If <var>type</var> is "<code>track</code>" and <var>MIMEType</var> (ignoring parameters) is <em>not</em> `<code>text/vtt</code>`, return <b>blocked</b>. </p>
    <li>
     <p>Return <b>allowed</b>. </p>
   </ol>
   <h2 class="heading settled" data-level="5" id="fetching"><span class="secno">5. </span><span class="content">Fetching</span><a class="self-link" href="#fetching"></a></h2>
   <div class="note no-backref" role="note">
    <p>The algorithm below defines <a data-link-type="dfn" href="#concept-fetch">fetching</a>. In broad
 strokes, it takes a <a data-link-type="dfn" href="#concept-request">request</a> and outputs a <a data-link-type="dfn" href="#concept-response">response</a>. </p>
    <p>That is, it either returns a <a data-link-type="dfn" href="#concept-response">response</a> if <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#synchronous-flag">synchronous flag</a> is set, or it <a data-link-type="dfn" href="#queue-a-fetch-task">queues tasks</a> annotated <a data-link-type="dfn" href="#process-response">process response</a>, <a data-link-type="dfn" href="#process-response-end-of-body">process response end-of-body</a>, and <a data-link-type="dfn" href="#process-response-done">process response done</a> for the <a data-link-type="dfn" href="#concept-response">response</a>. </p>
    <p>To capture uploads, if <a data-link-type="dfn" href="#concept-request">request</a>’s <a data-link-type="dfn" href="#synchronous-flag">synchronous flag</a> is unset, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">tasks</a> annotated <a data-link-type="dfn" href="#process-request-body">process request body</a> and <a data-link-type="dfn" href="#process-request-end-of-body">process request end-of-body</a> for the <a data-link-type="dfn" href="#concept-request">request</a> can be <a data-link-type="dfn" href="#queue-a-fetch-task">queued</a>. </p>
   </div>
   <p>To perform a <dfn data-dfn-type="dfn" data-export="" id="concept-fetch">fetch<a class="self-link" href="#concept-fetch"></a></dfn> using <var>request</var>, run
the steps below. An ongoing <a data-link-type="dfn" href="#concept-fetch">fetch</a> can be <dfn data-dfn-for="fetch" data-dfn-type="dfn" data-export="" id="concept-fetch-terminate">terminated<a class="self-link" href="#concept-fetch-terminate"></a></dfn> with reason <var>reason</var>, which must be <i>end-user abort</i>, <i>fatal</i>, <i>timeout</i>, or <i>garbage collection</i>. </p>
   <p>The user agent may be asked to <dfn data-dfn-for="fetch" data-dfn-type="dfn" data-export="" id="concept-fetch-suspend">suspend<a class="self-link" href="#concept-fetch-suspend"></a></dfn> the ongoing fetch.
The user agent may either accept or ignore the suspension request. The suspended fetch can be <dfn data-dfn-for="fetch" data-dfn-type="dfn" data-export="" id="concept-fetch-resume">resumed<a class="self-link" href="#concept-fetch-resume"></a></dfn>. The user agent should
ignore the suspension request if the ongoing fetch is updating the response in the HTTP cache for
the request. </p>
   <p class="note no-backref" role="note">The user agent does not update the entry in the HTTP cache for a <a data-link-type="dfn" href="#concept-request">request</a> if request’s cache mode is "no-store" or a
`<code>Cache-Control: no-store</code>` header appears in the response. <a data-link-type="biblio" href="#biblio-http-caching">[HTTP-CACHING]</a> </p>
   <ol>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-window">window</a> is
 "<code>client</code>", set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-window">window</a> to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-client">client</a>, if <var>request</var>’s <a data-link-type="dfn" href="#concept-request-client">client</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global">global object</a> is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/browsers.html#window">Window</a></code> object, and to "<code>no-window</code>"
 otherwise. </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-origin">origin</a> is
 "<code>client</code>", set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-origin">origin</a> to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-client">client</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin">origin</a>. </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a> does not
  contain a <a data-link-type="dfn" href="#concept-header">header</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is `<code>Accept</code>`, run these substeps: </p>
     <ol>
      <li>
       <p>Let <var>value</var> be `<code>*/*</code>`. </p>
      <li>
       <p>If <var>request</var> is a <a data-link-type="dfn" href="#navigation-request">navigation request</a>, a user agent should set <var>value</var> to
   `<code>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</code>`. </p>
      <li>
       <p>Otherwise, a user agent should set <var>value</var> to the first matching statement, if any,
    switching on <var>request</var>’s <a data-link-type="dfn" href="#concept-request-type">type</a>: </p>
       <dl class="switch">
        <dt>"<code>image</code>" 
        <dd>`<code>image/png,image/svg+xml,image/*;q=0.8,*/*;q=0.5</code>` 
        <dt>"<code>style</code>" 
        <dd>`<code>text/css,*/*;q=0.1</code>` 
       </dl>
      <li>
       <p><a data-link-type="dfn" href="#concept-header-list-append">Append</a> `<code>Accept</code>`/<var>value</var> to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
     </ol>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a> does not
 contain a <a data-link-type="dfn" href="#concept-header">header</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is
 `<code>Accept-Language</code>`, user agents should <a data-link-type="dfn" href="#concept-header-list-append">append</a> `<code>Accept-Language</code>`/an appropriate <a data-link-type="dfn" href="#concept-header-value">value</a> to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-priority">priority</a> is
  null, use <var>request</var>’s <a data-link-type="dfn" href="#concept-request-initiator">initiator</a>, <a data-link-type="dfn" href="#concept-request-type">type</a>, and <a data-link-type="dfn" href="#concept-request-destination">destination</a> appropriately in setting it to a user-agent-defined object. </p>
     <p class="note" role="note">The user-agent-defined object could encompass stream weight and dependency
  for HTTP/2, and equivalent information used to prioritize dispatch and processing of
  HTTP/1 fetches. </p>
    <li>
     <p>If <var>request</var> is a <a data-link-type="dfn" href="#navigation-request">navigation request</a>, a user agent should, for each <a data-link-type="dfn" href="#concept-header">header</a> <a data-link-type="dfn" href="#concept-header-name">name</a> (<var>hint-name</var>) in the first column of the following table, if <var>hint-name</var> is not in <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>, <a data-link-type="dfn" href="#concept-header-list-append">append</a> <var>hint-name</var>/<var>hint-value</var> given in the same row on the second column, to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
     <table>
      <tbody>
       <tr>
        <th>hint-name 
        <th>hint-value 
       <tr>
        <td>`<code>dpr</code>` 
        <td>a suitable <a href="http://httpwg.org/http-extensions/client-hints.html#dpr">dpr value</a> 
       <tr>
        <td>`<code>save-data</code>` 
        <td>a suitable <a href="http://httpwg.org/http-extensions/client-hints.html#save-data">save-data value</a> 
       <tr>
        <td>`<code>viewport-width</code>` 
        <td>a suitable <a href="http://httpwg.org/http-extensions/client-hints.html#viewport-width">viewport-width value</a> 
     </table>
    <li>
     <p>If <var>request</var> is a <a data-link-type="dfn" href="#subresource-request">subresource request</a>, run these substeps: </p>
     <ol>
      <li>
       <p>If the <var>request</var>’s <a data-link-type="dfn" href="#concept-client-hints-list">client hints list</a> is
    not empty, then run these substeps for each <var>hint-name</var> in the list: </p>
       <ol>
        <li>
         <p>Set <var>value</var> to the first matching statement, if any, switching on <var>hint-name</var>: </p>
         <dl class="switch">
          <dt>"<code>dpr</code>" 
          <dd>a suitable <a href="http://httpwg.org/http-extensions/client-hints.html#dpr">dpr value</a> 
          <dt>"<code>save-data</code>" 
          <dd>a suitable <a href="http://httpwg.org/http-extensions/client-hints.html#save-data">save-data value</a> 
          <dt>"<code>viewport-width</code>" 
          <dd>a suitable <a href="http://httpwg.org/http-extensions/client-hints.html#viewport-width">viewport-width value</a> 
          <dt>"<code>width</code>" 
          <dd>a suitable <a href="http://httpwg.org/http-extensions/client-hints.html#width">width value</a> 
         </dl>
        <li>
         <p><a data-link-type="dfn" href="#concept-header-list-append">Append</a> <var>hint-name</var>/<var>value</var> to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
       </ol>
      <li>
       <p>Let <var>record</var> be a new <a data-link-type="dfn" href="#concept-fetch-record">fetch record</a> consisting of <var>request</var> and this instance of the <a data-link-type="dfn" href="#concept-fetch">fetch</a> algorithm. </p>
      <li>
       <p>Append <var>record</var> to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-client">client</a>’s <a data-link-type="dfn" href="#concept-fetch-group">fetch group</a> list of <a data-link-type="dfn" href="#concept-fetch-record">fetch records</a>. </p>
     </ol>
    <li>
     <p>Return the result of performing a <a data-link-type="dfn" href="#concept-main-fetch">main fetch</a> using <var>request</var>. </p>
   </ol>
   <h3 class="heading settled" data-level="5.1" id="main-fetch"><span class="secno">5.1. </span><span class="content">Main fetch</span><a class="self-link" href="#main-fetch"></a></h3>
   <p>To perform a <dfn data-dfn-for="main" data-dfn-type="dfn" data-noexport="" id="concept-main-fetch">main fetch<a class="self-link" href="#concept-main-fetch"></a></dfn> using <var>request</var>, optionally
with a <i>CORS flag</i> and <i>recursive flag</i>, run these steps: </p>
   <p class="note" role="note">When <a data-link-type="dfn" href="#concept-main-fetch">main fetch</a> is invoked recursively <i>recursive flag</i> is set. <i>CORS flag</i> is a bookkeeping detail for handling redirects. </p>
   <ol>
    <li>
     <p>Let <var>response</var> be null. </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#local-urls-only-flag">local-URLs-only flag</a> is set and <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a> is
 not <a data-link-type="dfn" href="https://url.spec.whatwg.org/#is-local">local</a>, set <var>response</var> to a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
    <li>
     <p>Execute <a href="https://w3c.github.io/webappsec-csp/#report-for-request">Report Content Security Policy violations for <var>request</var></a>. <a data-link-type="biblio" href="#biblio-csp">[CSP]</a> </p>
    <li>
     <p><a href="https://w3c.github.io/webappsec-upgrade-insecure-requests/#upgrade-request">Upgrade <var>request</var> to a potentially secure URL, if appropriate</a>. <a data-link-type="biblio" href="#biblio-upgrade">[UPGRADE]</a> </p>
    <li>
     <p>If <a data-link-type="dfn" href="#block-bad-port">should fetching <var>request</var> be blocked due to a bad port</a>, <a href="https://w3c.github.io/webappsec-mixed-content/#should-block-fetch">should fetching <var>request</var> be blocked as mixed content</a>,
 or <a href="https://w3c.github.io/webappsec-csp/#should-block-request">should fetching <var>request</var> be blocked by Content Security Policy</a> returns <b>blocked</b>, set <var>response</var> to a <a data-link-type="dfn" href="#concept-network-error">network error</a>. <a data-link-type="biblio" href="#biblio-mix">[MIX]</a> <a data-link-type="biblio" href="#biblio-csp">[CSP]</a> </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer-policy">referrer policy</a> is the empty string and <var>request</var>’s <a data-link-type="dfn" href="#concept-request-client">client</a> is non-null, then set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer-policy">referrer policy</a> to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-client">client</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">referrer policy</a>. <a data-link-type="biblio" href="#biblio-referrer">[REFERRER]</a> </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer-policy">referrer policy</a> is the empty string, then set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer-policy">referrer policy</a> to
  "<code>no-referrer-when-downgrade</code>". </p>
     <p class="note no-backref" role="note">We use "<code>no-referrer-when-downgrade</code>" because it is the
  historical default. </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer">referrer</a> is not "<code>no-referrer</code>", set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer">referrer</a> to the result of invoking <a data-link-type="dfn" href="https://w3c.github.io/webappsec-referrer-policy/#determine-requests-referrer">determine <var>request</var>’s referrer</a>. <a data-link-type="biblio" href="#biblio-referrer">[REFERRER]</a> </p>
     <p class="note no-backref" role="note">As stated in <cite>Referrer Policy</cite>, user agents can
  provide the end user with options to override <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer">referrer</a> to "<code>no-referrer</code>" or
  have it expose less sensitive information. </p>
    <li>
     <p>Set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> to "<code>https</code>" if
  all of the following conditions are true: </p>
     <ul class="brief">
      <li><var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> is "<code>http</code>" 
      <li><var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host">host</a> is a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-domain">domain</a> 
      <li>Matching <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host">host</a> per <a href="https://tools.ietf.org/html/rfc6797#section-8.2">Known HSTS Host Domain Name Matching</a> results in either a superdomain match with an asserted <code>includeSubDomains</code> directive or a congruent match (with or without an asserted <code>includeSubDomains</code> directive) <a data-link-type="biblio" href="#biblio-hsts">[HSTS]</a> 
     </ul>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#synchronous-flag">synchronous flag</a> is unset and <i>recursive flag</i> is unset, run the remaining steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a>. </p>
    <li>
     <p>If <var>response</var> is null, then set <var>response</var> to the result of running the
  substeps corresponding to the first matching statement: </p>
     <dl class="switch">
      <dt><var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin">origin</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-origin">origin</a> and <i>CORS flag</i> is unset 
      <dt><var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> is "<code>data</code>" 
      <dt><var>request</var>’s <a data-link-type="dfn" href="#concept-request-mode">mode</a> is
   "<code>navigate</code>" or "<code>websocket</code>" 
      <dd>
       <ol>
        <li>
         <p>Set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-response-tainting">response tainting</a> to "<code>basic</code>". </p>
        <li>
         <p>Return the result of performing a <a data-link-type="dfn" href="#concept-basic-fetch">basic fetch</a> using <var>request</var>. </p>
       </ol>
       <p class="note no-backref" role="note">HTML assigns any documents and workers created from <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url">URLs</a> whose <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> is "<code>data</code>" a unique <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque">opaque origin</a>. Service
    workers can only be created from <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url">URLs</a> whose <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> is an <a data-link-type="dfn" href="https://url.spec.whatwg.org/#http-scheme">HTTP(S) scheme</a>. <a data-link-type="biblio" href="#biblio-html">[HTML]</a> <a data-link-type="biblio" href="#biblio-sw">[SW]</a> </p>
      <dt><var>request</var>’s <a data-link-type="dfn" href="#concept-request-mode">mode</a> is
   "<code>same-origin</code>" 
      <dd>
       <p>Return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
      <dt><var>request</var>’s <a data-link-type="dfn" href="#concept-request-mode">mode</a> is
   "<code>no-cors</code>" 
      <dd>
       <ol>
        <li>
         <p>Set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-response-tainting">response tainting</a> to
     "<code>opaque</code>". </p>
        <li>
         <p>Return the result of performing a <a data-link-type="dfn" href="#concept-basic-fetch">basic fetch</a> using <var>request</var>. </p>
       </ol>
      <dt><var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> is <em>not</em> an <a data-link-type="dfn" href="https://url.spec.whatwg.org/#http-scheme">HTTP(S) scheme</a> 
      <dd>
       <p>Return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
      <dt><var>request</var>’s <a data-link-type="dfn" href="#use-cors-preflight-flag">use-CORS-preflight flag</a> is set 
      <dt><var>request</var>’s <a data-link-type="dfn" href="#unsafe-request-flag">unsafe-request flag</a> is set and either <var>request</var>’s <a data-link-type="dfn" href="#concept-request-method">method</a> is not a <a data-link-type="dfn" href="#cors-safelisted-method">CORS-safelisted method</a> or
   a <a data-link-type="dfn" href="#concept-header">header</a> in <var>request</var>’s <a data-link-type="dfn" href="#concept-header-list">header list</a> is not a <a data-link-type="dfn" href="#cors-safelisted-request-header">CORS-safelisted request-header</a> 
      <dd>
       <ol>
        <li>
         <p>Set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-response-tainting">response tainting</a> to
     "<code>cors</code>". </p>
        <li>
         <p>Let <var>corsWithPreflightResponse</var> be the result of performing an <a data-link-type="dfn" href="#concept-http-fetch">HTTP fetch</a> using <var>request</var> with <i>CORS flag</i> and <i>CORS-preflight flag</i> set. </p>
        <li>
         <p>If <var>corsWithPreflightResponse</var> is a <a data-link-type="dfn" href="#concept-network-error">network error</a>, then <a data-link-type="dfn" href="#concept-cache-clear">clear cache entries</a> using <var>request</var>. </p>
        <li>
         <p>Return <var>corsWithPreflightResponse</var>. </p>
       </ol>
      <dt>Otherwise 
      <dd>
       <ol>
        <li>
         <p>Set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-response-tainting">response tainting</a> to
     "<code>cors</code>". </p>
        <li>
         <p>Return the result of performing an <a data-link-type="dfn" href="#concept-http-fetch">HTTP fetch</a> using <var>request</var> with <i>CORS flag</i> set. </p>
       </ol>
     </dl>
    <li>
     <p>If the <i>recursive flag</i> is set, return <var>response</var>. </p>
    <li>
     <p>If <var>response</var> is not a <a data-link-type="dfn" href="#concept-network-error">network error</a> and <var>response</var> is not a <a data-link-type="dfn" href="#concept-filtered-response">filtered response</a>, then
  run these substeps: </p>
     <ol>
      <li>
       <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-response-tainting">response tainting</a> is
    "<code>cors</code>", then run these substeps: </p>
       <ol>
        <li>
         <p>Let <var>headerNames</var> be the result of <a data-link-type="dfn" href="#concept-header-parse">parsing</a> `<a data-link-type="dfn" href="#http-access-control-expose-headers"><code>Access-Control-Expose-Headers</code></a>` in <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
        <li>
         <p>If <var>headerNames</var> is `<code>*</code>` and <var>request</var>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is not
     "<code>include</code>", then set <var>response</var>’s <a data-link-type="dfn" href="#concept-response-cors-exposed-header-name-list">CORS-exposed header-name list</a> to all unique <a data-link-type="dfn" href="#concept-header">header</a> <a data-link-type="dfn" href="#concept-header-name">names</a> in <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
        <li>
         <p>Otherwise, if <var>headerNames</var> is <em>not</em> `<code>*</code>`, then set <var>response</var>’s <a data-link-type="dfn" href="#concept-response-cors-exposed-header-name-list">CORS-exposed header-name list</a> to <var>headerNames</var>. </p>
       </ol>
      <li>
       <p>Set <var>response</var> to the following <a data-link-type="dfn" href="#concept-filtered-response">filtered response</a> with <var>response</var> as its <a data-link-type="dfn" href="#concept-internal-response">internal response</a>, depending on <var>request</var>’s <a data-link-type="dfn" href="#concept-request-response-tainting">response tainting</a>: </p>
       <dl class="switch compact">
        <dt>"<code>basic</code>" 
        <dd><a data-link-type="dfn" href="#concept-filtered-response-basic">basic filtered response</a> 
        <dt>"<code>cors</code>" 
        <dd><a data-link-type="dfn" href="#concept-filtered-response-cors">CORS filtered response</a> 
        <dt>"<code>opaque</code>" 
        <dd><a data-link-type="dfn" href="#concept-filtered-response-opaque">opaque filtered response</a> 
       </dl>
     </ol>
    <li>
     <p>Let <var>internalResponse</var> be <var>response</var>, if <var>response</var> is a <a data-link-type="dfn" href="#concept-network-error">network error</a>, and <var>response</var>’s <a data-link-type="dfn" href="#concept-internal-response">internal response</a> otherwise. </p>
    <li>
     <p>If <var>internalResponse</var>’s <a data-link-type="dfn" href="#concept-response-url-list">url list</a> is
  empty, then set it to a copy of <var>request</var>’s <a data-link-type="dfn" href="#concept-request-url-list">url list</a>. </p>
     <p class="note" role="note">A <a data-link-type="dfn" href="#concept-response">response</a>’s <a data-link-type="dfn" href="#concept-response-url-list">url list</a> will typically be empty at this point,
  unless it came from a service worker, in which case it will only be empty if it was created
  through <a class="idl-code" data-link-type="constructor" href="#dom-response"><code>new Response()</code></a>. </p>
    <li>
     <p>If <var>response</var> is not a <a data-link-type="dfn" href="#concept-network-error">network error</a> and any
  of the following algorithms returns <b>blocked</b>, then set <var>response</var> and <var>internalResponse</var> to a <a data-link-type="dfn" href="#concept-network-error">network error</a>: </p>
     <ul class="brief">
      <li><a href="https://w3c.github.io/webappsec-mixed-content/#should-block-response">should <var>internalResponse</var> to <var>request</var> be blocked as mixed content</a> <a data-link-type="biblio" href="#biblio-mix">[MIX]</a> 
      <li><a href="https://w3c.github.io/webappsec-csp/#should-block-response">should <var>internalResponse</var> to <var>request</var> be blocked by Content Security Policy</a> <a data-link-type="biblio" href="#biblio-csp">[CSP]</a> 
      <li><a data-link-type="dfn" href="#should-response-to-request-be-blocked-due-to-mime-type?">should <var>internalResponse</var> to <var>request</var> be blocked due to its MIME type</a> 
      <li><a data-link-type="dfn" href="#should-response-to-request-be-blocked-due-to-nosniff?">should <var>internalResponse</var> to <var>request</var> be blocked due to nosniff</a> 
     </ul>
    <li>
     <p>If <var>response</var> is not a <a data-link-type="dfn" href="#concept-network-error">network error</a> and
  either <var>request</var>’s <a data-link-type="dfn" href="#concept-request-method">method</a> is
  `<code>HEAD</code>` or `<code>CONNECT</code>`, or <var>internalResponse</var>’s <a data-link-type="dfn" href="#concept-response-status">status</a> is a <a data-link-type="dfn" href="#null-body-status">null body status</a>,
  set <var>internalResponse</var>’s <a data-link-type="dfn" href="#concept-response-body">body</a> to
  null and disregard any enqueuing toward it (if any). </p>
     <p class="note" role="note">This standardizes the error handling for servers that violate HTTP. </p>
    <li>
     <p>If <var>response</var> is not a <a data-link-type="dfn" href="#concept-network-error">network error</a> and <var>request</var>’s <a data-link-type="dfn" href="#concept-request-integrity-metadata">integrity metadata</a> is
  not the empty string, run these substeps: </p>
     <ol>
      <li>
       <p><a data-link-type="dfn" href="#concept-body-wait">Wait</a> for <var>response</var>’s <a data-link-type="dfn" href="#concept-response-body">body</a>. </p>
      <li>
       <p>If <var>response</var> does not have a <a data-link-type="dfn" href="#concept-response-termination-reason">termination reason</a> and <var>response</var> does not <a href="https://w3c.github.io/webappsec-subresource-integrity/#does-response-match-metadatalist">match</a> <var>request</var>’s <a data-link-type="dfn" href="#concept-request-integrity-metadata">integrity metadata</a>,
   set <var>response</var> and <var>internalResponse</var> to a <a data-link-type="dfn" href="#concept-network-error">network error</a>. <a data-link-type="biblio" href="#biblio-sri">[SRI]</a> </p>
     </ol>
     <p class="note" role="note">This operates on <var>response</var> as this algorithm is not supposed to observe <var>internalResponse</var>. That would allow an attacker to use hashes as an oracle. </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#synchronous-flag">synchronous flag</a> is set, <a data-link-type="dfn" href="#concept-body-wait">wait</a> for <var>internalResponse</var>’s <a data-link-type="dfn" href="#concept-response-body">body</a>, and then return <var>response</var>. </p>
     <p class="note no-backref" role="note">This terminates <a data-link-type="dfn" href="#concept-fetch">fetch</a>. </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> is an <a data-link-type="dfn" href="https://url.spec.whatwg.org/#http-scheme">HTTP(S) scheme</a>, then run these substeps: </p>
     <ol>
      <li>
       <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-body">body</a> is <a data-link-type="dfn" href="#concept-body-done">done</a>, <a data-link-type="dfn" href="#queue-a-fetch-request-done-task">queue a fetch-request-done task</a> for <var>request</var>. </p>
      <li>
       <p>Otherwise, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a>, <a data-link-type="dfn" href="#concept-body-wait">wait</a> for <var>request</var>’s <a data-link-type="dfn" href="#concept-request-body">body</a>, and then <a data-link-type="dfn" href="#queue-a-fetch-request-done-task">queue a fetch-request-done task</a> for <var>request</var>. </p>
     </ol>
    <li>
     <p><a data-link-type="dfn" href="#queue-a-fetch-task">Queue a fetch task</a> on <var>request</var> to <a data-link-type="dfn" href="#process-response">process response</a> for <var>response</var>. </p>
    <li>
     <p><a data-link-type="dfn" href="#concept-body-wait">Wait</a> for <var>internalResponse</var>’s <a data-link-type="dfn" href="#concept-response-body">body</a>. </p>
    <li>
     <p><a data-link-type="dfn" href="#queue-a-fetch-task">Queue a fetch task</a> on <var>request</var> to <a data-link-type="dfn" href="#process-response-end-of-body">process response end-of-body</a> for <var>response</var>. </p>
    <li>
     <p>Wait for <var>internalResponse</var>’s <a data-link-type="dfn" href="#concept-response-trailer">trailer</a>,
 if any. <span class="note">See <a href="https://tools.ietf.org/html/rfc7230#section-4.1.2">section 4.1.2</a> of <a data-link-type="biblio" href="#biblio-http">[HTTP]</a>.</span> </p>
    <li>
     <p>Set <var>request</var>’s <a data-link-type="dfn" href="#done-flag">done flag</a>. </p>
    <li>
     <p><a data-link-type="dfn" href="#queue-a-fetch-task">Queue a fetch task</a> on <var>request</var> to <a data-link-type="dfn" href="#process-response-done">process response done</a> for <var>response</var>. </p>
   </ol>
   <h3 class="heading settled" data-level="5.2" id="basic-fetch"><span class="secno">5.2. </span><span class="content">Basic fetch</span><a class="self-link" href="#basic-fetch"></a></h3>
   <p>To perform a <dfn data-dfn-for="basic" data-dfn-type="dfn" data-noexport="" id="concept-basic-fetch">basic fetch<a class="self-link" href="#concept-basic-fetch"></a></dfn> using <var>request</var>, switch on <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a>, and run the associated
steps: </p>
   <dl class="switch">
    <dt>"<code>about</code>" 
    <dd>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#url-cannot-be-a-base-url-flag">cannot-be-a-base-URL flag</a> is set and <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path">path</a> contains a single string
  "<code>blank</code>", return a <a data-link-type="dfn" href="#concept-response">response</a> whose <a data-link-type="dfn" href="#concept-response-header-list">header list</a> consist of a single <a data-link-type="dfn" href="#concept-header">header</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is `<code>Content-Type</code>` and <a data-link-type="dfn" href="#concept-header-value">value</a> is
  `<code>text/html;charset=utf-8</code>`, <a data-link-type="dfn" href="#concept-response-body">body</a> is the empty byte sequence, and <a data-link-type="dfn" href="#concept-response-https-state">HTTPS state</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-client">client</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#https-state">HTTPS state</a> if <var>request</var>’s <a data-link-type="dfn" href="#concept-request-client">client</a> is non-null. </p>
     <p>Otherwise, return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
     <p class="note no-backref" role="note"><a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url">URLs</a> such as "<code>about:config</code>" are handled
  during <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#navigate">navigation</a> and result in a <a data-link-type="dfn" href="#concept-network-error">network error</a> in the context of <a data-link-type="dfn" href="#concept-fetch">fetching</a>. </p>
    <dt>"<code>blob</code>" 
    <dd>
     <ol>
      <li>
       <p>Let <var>blob</var> be <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-object">object</a>. </p>
      <li>
       <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-method">method</a> is not
    `<code>GET</code>` or <var>blob</var> is null, then return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
       <p class="note" role="note">The `<code>GET</code>` <a data-link-type="dfn" href="#concept-method">method</a> restriction
    serves no useful purpose other than being interoperable. </p>
      <li>
       <p>Let <var>response</var> be a new <a data-link-type="dfn" href="#concept-response">response</a>. </p>
      <li>
       <p><a data-link-type="dfn" href="#concept-header-list-append">Append</a> `<code>Content-Length</code>`/<var>blob</var>’s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-size">size</a></code> attribute value to <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
      <li>
       <p><a data-link-type="dfn" href="#concept-header-list-append">Append</a> `<code>Content-Type</code>`/<var>blob</var>’s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-type">type</a></code> attribute value to <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
      <li>
       <p>Set <var>response</var>’s <a data-link-type="dfn" href="#concept-response-https-state">HTTPS state</a> to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-client">client</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#https-state">HTTPS state</a> if <var>request</var>’s <a data-link-type="dfn" href="#concept-request-client">client</a> is non-null. </p>
      <li>
       <p>Set <var>response</var>’s <a data-link-type="dfn" href="#concept-response-body">body</a> to
   the result of performing the <a data-link-type="dfn" href="https://w3c.github.io/FileAPI/#readOperation">read operation</a> on <var>blob</var>. </p>
      <li>
       <p>Return <var>response</var>. </p>
     </ol>
    <dt>"<code>data</code>" 
    <dd>
     <p>If <a href="https://simonsapin.github.io/data-urls/">obtaining a resource</a> from <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a> does not return
  failure, then return a <a data-link-type="dfn" href="#concept-response">response</a> whose <a data-link-type="dfn" href="#concept-response-header-list">header list</a> consist of a single <a data-link-type="dfn" href="#concept-header">header</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is
  `<code>Content-Type</code>` and <a data-link-type="dfn" href="#concept-header-value">value</a> is the
  MIME type and parameters returned from <a href="https://simonsapin.github.io/data-urls/">obtaining a resource</a>, <a data-link-type="dfn" href="#concept-response-body">body</a> is the data returned from <a href="https://simonsapin.github.io/data-urls/">obtaining a resource</a>, and <a data-link-type="dfn" href="#concept-response-https-state">HTTPS state</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-client">client</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#https-state">HTTPS state</a> if <var>request</var>’s <a data-link-type="dfn" href="#concept-request-client">client</a> is non-null. <a data-link-type="biblio" href="#biblio-dataurl">[DATAURL]</a> </p>
     <p>Otherwise, return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
    <dt>"<code>file</code>" 
    <dt>"<code>ftp</code>" 
    <dd>
     <p>For now, unfortunate as it is, <code>file</code> and <code>ftp</code> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url">URLs</a> are
  left as an exercise for the reader. </p>
     <p>When in doubt, return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
    <dt>"<code>filesystem</code>" 
    <dd>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#sandboxed-storage-area-urls-flag">sandboxed-storage-area-URLs flag</a> is set,
  return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
     <p class="XXX">Otherwise, … this scheme still needs to be defined. </p>
    <dt><a data-link-type="dfn" href="https://url.spec.whatwg.org/#http-scheme">HTTP(S) scheme</a> 
    <dd>
     <p>Return the result of performing an <a data-link-type="dfn" href="#concept-http-fetch">HTTP fetch</a> using <var>request</var>. </p>
    <dt>Otherwise 
    <dd>
     <p>Return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
   </dl>
   <h3 class="heading settled" data-level="5.3" id="http-fetch"><span class="secno">5.3. </span><span class="content">HTTP fetch</span><a class="self-link" href="#http-fetch"></a></h3>
   <p>To perform an <dfn data-dfn-type="dfn" data-noexport="" id="concept-http-fetch">HTTP fetch<a class="self-link" href="#concept-http-fetch"></a></dfn> using <var>request</var> with an
optional <i>CORS flag</i> and <i>CORS-preflight flag</i>, run these steps: </p>
   <p class="note no-backref" role="note"><i>CORS flag</i> is still a bookkeeping detail. As is <i>CORS-preflight flag</i>; it indicates a <a data-link-type="dfn" href="#cors-preflight-request">CORS-preflight request</a> is needed. </p>
   <ol>
    <li>
     <p>Let <var>response</var> be null. </p>
    <li>
     <p>Let <var>actualResponse</var> be null. </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#skip-service-worker-flag">skip-service-worker flag</a> is unset, then run these
  substeps: </p>
     <ol>
      <li>
       <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-client">client</a> is null or <var>request</var>’s <a data-link-type="dfn" href="#concept-request-client">client</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global">global object</a> is not a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/ServiceWorker/#service-worker-global-scope-interface">ServiceWorkerGlobalScope</a></code> object, then set <var>response</var> to the result of invoking <a data-link-type="dfn" href="https://w3c.github.io/ServiceWorker/#on-fetch-request-algorithm">handle fetch</a> for <var>request</var>. <a data-link-type="biblio" href="#biblio-html">[HTML]</a> <a data-link-type="biblio" href="#biblio-sw">[SW]</a> </p>
      <li>
       <p>If <var>response</var> is null, <var>request</var> is a <a data-link-type="dfn" href="#subresource-request">subresource request</a>, and <var>request</var>’s <a data-link-type="dfn" href="#concept-request-origin">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin">same origin</a> with <var>request</var>’s <a data-link-type="dfn" href="#concept-request-url">url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin">origin</a>, then set <var>response</var> to the result of invoking <a data-link-type="dfn" href="https://w3c.github.io/ServiceWorker/#on-foreign-fetch-request-algorithm">handle foreign fetch</a> for <var>request</var>. <a data-link-type="biblio" href="#biblio-sw">[SW]</a> </p>
      <li>
       <p>If <var>response</var> is not null, then run these substeps: </p>
       <ol>
        <li>
         <p><a data-link-type="dfn" href="#read-a-request">Read <var>request</var></a>. </p>
        <li>
         <p>Set <var>actualResponse</var> to <var>response</var>, if <var>response</var> is not a <a data-link-type="dfn" href="#concept-filtered-response">filtered response</a>, and to <var>response</var>’s <a data-link-type="dfn" href="#concept-internal-response">internal response</a> otherwise. </p>
        <li>
         <p>If one of the following conditions is true, then return a <a data-link-type="dfn" href="#concept-network-error">network error</a>: </p>
         <ul class="brief">
          <li><var>response</var>’s <a data-link-type="dfn" href="#concept-response-type">type</a> is "<code>error</code>". 
          <li><var>request</var>’s <a data-link-type="dfn" href="#concept-request-mode">mode</a> is not
       "<code>no-cors</code>" and <var>response</var>’s <a data-link-type="dfn" href="#concept-response-type">type</a> is "<code>opaque</code>". 
          <li><var>request</var>’s <a data-link-type="dfn" href="#concept-request-redirect-mode">redirect mode</a> is
       not "<code>manual</code>" and <var>response</var>’s <a data-link-type="dfn" href="#concept-response-type">type</a> is "<code>opaqueredirect</code>". 
          <li><var>request</var>’s <a data-link-type="dfn" href="#concept-request-redirect-mode">redirect mode</a> is
       not "<code>follow</code>" and <var>response</var>’s <a data-link-type="dfn" href="#concept-response-url-list">url list</a> has more than one item. 
         </ul>
        <li>
         <p>Execute <a href="https://w3c.github.io/webappsec-csp/#set-response-csp-list">set <var>response</var>’s CSP list</a> on <var>actualResponse</var>. <a data-link-type="biblio" href="#biblio-csp">[CSP]</a> </p>
       </ol>
     </ol>
    <li>
     <p>If <var>response</var> is null, run these substeps: </p>
     <ol>
      <li>
       <p>If the <i>CORS-preflight flag</i> is set and one of these conditions is true: </p>
       <ul>
        <li>There is no <a data-link-type="dfn" href="#concept-cache-match-method">method cache match</a> for <var>request</var>’s <a data-link-type="dfn" href="#concept-request-method">method</a> using <var>request</var>,
     and either <var>request</var>’s <a data-link-type="dfn" href="#concept-request-method">method</a> is a not a <a data-link-type="dfn" href="#cors-safelisted-method">CORS-safelisted method</a> or <var>request</var>’s <a data-link-type="dfn" href="#use-cors-preflight-flag">use-CORS-preflight flag</a> is set. 
        <li>There is at least one <a data-link-type="dfn" href="#concept-header">header</a> in <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a> for whose <a data-link-type="dfn" href="#concept-header-name">name</a> there is no <a data-link-type="dfn" href="#concept-cache-match-header">header-name cache match</a> using <var>request</var> and which is not a <a data-link-type="dfn" href="#cors-safelisted-request-header">CORS-safelisted request-header</a>. 
       </ul>
       <p>Then run these subsubsteps: </p>
       <ol>
        <li>
         <p>Let <var>preflightResponse</var> be the result of performing a <a data-link-type="dfn" href="#cors-preflight-fetch-0">CORS-preflight fetch</a> using <var>request</var>. </p>
        <li>
         <p>If <var>preflightResponse</var> is a <a data-link-type="dfn" href="#concept-network-error">network error</a>, return <var>preflightResponse</var>. </p>
       </ol>
       <p class="note no-backref" role="note">This step checks the <a data-link-type="dfn" href="#concept-cache">CORS-preflight cache</a> and if there is no suitable entry it
    performs a <a data-link-type="dfn" href="#cors-preflight-fetch-0">CORS-preflight fetch</a> which, if successful, populates the cache. The
    purpose of the <a data-link-type="dfn" href="#cors-preflight-fetch-0">CORS-preflight fetch</a> is to ensure the <a data-link-type="dfn" href="#concept-fetch">fetched</a> resource is familiar with the <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a>. The cache is there to minimize the number of <a data-link-type="dfn" href="#cors-preflight-fetch-0">CORS-preflight fetches</a>. </p>
      <li>
       <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-redirect-mode">redirect mode</a> is
    "<code>follow</code>", then set <var>request</var>’s <a data-link-type="dfn" href="#skip-service-worker-flag">skip-service-worker flag</a>. </p>
       <p class="note no-backref" role="note">Redirects coming from the network (as opposed to from a service
    worker) are not to be exposed to a service worker. </p>
      <li>
       <p>Set <var>response</var> and <var>actualResponse</var> to the result of performing an <a data-link-type="dfn" href="#concept-http-network-or-cache-fetch">HTTP-network-or-cache fetch</a> using <var>request</var> with <i>CORS flag</i> if set. </p>
      <li>
       <p>If <i>CORS flag</i> is set and a <a data-link-type="dfn" href="#concept-cors-check">CORS check</a> for <var>request</var> and <var>response</var> returns failure, then return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
       <p class="note no-backref" role="note">As the <a data-link-type="dfn" href="#concept-cors-check">CORS check</a> is not to be
    applied to <a data-link-type="dfn" href="#concept-response">responses</a> whose <a data-link-type="dfn" href="#concept-response-status">status</a> is <code>304</code> or <code>407</code>, or <a data-link-type="dfn" href="#concept-response">responses</a> from a service worker for that matter, it is
    applied here. </p>
     </ol>
    <li>
     <p>If <var>actualResponse</var>’s <a data-link-type="dfn" href="#concept-response-status">status</a> is a <a data-link-type="dfn" href="#redirect-status">redirect status</a>, then run these substeps: </p>
     <ol>
      <li>
       <p>If <var>actualResponse</var>’s <a data-link-type="dfn" href="#concept-response-status">status</a> is not <code>303</code>, <var>request</var>’s <a data-link-type="dfn" href="#concept-request-body">body</a> is not <a data-link-type="dfn" href="#concept-body-done">done</a>, and the <a data-link-type="dfn" href="#concept-connection">connection</a> uses HTTP/2, then user agents may, and are even
    encouraged to, transmit an <code>RST_STREAM</code> frame. </p>
       <p class="note" role="note"><code>303</code> is excluded as certain communities ascribe special status to
    it. </p>
      <li>
       <p>Let <var>location</var> be the result of <a data-link-type="dfn" href="#concept-header-parse">parsing</a> `<code>Location</code>` in <var>actualResponse</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
      <li>
       <p>If <var>location</var> is a <a data-link-type="dfn" href="#concept-header-value">value</a>, then set <var>location</var> to the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser">parsing</a> <var>location</var> with <var>actualResponse</var>’s <a data-link-type="dfn" href="#concept-response-url">url</a>. </p>
      <li>
       <p>Set <var>actualResponse</var>’s <a data-link-type="dfn" href="#concept-response-location-url">location URL</a> to <var>location</var>. </p>
      <li>
       <p>Switch on <var>request</var>’s <a data-link-type="dfn" href="#concept-request-redirect-mode">redirect mode</a>: </p>
       <dl class="switch">
        <dt>"<code>error</code>" 
        <dd>
         <p>Set <var>response</var> to a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
        <dt>"<code>manual</code>" 
        <dd>
         <p>Set <var>response</var> to an <a data-link-type="dfn" href="#concept-filtered-response-opaque-redirect">opaque-redirect filtered response</a> whose <a data-link-type="dfn" href="#concept-internal-response">internal response</a> is <var>actualResponse</var>. </p>
        <dt>"<code>follow</code>" 
        <dd>
         <p>Set <var>response</var> to the result of performing <a data-link-type="dfn" href="#concept-http-redirect-fetch">HTTP-redirect fetch</a> using <var>request</var> and <var>response</var> with <i>CORS flag</i> if set. </p>
       </dl>
     </ol>
    <li>
     <p>Return <var>response</var>. <span class="note no-backref">Typically <var>actualResponse</var>’s <a data-link-type="dfn" href="#concept-response-body">body</a>’s <a data-link-type="dfn" href="#concept-body-stream">stream</a> is still being enqueued to after returning.</span> </p>
   </ol>
   <h3 class="heading settled" data-level="5.4" id="http-redirect-fetch"><span class="secno">5.4. </span><span class="content">HTTP-redirect fetch</span><a class="self-link" href="#http-redirect-fetch"></a></h3>
   <p class="note no-backref" role="note">This algorithm will be used by <cite>HTML</cite>’s "navigate" algorithm
in addition to <a data-link-type="dfn" href="#concept-http-fetch">HTTP fetch</a> above. <a data-link-type="biblio" href="#biblio-html">[HTML]</a> </p>
   <p>To perform an <dfn data-dfn-type="dfn" data-export="" id="concept-http-redirect-fetch">HTTP-redirect fetch<a class="self-link" href="#concept-http-redirect-fetch"></a></dfn> using <var>request</var> and <var>response</var>, with an optional <i>CORS flag</i>, run these steps: </p>
   <ol>
    <li>
     <p>Let <var>actualResponse</var> be <var>response</var>, if <var>response</var> is not a <a data-link-type="dfn" href="#concept-filtered-response">filtered response</a>, and <var>response</var>’s <a data-link-type="dfn" href="#concept-internal-response">internal response</a> otherwise. </p>
    <li>
     <p>If <var>actualResponse</var>’s <a data-link-type="dfn" href="#concept-response-location-url">location URL</a> is null, then return <var>response</var>. </p>
    <li>
     <p>If <var>actualResponse</var>’s <a data-link-type="dfn" href="#concept-response-location-url">location URL</a> is failure, then return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
    <li>
     <p>If <var>actualResponse</var>’s <a data-link-type="dfn" href="#concept-response-location-url">location URL</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> is <em>not</em> an <a data-link-type="dfn" href="https://url.spec.whatwg.org/#http-scheme">HTTP(S) scheme</a>, then return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-redirect-count">redirect count</a> is
 twenty, return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
    <li>
     <p>Increase <var>request</var>’s <a data-link-type="dfn" href="#concept-request-redirect-count">redirect count</a> by one. </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-mode">mode</a> is "<code>cors</code>", <var>request</var>’s <a data-link-type="dfn" href="#concept-request-origin">origin</a> is <em>not</em> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin">same origin</a> with <var>actualResponse</var>’s <a data-link-type="dfn" href="#concept-response-location-url">location URL</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin">origin</a>, and <var>actualResponse</var>’s <a data-link-type="dfn" href="#concept-response-location-url">location URL</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#include-credentials">includes credentials</a>, then return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
    <li>
     <p>If <i>CORS flag</i> is set and <var>actualResponse</var>’s <a data-link-type="dfn" href="#concept-response-location-url">location URL</a> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#include-credentials">includes credentials</a>, then return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
     <p class="note" role="note">This catches a cross-origin resource redirecting to a same-origin URL. </p>
    <li>
     <p>If <i>CORS flag</i> is set and <var>actualResponse</var>’s <a data-link-type="dfn" href="#concept-response-location-url">location URL</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin">origin</a> is <em>not</em> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin">same origin</a> with <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin">origin</a>, set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-origin">origin</a> to a globally unique identifier. </p>
    <li>
     <p>If either <var>actualResponse</var>’s <a data-link-type="dfn" href="#concept-response-status">status</a> is <code>301</code> or <code>302</code> and <var>request</var>’s <a data-link-type="dfn" href="#concept-request-method">method</a> is `<code>POST</code>`, or <var>actualResponse</var>’s <a data-link-type="dfn" href="#concept-response-status">status</a> is <code>303</code>, set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-method">method</a> to `<code>GET</code>` and <var>request</var>’s <a data-link-type="dfn" href="#concept-request-body">body</a> to null. </p>
    <li>
     <p>Append <var>actualResponse</var>’s <a data-link-type="dfn" href="#concept-response-location-url">location URL</a> to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-url-list">url list</a>. </p>
    <li>
     <p>Invoke <a data-link-type="dfn" href="https://w3c.github.io/webappsec-referrer-policy/#set-requests-referrer-policy-on-redirect">set <var>request</var>’s referrer policy on redirect</a> on <var>request</var> and <var>actualResponse</var>. <a data-link-type="biblio" href="#biblio-referrer">[REFERRER]</a> </p>
    <li>
     <p>Return the result of performing a <a data-link-type="dfn" href="#concept-main-fetch">main fetch</a> using <var>request</var> with <i>CORS flag</i> if set and <i>recursive flag</i> set. </p>
     <p class="note no-backref" role="note">This has to invoke <a data-link-type="dfn" href="#concept-main-fetch">main fetch</a> to
  get <a data-link-type="dfn" href="#concept-request-response-tainting">response tainting</a> correct. </p>
   </ol>
   <h3 class="heading settled" data-level="5.5" id="http-network-or-cache-fetch"><span class="secno">5.5. </span><span class="content">HTTP-network-or-cache fetch</span><a class="self-link" href="#http-network-or-cache-fetch"></a></h3>
   <p>To perform an <dfn data-dfn-type="dfn" data-noexport="" id="concept-http-network-or-cache-fetch">HTTP-network-or-cache fetch<a class="self-link" href="#concept-http-network-or-cache-fetch"></a></dfn> using <var>request</var> with an optional <i>CORS flag</i> and <i>authentication-fetch flag</i>, run these
steps: </p>
   <p class="note" role="note"><i>CORS flag</i> is still a bookkeeping detail. As is <i>authentication-fetch flag</i>. </p>
   <ol>
    <li>
     <p>Let <var>httpRequest</var> be <var>request</var> if <var>request</var>’s <a data-link-type="dfn" href="#concept-request-window">window</a> is "<code>no-window</code>"
  and <var>request</var>’s <a data-link-type="dfn" href="#concept-request-redirect-mode">redirect mode</a> is
  "<code>error</code>", and the result of <a data-link-type="dfn" href="#concept-request-clone">cloning</a> <var>request</var> otherwise. </p>
     <p class="note no-backref" role="note">A <var>request</var> is typically cloned as it needs to be possible to
  add <a data-link-type="dfn" href="#concept-header">headers</a> and read its <a data-link-type="dfn" href="#concept-request-body">body</a> without affecting <var>request</var>. As <var>request</var> is reused with redirects, authentication, and proxy authentication. </p>
    <li>
     <p>Let <i>credentials flag</i> be set if one of </p>
     <ul class="brief">
      <li><var>request</var>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is
   "<code>include</code>" 
      <li><var>request</var>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is
   "<code>same-origin</code>" and <var>request</var>’s <a data-link-type="dfn" href="#concept-request-response-tainting">response tainting</a> is "<code>basic</code>" 
     </ul>
     <p>is true, and unset otherwise. </p>
    <li>
     <p>Let <var>contentLengthValue</var> be null. </p>
    <li>
     <p>If <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-body">body</a> is null and <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-method">method</a> is
 `<code>POST</code>` or `<code>PUT</code>`, then set <var>contentLengthValue</var> to
 `<code>0</code>`. </p>
    <li>
     <p>If <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-body">body</a> is non-null, set <var>contentLengthValue</var> to <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-body">body</a>’s <a data-link-type="dfn" href="#concept-body-total-bytes">total bytes</a>, <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8-encode">utf-8 encoded</a>. </p>
    <li>
     <p>If <var>contentLengthValue</var> is non-null, <a data-link-type="dfn" href="#concept-header-list-append">append</a> `<code>Content-Length</code>`/<var>contentLengthValue</var> to <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
    <li>
     <p>If <var>contentLengthValue</var> is non-null, <var>httpRequest</var>’s <a data-link-type="dfn" href="#keepalive-flag">keepalive flag</a> is set, and <var>contentLengthValue</var> is greater than a
  user-agent-defined maximum, then return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
     <p class="note no-backref" role="note">The above user-agent-defined maximum ensures that requests that are
  allowed to outlive the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a> and contain
  a body, have a bounded size and are not allowed to stay alive indefinitely. </p>
    <li>
     <p>If <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-referrer">referrer</a> is a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url">URL</a>, then <a data-link-type="dfn" href="#concept-header-list-append">append</a> `<code>Referer</code>`/<var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-referrer">referrer</a>, <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer">serialized</a> and <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8-encode">utf-8 encoded</a>, to <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
    <li>
     <p>If <var>httpRequest</var>’s <a data-link-type="dfn" href="#omit-origin-header-flag">omit-<code>Origin</code>-header flag</a> is unset, <a data-link-type="dfn" href="#concept-header-list-append">append</a> `<code>Origin</code>`/<var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-origin">origin</a>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin">serialized</a> and <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8-encode">utf-8 encoded</a>, to <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
    <li>
     <p>If <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a> does <em>not</em> contain a <a data-link-type="dfn" href="#concept-header">header</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is `<code>User-Agent</code>`,
 user agents should <a data-link-type="dfn" href="#concept-header-list-append">append</a> `<code>User-Agent</code>`/<a data-link-type="dfn" href="#default-user-agent-value">default `<code>User-Agent</code>` value</a> to <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
    <li>
     <p>If <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> is
 "<code>default</code>" and <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a> contains a <a data-link-type="dfn" href="#concept-header">header</a> <a data-link-type="dfn" href="#concept-header-name">named</a> `<code>If-Modified-Since</code>`,
 `<code>If-None-Match</code>`,
 `<code>If-Unmodified-Since</code>`,
 `<code>If-Match</code>`, or
 `<code>If-Range</code>`, set <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> to "<code>no-store</code>". </p>
    <li>
     <p>If <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> is
 "<code>no-cache</code>" and <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a> does <em>not</em> contain a <a data-link-type="dfn" href="#concept-header">header</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is
 `<code>Cache-Control</code>`, <a data-link-type="dfn" href="#concept-header-list-append">append</a> `<code>Cache-Control</code>`/`<code>max-age=0</code>` to <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
    <li>
     <p>If <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> is
  "<code>no-store</code>" or "<code>reload</code>", run these substeps: </p>
     <ol>
      <li>
       <p>If <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a> does <em>not</em> contain a <a data-link-type="dfn" href="#concept-header">header</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is `<code>Pragma</code>`, <a data-link-type="dfn" href="#concept-header-list-append">append</a> `<code>Pragma</code>`/`<code>no-cache</code>` to <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
      <li>
       <p>If <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a> does <em>not</em> contain a <a data-link-type="dfn" href="#concept-header">header</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is
   `<code>Cache-Control</code>`, <a data-link-type="dfn" href="#concept-header-list-append">append</a> `<code>Cache-Control</code>`/`<code>no-cache</code>` to <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
     </ol>
    <li>
     <p>Modify <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a> per HTTP. </p>
     <p class="note no-backref" role="note">It would be great if we could make this more normative
  somehow. At this point <a data-link-type="dfn" href="#concept-header">headers</a> such as
  `<code>Accept-Encoding</code>`,
  `<code>Connection</code>`,
  `<code>DNT</code>`, and
  `<code>Host</code>`,
  are to be <a data-link-type="dfn" href="#concept-header-list-append">appended</a> if necessary. </p>
     <p>`<code>Accept</code>`,
  `<code>Accept-Charset</code>`, and
  `<code>Accept-Language</code>` must not be included at this point. </p>
     <p class="note no-backref" role="note">`<code>Accept</code>` and
  `<code>Accept-Language</code>` are already included (unless <a data-link-type="functionish" href="#dom-global-fetch"><code>fetch()</code></a> is used, which does not include the latter by
  default), and `<code>Accept-Charset</code>` is a waste of bytes. See <a data-link-type="dfn" href="#http-header-layer-division">HTTP header layer division</a> for more details. </p>
    <li>
     <p>If <i>credentials flag</i> is set, run these substeps: </p>
     <ol>
      <li>
       <p>If the user agent is not configured to block cookies for <var>httpRequest</var> (see <a href="https://tools.ietf.org/html/rfc6265#section-7">section 7</a> of <a data-link-type="biblio" href="#biblio-cookies">[COOKIES]</a>), then run these substeps: </p>
       <ol>
        <li>
         <p>Let <var>cookies</var> be the result of running the "cookie-string" algorithm (see <a href="https://tools.ietf.org/html/rfc6265#section-5.4">section 5.4</a> of <a data-link-type="biblio" href="#biblio-cookies">[COOKIES]</a>) with the user agent’s cookie store and <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>. </p>
        <li>If <var>cookies</var> is not the empty string, append
     `<code>Cookie</code>`/<var>cookies</var> to <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. 
       </ol>
      <li>
       <p>If <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a> contains a <a data-link-type="dfn" href="#concept-header">header</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is
   `<code>Authorization</code>`, terminate these substeps. </p>
      <li>
       <p>Let <var>authorizationValue</var> be null. </p>
      <li>
       <p>If there’s an <a data-link-type="dfn" href="#authentication-entry">authentication entry</a> for <var>httpRequest</var> and either <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-use-url-credentials-flag">use-URL-credentials flag</a> is
   unset or <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a> does not <a data-link-type="dfn" href="https://url.spec.whatwg.org/#include-credentials">include credentials</a>, set <var>authorizationValue</var> to <a data-link-type="dfn" href="#authentication-entry">authentication entry</a>. </p>
      <li>
       <p>Otherwise, if <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a> does <a data-link-type="dfn" href="https://url.spec.whatwg.org/#include-credentials">include credentials</a> and <i>authentication-fetch flag</i> is
   set, then set <var>authorizationValue</var> to <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>, <span class="XXX">converted to an `<code>Authorization</code>` value</span>. </p>
      <li>
       <p>If <var>authorizationValue</var> is non-null, <a data-link-type="dfn" href="#concept-header-list-append">append</a> `<code>Authorization</code>`/<var>authorizationValue</var> to <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
     </ol>
    <li>
     <p>If there’s a <a data-link-type="dfn" href="#proxy-authentication-entry">proxy-authentication entry</a>, use it as appropriate. </p>
     <p class="note no-backref" role="note">This intentionally does not depend on <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a>. </p>
    <li>
     <p>Let <var>response</var> be null. </p>
    <li>
     <p>If <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> is neither
  "<code>no-store</code>" nor "<code>reload</code>", and there is a <em>complete</em> <a data-link-type="dfn" href="#concept-response">response</a> in the HTTP cache for <var>httpRequest</var> run these substeps: </p>
     <ol>
      <li>
       <p>If <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> is
    "<code>force-cache</code>" or "<code>only-if-cached</code>", then set <var>response</var> to the <a data-link-type="dfn" href="#concept-response">response</a> in the HTTP cache for <var>httpRequest</var>. </p>
       <p class="note" role="note">As mandated by HTTP, this still takes the `<code>Vary</code>` <a data-link-type="dfn" href="#concept-header">header</a> into account. </p>
      <li>
       <p>Otherwise, if <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> is "<code>default</code>" and the <a data-link-type="dfn" href="#concept-response">response</a> in the HTTP cache for <var>httpRequest</var> does
   not require revalidation, then set <var>response</var> to that <a data-link-type="dfn" href="#concept-response">response</a>. </p>
      <li>
       <p>Otherwise, if <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> is either "<code>default</code>"
   or "<code>no-cache</code>", modify <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a> with revalidation <a data-link-type="dfn" href="#concept-header">headers</a>. </p>
     </ol>
    <li>
     <p>Otherwise, if <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> is either
 "<code>default</code>" or "<code>force-cache</code>", and there is a <em>partial</em> <a data-link-type="dfn" href="#concept-response">response</a> in the HTTP cache for <var>httpRequest</var>, modify <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a> with resume <a data-link-type="dfn" href="#concept-header">headers</a>. </p>
    <li>
     <p>If <var>response</var> is null, run these substeps: </p>
     <ol>
      <li>
       <p>If <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> is
   "<code>only-if-cached</code>", then return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
      <li>
       <p>Set <var>response</var> to the result of making an <a data-link-type="dfn" href="#concept-http-network-fetch">HTTP-network fetch</a> using <var>httpRequest</var> with <i>credentials flag</i> if set. </p>
     </ol>
    <li>
     <p>If <var>response</var>’s <a data-link-type="dfn" href="#concept-response-status">status</a> is <code>304</code> and <var>httpRequest</var>’s <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> is either
  "<code>default</code>" or "<code>no-cache</code>", run these substeps: </p>
     <ol>
      <li>
       <p>Set <var>cachedResponse</var> to the result of selecting a stored <a data-link-type="dfn" href="#concept-response">response</a> from the HTTP cache using <var>httpRequest</var>, as
   per the
   "<a href="https://tools.ietf.org/html/rfc7234#section-4.3.4">Freshening Stored Responses upon Validation</a>"
   chapter of <cite>HTTP Caching</cite>. <a data-link-type="biblio" href="#biblio-http-caching">[HTTP-CACHING]</a> </p>
      <li>
       <p>If <var>cachedResponse</var> is null (i.e., one cannot be selected), return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
      <li>
       <p>Update <var>cachedResponse</var>’s <a data-link-type="dfn" href="#concept-header-list">header list</a> using <var>response</var>’s <a data-link-type="dfn" href="#concept-header-list">header list</a>, as per the
   "<a href="https://tools.ietf.org/html/rfc7234#section-4.3.4">Freshening Stored Responses upon Validation</a>"
   chapter of <cite>HTTP Caching</cite>. <a data-link-type="biblio" href="#biblio-http-caching">[HTTP-CACHING]</a> </p>
      <li>
       <p>Set <var>response</var> to the <var>cachedResponse</var>. </p>
       <p class="note no-backref" role="note">This changes <var>response</var> entirely, including its <a data-link-type="dfn" href="#concept-response-status">status</a> which is most likely <code>200</code> now. </p>
     </ol>
    <li>
     <p>If <var>response</var>’s <a data-link-type="dfn" href="#concept-response-status">status</a> is <code>401</code>, <i>CORS flag</i> is unset, <i>credentials flag</i> is set, and <var>request</var>’s <a data-link-type="dfn" href="#concept-request-window">window</a> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a>, then run these substeps: </p>
     <ol>
      <li class="XXX">
       <p>Needs testing: multiple `<code>WWW-Authenticate</code>` headers, missing,
   parsing issues. </p>
      <li>
       <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-use-url-credentials-flag">use-URL-credentials flag</a> is unset or <i>authentication-fetch flag</i> is set, then run these subsubsteps: </p>
       <ol>
        <li>
         <p>Let <var>username</var> and <var>password</var> be the result of prompting the end user
     for a username and password, respectively, in <var>request</var>’s <a data-link-type="dfn" href="#concept-request-window">window</a>. </p>
        <li>
         <p><a data-link-type="dfn" href="https://url.spec.whatwg.org/#set-the-username">Set the username</a> given <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a> and <var>username</var>. </p>
        <li>
         <p><a data-link-type="dfn" href="https://url.spec.whatwg.org/#set-the-password">Set the password</a> given <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a> and <var>password</var>. </p>
       </ol>
      <li>
       <p>Set <var>response</var> to the result of performing an <a data-link-type="dfn" href="#concept-http-network-or-cache-fetch">HTTP-network-or-cache fetch</a> using <var>request</var> with <i>authentication-fetch flag</i> set. </p>
     </ol>
    <li>
     <p>If <var>response</var>’s <a data-link-type="dfn" href="#concept-response-status">status</a> is <code>407</code>, then run these
  substeps: </p>
     <ol>
      <li>
       <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-window">window</a> is
   "<code>no-window</code>", then return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
      <li class="XXX">
       <p>Needs testing: multiple `<code>Proxy-Authenticate</code>` headers, missing,
   parsing issues. </p>
      <li>
       <p>Prompt the end user as appropriate in <var>request</var>’s <a data-link-type="dfn" href="#concept-request-window">window</a> and store the result as a <a data-link-type="dfn" href="#proxy-authentication-entry">proxy-authentication entry</a>. <a data-link-type="biblio" href="#biblio-http-auth">[HTTP-AUTH]</a> </p>
       <p class="note" role="note">Remaining details surrounding proxy authentication are defined by HTTP. </p>
      <li>
       <p>Set <var>response</var> to the result of performing an <a data-link-type="dfn" href="#concept-http-network-or-cache-fetch">HTTP-network-or-cache fetch</a> using <var>request</var> with <i>CORS flag</i> if set. </p>
     </ol>
    <li>
     <p>If <i>authentication-fetch flag</i> is set, then create an <a data-link-type="dfn" href="#authentication-entry">authentication entry</a> for <var>request</var> and the given realm. </p>
    <li>
     <p>Return <var>response</var>. <span class="note no-backref">Typically <var>response</var>’s <a data-link-type="dfn" href="#concept-response-body">body</a>’s <a data-link-type="dfn" href="#concept-body-stream">stream</a> is still being enqueued to after returning.</span> </p>
   </ol>
   <h3 class="heading settled" data-level="5.6" id="http-network-fetch"><span class="secno">5.6. </span><span class="content">HTTP-network fetch</span><a class="self-link" href="#http-network-fetch"></a></h3>
   <p>To perform an <dfn data-dfn-type="dfn" data-noexport="" id="concept-http-network-fetch">HTTP-network fetch<a class="self-link" href="#concept-http-network-fetch"></a></dfn> using <var>request</var> with an optional <i>credentials flag</i>, run these steps: </p>
   <ol>
    <li>
     <p>Let <var>credentials</var> be true if <i>credentials flag</i> is set, and false otherwise. </p>
    <li>
     <p>Switch on <var>request</var>’s <a data-link-type="dfn" href="#concept-request-mode">mode</a>: </p>
     <dl>
      <dt>"<code>websocket</code>" 
      <dd>
       <p>Let <var>connection</var> be the result of <a data-link-type="dfn" href="#concept-websocket-connection-obtain">obtaining a WebSocket connection</a>, given <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>. </p>
      <dt>Otherwise 
      <dd>
       <p>Let <var>connection</var> be the result of <a data-link-type="dfn" href="#concept-connection-obtain">obtaining a connection</a>, given <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin">origin</a> and <var>credentials</var>. </p>
     </dl>
    <li>
     <p>If <var>connection</var> is failure, return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
    <li>
     <p>Let <var>response</var> be the result of making an HTTP request over <var>connection</var> using <var>request</var> with the following caveats: </p>
     <ul>
      <li>
       <p>Follow the relevant requirements from HTTP. <a data-link-type="biblio" href="#biblio-http">[HTTP]</a> <a data-link-type="biblio" href="#biblio-http-semantics">[HTTP-SEMANTICS]</a> <a data-link-type="biblio" href="#biblio-http-cond">[HTTP-COND]</a> <a data-link-type="biblio" href="#biblio-http-caching">[HTTP-CACHING]</a> <a data-link-type="biblio" href="#biblio-http-auth">[HTTP-AUTH]</a> </p>
      <li>
       <p>Wait until all the <a data-link-type="dfn" href="#concept-header">headers</a> are transmitted or <a data-link-type="dfn" href="#concept-fetch">fetch</a> is being <a data-link-type="dfn" href="#concept-fetch-terminate">terminated</a> with reason <var>reason</var>. If <a data-link-type="dfn" href="#concept-fetch">fetch</a> is being <a data-link-type="dfn" href="#concept-fetch-terminate">terminated</a>, then set <var>response</var>’s <a data-link-type="dfn" href="#concept-response-termination-reason">termination reason</a> to <var>reason</var>. </p>
      <li>
       <p>Any <a data-link-type="dfn" href="#concept-response">responses</a> whose <a data-link-type="dfn" href="#concept-response-status">status</a> is in the range <code>100</code> to <code>199</code>, inclusive, and is not <code>101</code>, are to be ignored. </p>
       <p class="note no-backref" role="note">These kind of <a data-link-type="dfn" href="#concept-response">responses</a> are
    eventually followed by a "final" <a data-link-type="dfn" href="#concept-response">response</a>. </p>
     </ul>
     <p class="note" role="note">The exact layering between Fetch and HTTP still needs to be sorted through and
  therefore <var>response</var> represents both a <a data-link-type="dfn" href="#concept-response">response</a> and
  an HTTP response here. </p>
     <p>If the HTTP request results in a TLS client certificate dialog, run these substeps: </p>
     <ol>
      <li>
       <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-window">window</a> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a>, make the dialog
   available in <var>request</var>’s <a data-link-type="dfn" href="#concept-request-window">window</a>. </p>
      <li>
       <p>Otherwise, return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
     </ol>
     <p>If <var>response</var> was retrieved over HTTPS, set its <a data-link-type="dfn" href="#concept-response-https-state">HTTPS state</a> to either
  "<code>deprecated</code>" or "<code>modern</code>". <a data-link-type="biblio" href="#biblio-tls">[TLS]</a> </p>
     <p class="note no-backref" role="note">The exact determination here is up to user agents for the
  time being. User agents are strongly encouraged to only succeed HTTPS connections with
  strong security properties and return <a data-link-type="dfn" href="#concept-network-error">network errors</a> otherwise. Using the
  "<code>deprecated</code>" state value ought to be a temporary and last resort kind
  of option. </p>
     <p><a data-link-type="dfn" href="#read-a-request">Read <var>request</var></a>. </p>
    <li>
     <p>Let <var>strategy</var> be an object. The user agent may choose any object. </p>
     <p class="note no-backref" role="note"><var>strategy</var> is used to control the queuing strategy of <var>stream</var> constructed below. </p>
    <li>
     <p>Let <var>pull</var> be an action that <a data-link-type="dfn" href="#concept-fetch-resume">resumes</a> the
 ongoing fetch if it is <a data-link-type="dfn" href="#concept-fetch-suspend">suspended</a>. </p>
    <li>
     <p>Let <var>cancel</var> be an action that <a data-link-type="dfn" href="#concept-fetch-terminate">terminates</a> the ongoing fetch with reason <i>end-user abort</i>. </p>
    <li>
     <p>Let <var>stream</var> be the result of <a data-link-type="dfn" href="#concept-construct-readablestream">constructing</a> a <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object with <var>strategy</var>, <var>pull</var> and <var>cancel</var>. </p>
     <p class="note no-backref" role="note">This construction operation will not throw an exception. </p>
    <li>
     <p>Set <var>response</var>’s <a data-link-type="dfn" href="#concept-response-body">body</a> to a new <a data-link-type="dfn" href="#concept-body">body</a> whose <a data-link-type="dfn" href="#concept-body-stream">stream</a> is <var>stream</var>. </p>
    <li>
     <p>If <var>response</var> has a payload body length, then set <var>response</var>’s <a data-link-type="dfn" href="#concept-response-body">body</a>’s <a data-link-type="dfn" href="#concept-body-total-bytes">total bytes</a> to that payload body length. </p>
    <li>
     <p><a data-link-type="dfn" href="#concept-header-list-delete">Delete</a> `<code>Content-Encoding</code>` from <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a> if one of the following
  conditions is true: </p>
     <ul class="brief">
      <li><a data-link-type="dfn" href="#concept-header-parse">Parsing</a> `<code>Content-Encoding</code>` in <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a> returns
   `<code>gzip</code>` and <a data-link-type="dfn" href="#concept-header-parse">parsing</a> `<code>Content-Type</code>` in <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a> returns
   `<code>application/gzip</code>`, `<code>application/x-gunzip</code>`, or
   `<code>application/x-gzip</code>`. 
      <li><a data-link-type="dfn" href="#concept-header-parse">Parsing</a> `<code>Content-Encoding</code>` in <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a> returns
   `<code>compress</code>` and <a data-link-type="dfn" href="#concept-header-parse">parsing</a> `<code>Content-Type</code>` in <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a> returns
   `<code>application/compress</code>` or
   `<code>application/x-compress</code>. 
     </ul>
     <p class="note" role="note">This deals with broken Apache configurations. Ideally HTTP would define
  this. </p>
     <p class="XXX">Gecko <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1030660">bug 1030660</a> looks
  into whether this quirk can be removed. </p>
    <li>
     <p>Execute <a href="https://w3c.github.io/webappsec-csp/#set-response-csp-list">set <var>response</var>’s CSP list</a> on <var>response</var>. <a data-link-type="biblio" href="#biblio-csp">[CSP]</a> </p>
    <li>
     <p>If <var>response</var> is not a <a data-link-type="dfn" href="#concept-network-error">network error</a> and <var>request</var>’s <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> is not "<code>no-store</code>",
 update <var>response</var> in the HTTP cache for <var>request</var>. </p>
    <li>
     <p>If <i>credentials flag</i> is set and the user agent is not configured to block cookies for <var>request</var> (see <a href="https://tools.ietf.org/html/rfc6265#section-7">section 7</a> of <a data-link-type="biblio" href="#biblio-cookies">[COOKIES]</a>), then run the "set-cookie-string" parsing algorithm (see <a href="https://tools.ietf.org/html/rfc6265#section-5.2">section 5.2</a> of <a data-link-type="biblio" href="#biblio-cookies">[COOKIES]</a>) on the <a data-link-type="dfn" href="#concept-header-value">value</a> of each <var>header</var> <a data-link-type="dfn" href="#concept-header-name">named</a> `<code>Set-Cookie</code>`
  in <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>, if any, and <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>. </p>
     <p class="note" role="note">This is a fingerprinting vector. </p>
    <li>
     <p>Run these substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a>: </p>
     <ol>
      <li>
       <p>Whenever one or more bytes are transmitted from <var>response</var>’s message body, let <var>bytes</var> be the transmitted bytes and run these subsubsteps: </p>
       <ol>
        <li>
         <p>Increase <var>response</var>’s <a data-link-type="dfn" href="#concept-response-body">body</a>’s <a data-link-type="dfn" href="#concept-body-transmitted">transmitted bytes</a> with <var>bytes</var>’
     length. </p>
        <li>
         <p>Let <var>codings</var> be the result of <a data-link-type="dfn" href="#concept-header-parse">parsing</a> `<code>Content-Encoding</code>`
     in <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
        <li>
         <p>Set <var>bytes</var> to the result of <a data-link-type="dfn" href="#handle-content-codings">handling
      content codings</a> given <var>codings</var> and <var>bytes</var>. </p>
         <p class="note no-backref" role="note">This makes the `<code>Content-Length</code>` <a data-link-type="dfn" href="#concept-header">header</a> unreliable to the extent that it was reliable
      to begin with. </p>
        <li>
         <p><a data-link-type="dfn" href="#concept-enqueue-readablestream">Enqueue</a> a <code>Uint8Array</code> object wrapping an <code>ArrayBuffer</code> containing <var>bytes</var> to <var>stream</var>.
      If that threw an exception, <a data-link-type="dfn" href="#concept-fetch-terminate">terminate</a> the ongoing
      fetch with <i>fatal</i>, <a data-link-type="abstract-op" href="#concept-error-readablestream">error</a> <var>stream</var> with that exception and abort these subsubsteps. </p>
        <li>
         <p>If <var>stream</var> doesn’t <a data-link-type="dfn" href="#concept-readablestream-need-more-data">need more
     data</a> and <var>request</var>’s <a data-link-type="dfn" href="#synchronous-flag">synchronous flag</a> is unset, ask the user agent
     to <a data-link-type="dfn" href="#concept-fetch-suspend">suspend</a> the ongoing fetch. </p>
       </ol>
      <li>
       <p>If at any point the bytes transmission for <var>response</var>’s message body is done
   normally and <var>stream</var> is <a data-link-type="dfn" href="#concept-readablestream-readable">readable</a>,
   then <a data-link-type="abstract-op" href="#concept-close-readablestream">close</a> <var>stream</var>. </p>
      <li>
       <p>If at any point <a data-link-type="dfn" href="#concept-fetch">fetch</a> is <a data-link-type="dfn" href="#concept-fetch-terminate">terminated</a> with reason <var>reason</var>,
    run these subsubsteps: </p>
       <ol>
        <li>
         <p>Set <var>response</var>’s <a data-link-type="dfn" href="#concept-response-termination-reason">termination
     reason</a> to <var>reason</var>. </p>
        <li>
         <p>If <var>stream</var> is <a data-link-type="dfn" href="#concept-readablestream-readable">readable</a>, <a data-link-type="abstract-op" href="#concept-error-readablestream">error</a> <var>stream</var> with a <code>TypeError</code>. </p>
       </ol>
     </ol>
     <p class="note no-backref" role="note">These are run <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a> as at this point it is unclear whether <var>response</var>’s <a data-link-type="dfn" href="#concept-response-body">body</a> is relevant (<var>response</var> might be a redirect). </p>
    <li>
     <p>Return <var>response</var>. <span class="note no-backref">Typically <var>response</var>’s <a data-link-type="dfn" href="#concept-response-body">body</a>’s <a data-link-type="dfn" href="#concept-body-stream">stream</a> is still being enqueued to after returning.</span> </p>
   </ol>
   <h3 class="heading settled" data-level="5.7" id="cors-preflight-fetch"><span class="secno">5.7. </span><span class="content">CORS-preflight fetch</span><a class="self-link" href="#cors-preflight-fetch"></a></h3>
   <p class="note no-backref" role="note">This is effectively the user agent implementation of the check to see if
the <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a> is understood. The so-called <a data-link-type="dfn" href="#cors-preflight-request">CORS-preflight request</a>. If
successful it populates the <a data-link-type="dfn" href="#concept-cache">CORS-preflight cache</a> to minimize the
number of these <a data-link-type="dfn" href="#cors-preflight-fetch-0">fetches</a>. </p>
   <p>To perform a <dfn data-dfn-type="dfn" data-noexport="" id="cors-preflight-fetch-0">CORS-preflight fetch<a class="self-link" href="#cors-preflight-fetch-0"></a></dfn> using <var>request</var>, run these
steps: </p>
   <ol>
    <li>
     <p>Let <var>preflight</var> be a new <a data-link-type="dfn" href="#concept-request">request</a> whose <a data-link-type="dfn" href="#concept-request-method">method</a> is `<code>OPTIONS</code>`, <a data-link-type="dfn" href="#concept-request-url">url</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>, <a data-link-type="dfn" href="#concept-request-initiator">initiator</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-initiator">initiator</a>, <a data-link-type="dfn" href="#concept-request-type">type</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-type">type</a>, <a data-link-type="dfn" href="#concept-request-destination">destination</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-destination">destination</a>, <a data-link-type="dfn" href="#concept-request-origin">origin</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-origin">origin</a>, <a data-link-type="dfn" href="#concept-request-referrer">referrer</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer">referrer</a>, and <a data-link-type="dfn" href="#concept-request-referrer-policy">referrer policy</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer-policy">referrer policy</a>. </p>
    <li>
     <p><a data-link-type="dfn" href="#concept-header-list-set">Set</a> `<a data-link-type="dfn" href="#http-access-control-request-method"><code>Access-Control-Request-Method</code></a>` to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-method">method</a> in <var>preflight</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
    <li>
     <p>Let <var>headers</var> be the <a data-link-type="dfn" href="#concept-header-name">names</a> of <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>’s <a data-link-type="dfn" href="#concept-header">headers</a>, excluding <a data-link-type="dfn" href="#cors-safelisted-request-header">CORS-safelisted request-headers</a> and duplicates,
 sorted lexicographically, and <a data-link-type="dfn" href="#byte-lowercase">byte-lowercased</a>. </p>
    <li>
     <p>Let <var>value</var> be the items in <var>headers</var> separated from each other by 0x2C. </p>
    <li>
     <p><a data-link-type="dfn" href="#concept-header-list-set">Set</a> `<a data-link-type="dfn" href="#http-access-control-request-headers"><code>Access-Control-Request-Headers</code></a>`
 to <var>value</var> in <var>preflight</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
    <li>
     <p>Let <var>response</var> be the result of performing an <a data-link-type="dfn" href="#concept-http-network-or-cache-fetch">HTTP-network-or-cache fetch</a> using <var>preflight</var>. </p>
    <li>
     <p>If a <a data-link-type="dfn" href="#concept-cors-check">CORS check</a> for <var>request</var> and <var>response</var> returns success and <var>response</var>’s <a data-link-type="dfn" href="#concept-response-status">status</a> is an <a data-link-type="dfn" href="#ok-status">ok status</a>, run these
  substeps: </p>
     <p class="note no-backref" role="note">The <a data-link-type="dfn" href="#concept-cors-check">CORS check</a> is done
  on <var>request</var> rather than <var>preflight</var> to ensure the correct <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is used. </p>
     <ol>
      <li>
       <p>Let <var>methods</var> be the result of <a data-link-type="dfn" href="#concept-header-parse">parsing</a> `<a data-link-type="dfn" href="#http-access-control-allow-methods"><code>Access-Control-Allow-Methods</code></a>` in <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
      <li>
       <p>If <var>methods</var> is `<code>*</code>`, then set <var>methods</var> to a new list
   containing `<code>*</code>`. </p>
      <li>
       <p>Let <var>headerNames</var> be the result of <a data-link-type="dfn" href="#concept-header-parse">parsing</a> `<a data-link-type="dfn" href="#http-access-control-allow-headers"><code>Access-Control-Allow-Headers</code></a>` in <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
      <li>
       <p>If either <var>methods</var> or <var>headerNames</var> is failure,
   return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
      <li>
       <p>If <var>methods</var> or <var>headerNames</var> contains `<code>*</code>`, and <var>request</var>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is
   "<code>include</code>", then return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
      <li>
       <p>If <var>methods</var> is null and <var>request</var>’s <a data-link-type="dfn" href="#use-cors-preflight-flag">use-CORS-preflight flag</a> is set, then set <var>methods</var> to a new list containing <var>request</var>’s <a data-link-type="dfn" href="#concept-request-method">method</a>. </p>
       <p class="note no-backref" role="note">This ensures that a <a data-link-type="dfn" href="#cors-preflight-fetch-0">CORS-preflight fetch</a> that
    happened due to <var>request</var>’s <a data-link-type="dfn" href="#use-cors-preflight-flag">use-CORS-preflight flag</a> being set is <a data-link-type="dfn" href="#concept-cache">cached</a>. </p>
      <li>
       <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-method">method</a> is not in <var>methods</var>, is not a <a data-link-type="dfn" href="#cors-safelisted-method">CORS-safelisted method</a>, and <var>methods</var> does <em>not</em> contain `<code>*</code>`, then return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
      <li>
       <p>If one of <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>’s <a data-link-type="dfn" href="#concept-header-name">names</a> is a <a data-link-type="dfn" href="#cors-non-wildcard-request-header-name">CORS non-wildcard request-header name</a> and is not in <var>headerNames</var>, then
   return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
      <li>
       <p>If one of <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>' <a data-link-type="dfn" href="#concept-header-name">names</a> is not in <var>headerNames</var>, its corresponding <a data-link-type="dfn" href="#concept-header">header</a> is not a <a data-link-type="dfn" href="#cors-safelisted-request-header">CORS-safelisted request-header</a>,
   and <var>headerNames</var> does <em>not</em> contain `<code>*</code>`, then return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
      <li>
       <p>Let <var>max-age</var> be the result of <a data-link-type="dfn" href="#concept-header-parse">parsing</a> `<a data-link-type="dfn" href="#http-access-control-max-age"><code>Access-Control-Max-Age</code></a>` in <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
      <li>
       <p>If <var>max-age</var> is failure or null, then set <var>max-age</var> to zero. </p>
      <li>
       <p>If <var>max-age</var> is greater than an imposed limit on <a data-link-type="dfn" href="#concept-cache-max-age">max-age</a>, then set <var>max-age</var> to the imposed
   limit. </p>
      <li>
       <p>If the user agent does not provide for a <a data-link-type="dfn" href="#concept-cache">cache</a>, then
   return <var>response</var>. </p>
      <li>
       <p>For each <var>method</var> in <var>methods</var> for which there is
   a <a data-link-type="dfn" href="#concept-cache-match-method">method cache match</a> using <var>request</var>, set matching entry’s <a data-link-type="dfn" href="#concept-cache-max-age">max-age</a> to <var>max-age</var>. </p>
      <li>
       <p>For each <var>method</var> in <var>methods</var> for which there is <em>no</em> <a data-link-type="dfn" href="#concept-cache-match-method">method cache match</a> using <var>request</var>, <a data-link-type="dfn" href="#concept-cache-create-entry">create a new entry</a> with <var>request</var>, <var>max-age</var>, <var>method</var>, and null. </p>
      <li>
       <p>For each <var>headerName</var> in <var>headerNames</var> for which
   there is a <a data-link-type="dfn" href="#concept-cache-match-header">header-name cache match</a> using <var>request</var>, set matching entry’s <a data-link-type="dfn" href="#concept-cache-max-age">max-age</a> to <var>max-age</var>. </p>
      <li>
       <p>For each <var>headerName</var> in <var>headerNames</var> for which there is <em>no</em> <a data-link-type="dfn" href="#concept-cache-match-header">header-name cache match</a> using <var>request</var>, <a data-link-type="dfn" href="#concept-cache-create-entry">create a new entry</a> with <var>request</var>, <var>max-age</var>, null, and <var>headerName</var>. </p>
      <li>
       <p>Return <var>response</var>. </p>
     </ol>
    <li>
     <p>Otherwise, return a <a data-link-type="dfn" href="#concept-network-error">network error</a>. </p>
   </ol>
   <h3 class="heading settled" data-level="5.8" id="cors-preflight-cache"><span class="secno">5.8. </span><span class="content">CORS-preflight cache</span><a class="self-link" href="#cors-preflight-cache"></a></h3>
   <p>A <dfn data-dfn-type="dfn" data-noexport="" id="concept-cache">CORS-preflight cache<a class="self-link" href="#concept-cache"></a></dfn> consists of a collection of
entries where each entry has these fields: </p>
   <ul class="brief">
    <li><dfn data-dfn-for="cache" data-dfn-type="dfn" data-noexport="" id="concept-cache-origin">origin<a class="self-link" href="#concept-cache-origin"></a></dfn> (an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">origin</a>) 
    <li><dfn data-dfn-for="cache" data-dfn-type="dfn" data-noexport="" id="concept-cache-url">url<a class="self-link" href="#concept-cache-url"></a></dfn> (a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url">URL</a>) 
    <li><dfn data-dfn-for="cache" data-dfn-type="dfn" data-noexport="" id="concept-cache-max-age">max-age<a class="self-link" href="#concept-cache-max-age"></a></dfn> (a number of seconds) 
    <li><dfn data-dfn-for="cache" data-dfn-type="dfn" data-noexport="" id="concept-cache-credentials">credentials<a class="self-link" href="#concept-cache-credentials"></a></dfn> (a boolean) 
    <li><dfn data-dfn-for="cache" data-dfn-type="dfn" data-noexport="" id="concept-cache-method">method<a class="self-link" href="#concept-cache-method"></a></dfn> (null, `<code>*</code>`, or a <a data-link-type="dfn" href="#concept-method">method</a>) 
    <li><dfn data-dfn-for="cache" data-dfn-type="dfn" data-noexport="" id="concept-cache-header-name">header name<a class="self-link" href="#concept-cache-header-name"></a></dfn> (null, `<code>*</code>`, or a <a data-link-type="dfn" href="#concept-header">header</a> <a data-link-type="dfn" href="#concept-header-name">name</a>) 
   </ul>
   <p>Entries must be removed after the seconds specified in the <a data-link-type="dfn" href="#concept-cache-max-age">max-age</a> field have passed since storing the entry.
Entries may be removed before that moment arrives. </p>
   <p>To <dfn data-dfn-for="cache" data-dfn-type="dfn" data-noexport="" id="concept-cache-create-entry">create a new entry<a class="self-link" href="#concept-cache-create-entry"></a></dfn> in the <a data-link-type="dfn" href="#concept-cache">CORS-preflight cache</a>, given <var>request</var>, <var>max-age</var>, <var>method</var>, and <var>headerName</var>, do so as follows: </p>
   <dl>
    <dt><a data-link-type="dfn" href="#concept-cache-origin">origin</a> 
    <dd><var>request</var>’s <a data-link-type="dfn" href="#concept-request-origin">origin</a> 
    <dt><a data-link-type="dfn" href="#concept-cache-url">url</a> 
    <dd><var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a> 
    <dt><a data-link-type="dfn" href="#concept-cache-max-age">max-age</a> 
    <dd><var>max-age</var> 
    <dt><a data-link-type="dfn" href="#concept-cache-credentials">credentials</a> 
    <dd>True if <var>request</var>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is
 "<code>include</code>", and false otherwise 
    <dt><a data-link-type="dfn" href="#concept-cache-method">method</a> 
    <dd><var>method</var> 
    <dt><a data-link-type="dfn" href="#concept-cache-header-name">header name</a> 
    <dd><var>headerName</var> 
   </dl>
   <p>To <dfn data-dfn-for="cache" data-dfn-type="dfn" data-noexport="" id="concept-cache-clear">clear cache entries<a class="self-link" href="#concept-cache-clear"></a></dfn>, given a <var>request</var>, remove any entries in the <a data-link-type="dfn" href="#concept-cache">CORS-preflight cache</a> whose <a data-link-type="dfn" href="#concept-cache-origin">origin</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-origin">origin</a> and whose <a data-link-type="dfn" href="#concept-cache-url">url</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>. </p>
   <p>There is a <dfn data-dfn-for="cache" data-dfn-type="dfn" data-noexport="" id="concept-cache-match">cache match<a class="self-link" href="#concept-cache-match"></a></dfn> for <var>request</var> if <a data-link-type="dfn" href="#concept-cache-origin">origin</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-origin">origin</a>, <a data-link-type="dfn" href="#concept-cache-url">url</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>, and one of </p>
   <ul class="brief">
    <li><a data-link-type="dfn" href="#concept-cache-credentials">credentials</a> is true 
    <li><a data-link-type="dfn" href="#concept-cache-credentials">credentials</a> is false and <var>request</var>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is <em>not</em> "<code>include</code>" 
   </ul>
   <p>is true. </p>
   <p>There is a <dfn data-dfn-for="cache" data-dfn-type="dfn" data-noexport="" id="concept-cache-match-method">method cache match<a class="self-link" href="#concept-cache-match-method"></a></dfn> for <var>method</var> using <var>request</var> when there is an entry in <a data-link-type="dfn" href="#concept-cache">CORS-preflight cache</a> for which there is a <a data-link-type="dfn" href="#concept-cache-match">cache match</a> for <var>request</var> and its <a data-link-type="dfn" href="#concept-cache-method">method</a> is <var>method</var> or `<code>*</code>`. </p>
   <p>There is a <dfn data-dfn-for="cache" data-dfn-type="dfn" data-noexport="" id="concept-cache-match-header">header-name cache match<a class="self-link" href="#concept-cache-match-header"></a></dfn> for <var>headerName</var> using <var>request</var> when there is an entry in <a data-link-type="dfn" href="#concept-cache">CORS-preflight cache</a> for which there is a <a data-link-type="dfn" href="#concept-cache-match">cache match</a> for <var>request</var> and one of </p>
   <ul class="brief">
    <li><a data-link-type="dfn" href="#concept-cache-header-name">header name</a> is <var>headerName</var> 
    <li><a data-link-type="dfn" href="#concept-cache-header-name">header name</a> is `<code>*</code>` and <var>headerName</var> is <em>not</em> a <a data-link-type="dfn" href="#cors-non-wildcard-request-header-name">CORS non-wildcard request-header name</a> 
   </ul>
   <p>is true. </p>
   <h3 class="heading settled" data-level="5.9" id="cors-check"><span class="secno">5.9. </span><span class="content">CORS check</span><a class="self-link" href="#cors-check"></a></h3>
   <p>To perform a <dfn data-dfn-for="cors" data-dfn-type="dfn" data-noexport="" id="concept-cors-check">CORS check<a class="self-link" href="#concept-cors-check"></a></dfn> for a <var>request</var> and <var>response</var>, run these steps: </p>
   <ol>
    <li>
     <p>Let <var>origin</var> be the result of <a data-link-type="dfn" href="#concept-header-parse">parsing</a> `<a data-link-type="dfn" href="#http-access-control-allow-origin"><code>Access-Control-Allow-Origin</code></a>` in <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
    <li>
     <p>If <var>origin</var> is null or failure, return failure. </p>
     <p class="note" role="note">Null is not `<code>null</code>`. </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is not
 "<code>include</code>" and <var>origin</var> is `<code>*</code>`, return success. </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-origin">origin</a>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin">serialized</a> and <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8-encode">utf-8 encoded</a>, is not <var>origin</var>, return failure. </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is not
 "<code>include</code>", return success. </p>
    <li>
     <p>Let <var>credentials</var> be the result of <a data-link-type="dfn" href="#concept-header-parse">parsing</a> `<a data-link-type="dfn" href="#http-access-control-allow-credentials"><code>Access-Control-Allow-Credentials</code></a>`
 in <var>response</var>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
    <li>
     <p>If <var>credentials</var> is `<code>true</code>`, return success. </p>
     <p class="XXX">It has been suggested to check for <var>origin</var> not being
  `<code>null</code>` here as that would be equal to allowing credentials and
  `<code>*</code>` which is also forbidden. </p>
    <li>
     <p>Return failure. </p>
   </ol>
   <h2 class="heading settled" data-level="6" id="fetch-api"><span class="secno">6. </span><span class="content">Fetch API</span><a class="self-link" href="#fetch-api"></a></h2>
   <p class="no-backref">The <a data-link-type="functionish" href="#dom-global-fetch"><code>fetch()</code></a> method is relatively
low-level API for <a data-link-type="dfn" href="#concept-fetch">fetching</a> resources. It covers slightly
more ground than <code class="idl"><a data-link-type="idl" href="https://xhr.spec.whatwg.org/#xmlhttprequest">XMLHttpRequest</a></code>, although it is
currently lacking when it comes to request progression (not response progression). </p>
   <div class="example no-backref" id="fetch-blob-example">
    <a class="self-link" href="#fetch-blob-example"></a> 
    <p>The <a data-link-type="functionish" href="#dom-global-fetch"><code>fetch()</code></a> method makes it quite straightforward
 to <a data-link-type="dfn" href="#concept-fetch">fetch</a> a resource and extract its contents as a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob">Blob</a></code>: </p>
<pre>fetch("/music/pk/altes-kamuffel.flac")
  .then(res => res.blob()).then(playBlob)</pre>
    <p>If you just care to log a particular response header: </p>
<pre>fetch("/", {method:"HEAD"})
  .then(res => log(res.headers.get("strict-transport-security")))</pre>
    <p>If you want to check a particular response header and then process the response of a
 cross-origin resources: </p>
<pre>fetch("https://pk.example/berlin-calling.json", {mode:"cors"})
  .then(res => {
    if(res.headers.get("content-type") &amp;&amp;
       res.headers.get("content-type").toLowerCase().indexOf("application/json") >= 0) {
      return res.json()
    } else {
      throw new TypeError()
    }
  }).then(processJSON)</pre>
    <p>If you want to work with URL query parameters: </p>
<pre>var url = new URL("https://geo.example.org/api"),
    params = {lat:35.696233, long:139.570431}
Object.keys(params).forEach(key => url.searchParams.append(key, params[key]))
fetch(url).then(/* … */)</pre>
    <p>If you want to receive the body data progressively: </p>
<pre>function consume(reader) {
  var total = 0
  return pump()
  function pump() {
    return reader.read().then(({done, value}) => {
      if (done) {
        return
      }
      total += value.byteLength
      log(`received ${value.byteLength} bytes (${total} bytes in total)`)
      return pump()
    })
  }
}

fetch("/music/pk/altes-kamuffel.flac")
  .then(res => consume(res.body.getReader()))
  .then(() => log("consumed the entire body without keeping the whole thing in memory!"))
  .catch(e => log("something went wrong: " + e))</pre>
   </div>
   <h3 class="heading settled" data-level="6.1" id="headers-class"><span class="secno">6.1. </span><span class="content">Headers class</span><a class="self-link" href="#headers-class"></a></h3>
<pre class="idl def" data-no-idl="">typedef (Headers or sequence&lt;sequence&lt;ByteString>> or OpenEndedDictionary&lt;ByteString>) <dfn class="idl-code" data-dfn-type="typedef" data-export="" id="headersinit">HeadersInit<a class="self-link" href="#headersinit"></a></dfn>;</pre>
   <div class="XXX">
    <p>OpenEndedDictionary&lt;T> is a future IDL construct. Expect it to be used as such: </p>
<pre>var meta = { "Content-Type": "text/xml", "Breaking-Bad": "&lt;3" }
new Headers(meta)</pre>
    <p>See <a href="https://github.com/whatwg/fetch/issues/164">issue #164</a> for discussion. </p>
   </div>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="constructor" href="#dom-headers">Constructor</a>(<span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#headersinit">HeadersInit</a> <dfn class="nv idl-code" data-dfn-for="Headers/Headers(init)" data-dfn-type="argument" data-export="" id="dom-headers-headers-init-init">init<a class="self-link" href="#dom-headers-headers-init-init"></a></dfn>), <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<span class="n">Window</span>,<span class="n">Worker</span>)]
<span class="kt">interface</span> <dfn class="nv idl-code" data-dfn-type="interface" data-export="" id="headers">Headers<a class="self-link" href="#headers"></a></dfn> {
  <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-headers-append">append</a>(<span class="kt">ByteString</span> <dfn class="nv idl-code" data-dfn-for="Headers/append(name, value)" data-dfn-type="argument" data-export="" id="dom-headers-append-name-value-name">name<a class="self-link" href="#dom-headers-append-name-value-name"></a></dfn>, <span class="kt">ByteString</span> <dfn class="nv idl-code" data-dfn-for="Headers/append(name, value)" data-dfn-type="argument" data-export="" id="dom-headers-append-name-value-value">value<a class="self-link" href="#dom-headers-append-name-value-value"></a></dfn>);
  <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-headers-delete">delete</a>(<span class="kt">ByteString</span> <dfn class="nv idl-code" data-dfn-for="Headers/delete(name)" data-dfn-type="argument" data-export="" id="dom-headers-delete-name-name">name<a class="self-link" href="#dom-headers-delete-name-name"></a></dfn>);
  <span class="kt">ByteString</span>? <a class="nv idl-code" data-link-type="method" href="#dom-headers-get">get</a>(<span class="kt">ByteString</span> <dfn class="nv idl-code" data-dfn-for="Headers/get(name)" data-dfn-type="argument" data-export="" id="dom-headers-get-name-name">name<a class="self-link" href="#dom-headers-get-name-name"></a></dfn>);
  <span class="kt">boolean</span> <a class="nv idl-code" data-link-type="method" href="#dom-headers-has">has</a>(<span class="kt">ByteString</span> <dfn class="nv idl-code" data-dfn-for="Headers/has(name)" data-dfn-type="argument" data-export="" id="dom-headers-has-name-name">name<a class="self-link" href="#dom-headers-has-name-name"></a></dfn>);
  <span class="kt">void</span> <a class="nv idl-code" data-link-type="method" href="#dom-headers-set">set</a>(<span class="kt">ByteString</span> <dfn class="nv idl-code" data-dfn-for="Headers/set(name, value)" data-dfn-type="argument" data-export="" id="dom-headers-set-name-value-name">name<a class="self-link" href="#dom-headers-set-name-value-name"></a></dfn>, <span class="kt">ByteString</span> <dfn class="nv idl-code" data-dfn-for="Headers/set(name, value)" data-dfn-type="argument" data-export="" id="dom-headers-set-name-value-value">value<a class="self-link" href="#dom-headers-set-name-value-value"></a></dfn>);
  <span class="kt">iterable</span>&lt;<span class="kt">ByteString</span>, <span class="kt">ByteString</span>>;
};</pre>
   <p>A <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object has an associated <dfn data-dfn-for="Headers" data-dfn-type="dfn" data-export="" id="concept-headers-header-list">header list<a class="self-link" href="#concept-headers-header-list"></a></dfn> (a <a data-link-type="dfn" href="#concept-header-list">header list</a>), which is initially empty. <span class="note">This
can be a pointer to the <a data-link-type="dfn" href="#concept-header-list">header list</a> of something else, e.g.,
of a <a data-link-type="dfn" href="#concept-request">request</a> as demonstrated by <code class="idl"><a data-link-type="idl" href="#request">Request</a></code> objects.</span> </p>
   <p>A <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object also has an associated <dfn data-dfn-for="Headers" data-dfn-type="dfn" data-export="" id="concept-headers-guard">guard<a class="self-link" href="#concept-headers-guard"></a></dfn>, which is
"<code>immutable</code>",
"<code>request</code>",
"<code>request-no-cors</code>",
"<code>response</code>" or
"<code>none</code>". </p>
   <p class="note no-backref" role="note">"<code>immutable</code>" exists for service workers. <a data-link-type="biblio" href="#biblio-sw">[SW]</a> </p>
   <p>To <dfn data-dfn-for="Headers" data-dfn-type="dfn" data-export="" id="concept-headers-append">append<a class="self-link" href="#concept-headers-append"></a></dfn> a <a data-link-type="dfn" href="#concept-header-name">name</a>/<a data-link-type="dfn" href="#concept-header-value">value</a> (<var>name</var>/<var>value</var>) pair to a <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object (<var>headers</var>), run these steps: </p>
   <ol>
    <li>
     <p><a data-link-type="dfn" href="#concept-header-value-normalize">Normalize</a> <var>value</var>. </p>
    <li>
     <p>If <var>name</var> is not a <a data-link-type="dfn" href="#concept-header-name">name</a> or <var>value</var> is not a <a data-link-type="dfn" href="#concept-header-value">value</a>, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <li>
     <p>If <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is "<code>immutable</code>", then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <li>
     <p>Otherwise, if <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is
 "<code>request</code>" and <var>name</var> is a <a data-link-type="dfn" href="#forbidden-header-name">forbidden header name</a>,
 return. </p>
    <li>
     <p>Otherwise, if <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is
 "<code>request-no-cors</code>" and <var>name</var>/<var>value</var> is not a <a data-link-type="dfn" href="#cors-safelisted-request-header">CORS-safelisted request-header</a>, return. </p>
    <li>
     <p>Otherwise, if <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is
 "<code>response</code>" and <var>name</var> is a <a data-link-type="dfn" href="#forbidden-response-header-name">forbidden response-header name</a>, return. </p>
    <li>
     <p><a data-link-type="dfn" href="#concept-header-list-append">Append</a> <var>name</var>/<var>value</var> to <a data-link-type="dfn" href="#concept-headers-header-list">header list</a>. </p>
   </ol>
   <p>To <dfn data-dfn-for="Headers" data-dfn-type="dfn" data-export="" id="concept-headers-fill">fill<a class="self-link" href="#concept-headers-fill"></a></dfn> a <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object (<var>headers</var>) with a given object (<var>object</var>),
run these steps: </p>
   <ol>
    <li>
     <p>If <var>object</var> is a <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object, then for each <var>header</var> in its <a data-link-type="dfn" href="#concept-headers-header-list">header list</a>, retaining order, <a data-link-type="dfn" href="#concept-headers-append">append</a> <var>header</var>’s <a data-link-type="dfn" href="#concept-header-name">name</a>/<var>header</var>’s <a data-link-type="dfn" href="#concept-header-value">value</a> to <var>headers</var>. Rethrow any exception. </p>
     <p class="note" role="note">Once <code>Headers.prototype[Symbol.iterator]</code> is defined this
  special casing will no longer be needed. </p>
    <li>
     <p>Otherwise, if <var>object</var> is a sequence, then for each <var>header</var> in <var>object</var>, run these substeps: </p>
     <ol>
      <li>
       <p>If <var>header</var> does not contain exactly two items, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
      <li>
       <p><a data-link-type="dfn" href="#concept-headers-append">Append</a> <var>header</var>’s first item/<var>header</var>’s second item to <var>headers</var>. Rethrow any exception. </p>
     </ol>
    <li>
     <p>Otherwise, if <var>object</var> is an open-ended dictionary, then for each <var>header</var> in <var>object</var>, run these substeps: </p>
     <ol>
      <li>
       <p>Set <var>header</var>’s key to <var>header</var>’s key, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#es-ByteString">converted to ByteString</a>.
   Rethrow any exception. </p>
      <li>
       <p><a data-link-type="dfn" href="#concept-headers-append">Append</a> <var>header</var>’s key/<var>header</var>’s value to <var>headers</var>. Rethrow any exception. </p>
     </ol>
   </ol>
   <p>The <dfn class="idl-code" data-dfn-for="Headers" data-dfn-type="constructor" data-export="" id="dom-headers"><code>Headers(<var>init</var>)</code><a class="self-link" href="#dom-headers"></a></dfn> constructor, when invoked, must run these steps: </p>
   <ol>
    <li>
     <p>Let <var>headers</var> be a new <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object whose <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is "<code>none</code>". </p>
    <li>
     <p>If <var>init</var> is given, <a data-link-type="dfn" href="#concept-headers-fill">fill</a> <var>headers</var> with <var>init</var>. Rethrow any exception. </p>
    <li>
     <p>Return <var>headers</var>. </p>
   </ol>
   <p>The <dfn class="idl-code" data-dfn-for="Headers" data-dfn-type="method" data-export="" id="dom-headers-append"><code>append(<var>name</var>, <var>value</var>)</code><a class="self-link" href="#dom-headers-append"></a></dfn> method, when invoked, must <a data-link-type="dfn" href="#concept-headers-append">append</a> <var>name</var>/<var>value</var> to the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object">context object</a> and rethrow any exception. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Headers" data-dfn-type="method" data-export="" id="dom-headers-delete"><code>delete(<var>name</var>)</code><a class="self-link" href="#dom-headers-delete"></a></dfn> method, when invoked, must run these steps: </p>
   <ol>
    <li>
     <p>If <var>name</var> is not a <a data-link-type="dfn" href="#concept-header-name">name</a>, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <li>
     <p>If <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is "<code>immutable</code>", then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <li>
     <p>Otherwise, if <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is
 "<code>request</code>" and <var>name</var> is a <a data-link-type="dfn" href="#forbidden-header-name">forbidden header name</a>,
 return. </p>
    <li>
     <p>Otherwise, if <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is
 "<code>request-no-cors</code>" and <var>name</var>/`<code>invalid</code>` is
 not a <a data-link-type="dfn" href="#cors-safelisted-request-header">CORS-safelisted request-header</a>, then return. </p>
     <p class="note" role="note">`<code>invalid</code>` is used because <a class="idl-code" data-link-type="method" href="#dom-headers-delete"><code>delete()</code></a> is not passed a value as argument. </p>
    <li>
     <p>Otherwise, if <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is
 "<code>response</code>" and <var>name</var> is a <a data-link-type="dfn" href="#forbidden-response-header-name">forbidden response-header name</a>, return. </p>
    <li>
     <p><a data-link-type="dfn" href="#concept-header-list-delete">Delete</a> <var>name</var> from <a data-link-type="dfn" href="#concept-headers-header-list">header list</a>. </p>
   </ol>
   <p>The <dfn class="idl-code" data-dfn-for="Headers" data-dfn-type="method" data-export="" id="dom-headers-get"><code>get(<var>name</var>)</code><a class="self-link" href="#dom-headers-get"></a></dfn> method, when
invoked, must run these steps: </p>
   <ol>
    <li>
     <p>If <var>name</var> is not a <a data-link-type="dfn" href="#concept-header-name">name</a>, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <li>
     <p>If there is <em>no</em> <a data-link-type="dfn" href="#concept-header">header</a> in <a data-link-type="dfn" href="#concept-headers-header-list">header list</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is <var>name</var>, return null. </p>
    <li>
     <p>Return the <a data-link-type="dfn" href="#concept-header-value-combined">combined value</a> given <var>name</var> and <a data-link-type="dfn" href="#concept-headers-header-list">header list</a>. </p>
   </ol>
   <p>The <dfn class="idl-code" data-dfn-for="Headers" data-dfn-type="method" data-export="" id="dom-headers-has"><code>has(<var>name</var>)</code><a class="self-link" href="#dom-headers-has"></a></dfn> method,
when invoked, must run these steps: </p>
   <ol>
    <li>
     <p>If <var>name</var> is not a <a data-link-type="dfn" href="#concept-header-name">name</a>, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <li>
     <p>Return true if there is a <a data-link-type="dfn" href="#concept-header">header</a> in <a data-link-type="dfn" href="#concept-headers-header-list">header list</a> whose <a data-link-type="dfn" href="#concept-header-name">name</a> is <var>name</var>, and false
 otherwise. </p>
   </ol>
   <p>The <dfn class="idl-code" data-dfn-for="Headers" data-dfn-type="method" data-export="" id="dom-headers-set"><code>set(<var>name</var>, <var>value</var>)</code><a class="self-link" href="#dom-headers-set"></a></dfn> method, when invoked, must run these steps: </p>
   <ol>
    <li>
     <p><a data-link-type="dfn" href="#concept-header-value-normalize">Normalize</a> <var>value</var>. </p>
    <li>
     <p>If <var>name</var> is not a <a data-link-type="dfn" href="#concept-header-name">name</a> or <var>value</var> is not a <a data-link-type="dfn" href="#concept-header-value">value</a>, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <li>
     <p>If <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is "<code>immutable</code>", then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <li>
     <p>Otherwise, if <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is
 "<code>request</code>" and <var>name</var> is a <a data-link-type="dfn" href="#forbidden-header-name">forbidden header name</a>,
 return. </p>
    <li>
     <p>Otherwise, if <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is
 "<code>request-no-cors</code>" and <var>name</var>/<var>value</var> is not a <a data-link-type="dfn" href="#cors-safelisted-request-header">CORS-safelisted request-header</a>, return. </p>
    <li>
     <p>Otherwise, if <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is
 "<code>response</code>" and <var>name</var> is a <a data-link-type="dfn" href="#forbidden-response-header-name">forbidden response-header name</a>, return. </p>
    <li>
     <p><a data-link-type="dfn" href="#concept-header-list-set">Set</a> <var>name</var>/<var>value</var> in <a data-link-type="dfn" href="#concept-headers-header-list">header list</a>. </p>
   </ol>
   <p>The <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-value-pairs-to-iterate-over">value pairs to iterate over</a> are the return value of running <a data-link-type="dfn" href="#concept-header-list-sort-and-combine">sort and combine</a> with the <a data-link-type="dfn" href="#concept-headers-header-list">header list</a>. </p>
   <h3 class="heading settled" data-level="6.2" id="body-mixin"><span class="secno">6.2. </span><span class="content">Body mixin</span><a class="self-link" href="#body-mixin"></a></h3>
<pre class="idl highlight def"><span class="kt">typedef</span> (<a class="n" data-link-type="idl-name" href="https://w3c.github.io/FileAPI/#dfn-Blob">Blob</a> <span class="kt">or</span> <a class="n" data-link-type="idl-name" href="https://heycam.github.io/webidl/#BufferSource">BufferSource</a> <span class="kt">or</span> <a class="n" data-link-type="idl-name" href="https://xhr.spec.whatwg.org/#formdata">FormData</a> <span class="kt">or</span> <a class="n" data-link-type="idl-name" href="https://url.spec.whatwg.org/#urlsearchparams">URLSearchParams</a> <span class="kt">or</span> <span class="kt">USVString</span>) <dfn class="nv idl-code" data-dfn-type="typedef" data-export="" id="bodyinit">BodyInit<a class="self-link" href="#bodyinit"></a></dfn>;

<span class="kt">typedef</span> (<a class="n" data-link-type="idl-name" href="#bodyinit">BodyInit</a> <span class="kt">or</span> <a class="n" data-link-type="idl-name" href="#concept-readablestream">ReadableStream</a>) <dfn class="nv idl-code" data-dfn-type="typedef" data-export="" id="responsebodyinit">ResponseBodyInit<a class="self-link" href="#responsebodyinit"></a></dfn>;</pre>
   <p>To <dfn data-dfn-for="BodyInit" data-dfn-type="dfn" data-noexport="" id="concept-bodyinit-extract">extract<a class="self-link" href="#concept-bodyinit-extract"></a></dfn> a <a data-link-type="dfn" href="#concept-body">body</a> and a
`<code>Content-Type</code>` <a data-link-type="dfn" href="#concept-header-value">value</a> from <var>object</var>, with an optional <var>keepalive flag</var>, run these steps: </p>
   <ol>
    <li>
     <p>Let <var>stream</var> be the result of <a data-link-type="dfn" href="#concept-construct-readablestream">constructing</a> a <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object. </p>
    <li>
     <p>Let <var>Content-Type</var> be null. </p>
    <li>
     <p>Let <var>action</var> be null. </p>
    <li>
     <p>Switch on <var>object</var>’s type: </p>
     <dl class="switch">
      <dt><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob">Blob</a></code> 
      <dd>
       <p>Set <var>action</var> to an action that reads <var>object</var>. </p>
       <p>If <var>object</var>’s <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-type">type</a></code> attribute is not the empty byte sequence, set <var>Content-Type</var> to its value. </p>
      <dt><code>BufferSource</code> 
      <dd>
       <p><a data-link-type="dfn" href="#concept-enqueue-readablestream">Enqueue</a> a <code>Uint8Array</code> object
    wrapping an <code>ArrayBuffer</code> containing a copy of the bytes held by <var>object</var> to <var>stream</var> and <a data-link-type="abstract-op" href="#concept-close-readablestream">close</a> <var>stream</var>. If that threw an exception, <a data-link-type="abstract-op" href="#concept-error-readablestream">error</a> <var>stream</var> with that exception. </p>
      <dt><code class="idl"><a data-link-type="idl" href="https://xhr.spec.whatwg.org/#formdata">FormData</a></code> 
      <dd>
       <p>Set <var>action</var> to an action that runs the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/forms.html#multipart/form-data-encoding-algorithm"><code>multipart/form-data</code> encoding algorithm</a>, with <var>object</var> as <var>form data set</var> and with <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8">utf-8</a> as the explicit character encoding. </p>
       <p>Set <var>Content-Type</var> to `<code>multipart/form-data;boundary=</code>`,
    followed by the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/forms.html#multipart/form-data-boundary-string"><code>multipart/form-data</code> boundary string</a> generated by the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/forms.html#multipart/form-data-encoding-algorithm"><code>multipart/form-data</code> encoding algorithm</a>. </p>
      <dt><code class="idl"><a data-link-type="idl" href="https://url.spec.whatwg.org/#urlsearchparams">URLSearchParams</a></code> 
      <dd>
       <p>Set <var>action</var> to an action that runs the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-urlencoded-serializer"><code>application/x-www-form-urlencoded</code> serializer</a> with <var>object</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-urlsearchparams-list">list</a>. </p>
       <p>Set <var>Content-Type</var> to
    `<code>application/x-www-form-urlencoded;charset=UTF-8</code>`. </p>
      <dt><code>USVString</code> 
      <dd>
       <p>Set <var>action</var> to an action that runs <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8-encode">utf-8 encode</a> on <var>object</var>. </p>
       <p>Set <var>Content-Type</var> to `<code>text/plain;charset=UTF-8</code>`. </p>
      <dt><code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> 
      <dd>
       <p>Set <var>stream</var> to <var>object</var>. </p>
     </dl>
    <li>
     <p>If <var>keepalive flag</var> is set and <var>object</var>’s type is a <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object, then throw a <code>TypeError</code>. </p>
    <li>
     <p>If <var>action</var> is non-null, run <var>action</var> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in
  parallel</a>: </p>
     <ol>
      <li>
       <p>Whenever one or more bytes are available, let <var>bytes</var> be the bytes and <a data-link-type="dfn" href="#concept-enqueue-readablestream">enqueue</a> a <code>Uint8Array</code> object
   wrapping an <code>ArrayBuffer</code> containing <var>bytes</var> to <var>stream</var>. If
   creating the <code>ArrayBuffer</code> threw an exception, <a data-link-type="abstract-op" href="#concept-error-readablestream">error</a> <var>stream</var> with that exception
   and cancel running <var>action</var>. </p>
      <li>
       <p>When running <var>action</var> is done, <a data-link-type="abstract-op" href="#concept-close-readablestream">close</a> <var>stream</var>. </p>
     </ol>
    <li>
     <p>Let <var>body</var> be a <a data-link-type="dfn" href="#concept-body">body</a> whose <a data-link-type="dfn" href="#concept-body-stream">stream</a> is <var>stream</var>. </p>
    <li>
     <p>Return <var>body</var> and <var>Content-Type</var>. </p>
   </ol>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NoInterfaceObject">NoInterfaceObject</a>, <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<span class="n">Window</span>,<span class="n">Worker</span>)]
<span class="kt">interface</span> <dfn class="nv idl-code" data-dfn-type="interface" data-export="" id="body">Body<a class="self-link" href="#body"></a></dfn> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">boolean</span> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="boolean" href="#dom-body-bodyused">bodyUsed</a>;
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">ArrayBuffer</span>> <a class="nv idl-code" data-link-type="method" href="#dom-body-arraybuffer">arrayBuffer</a>();
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="https://w3c.github.io/FileAPI/#dfn-Blob">Blob</a>> <a class="nv idl-code" data-link-type="method" href="#dom-body-blob">blob</a>();
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="https://xhr.spec.whatwg.org/#formdata">FormData</a>> <a class="nv idl-code" data-link-type="method" href="#dom-body-formdata">formData</a>();
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">any</span>> <a class="nv idl-code" data-link-type="method" href="#dom-body-json">json</a>();
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject">NewObject</a>] <span class="kt">Promise</span>&lt;<span class="kt">USVString</span>> <a class="nv idl-code" data-link-type="method" href="#dom-body-text">text</a>();
};</pre>
   <p class="note" role="note">Formats you would not want a network layer to be dependent upon, such as
HTML, will likely not be exposed here. Rather, an HTML parser API might accept a stream in
due course. </p>
   <p>Objects implementing the <code class="idl"><a data-link-type="idl" href="#body">Body</a></code> mixin gain an associated <dfn data-dfn-for="Body" data-dfn-type="dfn" data-noexport="" id="concept-body-body">body<a class="self-link" href="#concept-body-body"></a></dfn> (null or a <a data-link-type="dfn" href="#concept-body">body</a>) and
a <dfn data-dfn-for="Body" data-dfn-type="dfn" data-noexport="" id="concept-body-mime-type">MIME type<a class="self-link" href="#concept-body-mime-type"></a></dfn> (initially the empty byte sequence). </p>
   <p>An object implementing the <code class="idl"><a data-link-type="idl" href="#body">Body</a></code> mixin is said to be <dfn data-dfn-for="Body" data-dfn-type="dfn" data-noexport="" id="concept-body-disturbed">disturbed<a class="self-link" href="#concept-body-disturbed"></a></dfn> if <a data-link-type="dfn" href="#concept-body-body">body</a> is
non-null and its <a data-link-type="dfn" href="#concept-body-stream">stream</a> is <a data-link-type="dfn" href="#concept-readablestream-disturbed">disturbed</a>. </p>
   <p>An object implementing the <code class="idl"><a data-link-type="idl" href="#body">Body</a></code> mixin is said to be <dfn data-dfn-for="Body" data-dfn-type="dfn" data-noexport="" id="concept-body-locked">locked<a class="self-link" href="#concept-body-locked"></a></dfn> if <a data-link-type="dfn" href="#concept-body-body">body</a> is
non-null and its <a data-link-type="dfn" href="#concept-body-stream">stream</a> is <a data-link-type="dfn" href="#concept-readablestream-locked">locked</a>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Body" data-dfn-type="attribute" data-export="" id="dom-body-bodyused"><code>bodyUsed</code><a class="self-link" href="#dom-body-bodyused"></a></dfn> attribute’s getter must
return true if <a data-link-type="dfn" href="#concept-body-disturbed">disturbed</a>, and false otherwise. </p>
   <p>Objects implementing the <code class="idl"><a data-link-type="idl" href="#body">Body</a></code> mixin also have an associated <dfn data-dfn-for="Body" data-dfn-type="dfn" data-noexport="" id="concept-body-package-data">package data<a class="self-link" href="#concept-body-package-data"></a></dfn> algorithm, given <var>bytes</var>, a <var>type</var> and a <var>MIME type</var>, switches on <var>type</var>, and
runs the associated steps: </p>
   <dl class="switch">
    <dt><i>ArrayBuffer</i> 
    <dd>
     <p>Return an <code>ArrayBuffer</code> whose contents are <var>bytes</var>. Rethrow any
 exceptions. </p>
    <dt><i>Blob</i> 
    <dd>
     <p>Return a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob">Blob</a></code> whose contents are <var>bytes</var> and <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-type">type</a></code> attribute
 is <var>MIME type</var>. </p>
    <dt><i>FormData</i> 
    <dd>
     <p>If <var>MIME type</var> (ignoring parameters) is `<code>multipart/form-data</code>`,
  run these substeps: </p>
     <ol>
      <li>
       <p>Parse <var>bytes</var>, using the value of the `<code>boundary</code>` parameter from <var>MIME type</var> and <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8">utf-8</a> as encoding, per the rules set forth in <cite>Returning Values from Forms: multipart/form-data</cite>. <a data-link-type="biblio" href="#biblio-rfc7578">[RFC7578]</a> </p>
      <li>
       <p>If that fails for some reason, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
      <li>
       <p>Return a new <code class="idl"><a data-link-type="idl" href="https://xhr.spec.whatwg.org/#formdata">FormData</a></code> object, appending each entry,
   resulting from the parsing operation, to <a data-link-type="dfn" href="https://xhr.spec.whatwg.org/#concept-formdata-entry">entries</a>. </p>
     </ol>
     <p class="XXX">The above is a rough approximation of what is needed for
  `<code>multipart/form-data</code>`, a more detailed parsing specification is to be
  written. Volunteers welcome. </p>
     <p>Otherwise, if <var>MIME type</var> (ignoring parameters) is
  `<code>application/x-www-form-urlencoded</code>`, run these substeps: </p>
     <ol>
      <li>
       <p>Let <var>entries</var> be the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-urlencoded-parser">parsing</a> <var>bytes</var>. </p>
      <li>
       <p>If <var>entries</var> is failure, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
      <li>
       <p>Return a new <code class="idl"><a data-link-type="idl" href="https://xhr.spec.whatwg.org/#formdata">FormData</a></code> object whose <a data-link-type="dfn" href="https://xhr.spec.whatwg.org/#concept-formdata-entry">entries</a> are <var>entries</var>. </p>
     </ol>
     <p>Otherwise, <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <dt><i>JSON</i> 
    <dd>
     <p>Return the result of invoking the initial value of the <code>parse</code> property of the <code>JSON</code> object with the result of running <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8-decode">utf-8 decode</a> on <var>bytes</var> as
  argument. Rethrow any exceptions. </p>
    <dt><i>text</i> 
    <dd>
     <p>Return the result of running <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8-decode">utf-8 decode</a> on <var>bytes</var>. </p>
   </dl>
   <p>Objects implementing the <code class="idl"><a data-link-type="idl" href="#body">Body</a></code> mixin also have an associated <dfn data-dfn-for="Body" data-dfn-type="dfn" data-noexport="" id="concept-body-consume-body">consume body<a class="self-link" href="#concept-body-consume-body"></a></dfn> algorithm, given a <var>type</var>,
runs these steps: </p>
   <ol>
    <li>
     <p>If this object is <a data-link-type="dfn" href="#concept-body-disturbed">disturbed</a> or <a data-link-type="dfn" href="#concept-body-locked">locked</a>, return a new promise rejected with a <code>TypeError</code>. </p>
    <li>
     <p>Let <var>stream</var> be <a data-link-type="dfn" href="#concept-body-body">body</a>’s <a data-link-type="dfn" href="#concept-body-stream">stream</a> if <a data-link-type="dfn" href="#concept-body-body">body</a> is
 non-null, or an <a data-link-type="dfn" href="#concept-empty-readablestream">empty</a> <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object otherwise. </p>
    <li>
     <p>Let <var>reader</var> be the result of <a data-link-type="dfn" href="#concept-get-reader">getting
 a reader</a> from <var>stream</var>. If that threw an exception, return a new promise rejected
 with that exception. </p>
    <li>
     <p>Let <var>promise</var> be the result of <a data-link-type="dfn" href="#concept-read-all-bytes-from-readablestream">reading all bytes</a> from <var>stream</var> with <var>reader</var>. </p>
    <li>
     <p>Return the result of transforming <var>promise</var> by a fulfillment handler that
 returns the result of the <a data-link-type="dfn" href="#concept-body-package-data">package data</a> algorithm
 with its first argument, <var>type</var> and this object’s <a data-link-type="dfn" href="#concept-body-mime-type">MIME type</a>. </p>
   </ol>
   <p>The <dfn class="idl-code" data-dfn-for="Body" data-dfn-type="method" data-export="" id="dom-body-arraybuffer"><code>arrayBuffer()</code><a class="self-link" href="#dom-body-arraybuffer"></a></dfn> method, when invoked, must return the result of running <a data-link-type="dfn" href="#concept-body-consume-body">consume body</a> with <i>ArrayBuffer</i>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Body" data-dfn-type="method" data-export="" id="dom-body-blob"><code>blob()</code><a class="self-link" href="#dom-body-blob"></a></dfn> method, when
invoked, must return the result of running <a data-link-type="dfn" href="#concept-body-consume-body">consume body</a> with <i>Blob</i>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Body" data-dfn-type="method" data-export="" id="dom-body-formdata"><code>formData()</code><a class="self-link" href="#dom-body-formdata"></a></dfn> method,
when invoked, must return the result of running <a data-link-type="dfn" href="#concept-body-consume-body">consume body</a> with <i>FormData</i>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Body" data-dfn-type="method" data-export="" id="dom-body-json"><code>json()</code><a class="self-link" href="#dom-body-json"></a></dfn> method, when
invoked, must return the result of running <a data-link-type="dfn" href="#concept-body-consume-body">consume body</a> with <i>JSON</i>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Body" data-dfn-type="method" data-export="" id="dom-body-text"><code>text()</code><a class="self-link" href="#dom-body-text"></a></dfn> method, when
invoked, must return the result of running <a data-link-type="dfn" href="#concept-body-consume-body">consume body</a> with <i>text</i>. </p>
   <h3 class="heading settled" data-level="6.3" id="request-class"><span class="secno">6.3. </span><span class="content">Request class</span><a class="self-link" href="#request-class"></a></h3>
<pre class="idl highlight def"><span class="kt">typedef</span> (<a class="n" data-link-type="idl-name" href="#request">Request</a> <span class="kt">or</span> <span class="kt">USVString</span>) <dfn class="nv idl-code" data-dfn-type="typedef" data-export="" id="requestinfo">RequestInfo<a class="self-link" href="#requestinfo"></a></dfn>;

[<a class="nv idl-code" data-link-type="constructor" href="#dom-request">Constructor</a>(<a class="n" data-link-type="idl-name" href="#requestinfo">RequestInfo</a> <dfn class="nv idl-code" data-dfn-for="Request/Request(input, init)" data-dfn-type="argument" data-export="" id="dom-request-request-input-init-input">input<a class="self-link" href="#dom-request-request-input-init-input"></a></dfn>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#requestinit">RequestInit</a> <dfn class="nv idl-code" data-dfn-for="Request/Request(input, init)" data-dfn-type="argument" data-export="" id="dom-request-request-input-init-init">init<a class="self-link" href="#dom-request-request-input-init-init"></a></dfn>),
 <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<span class="n">Window</span>,<span class="n">Worker</span>)]
<span class="kt">interface</span> <dfn class="nv idl-code" data-dfn-type="interface" data-export="" id="request">Request<a class="self-link" href="#request"></a></dfn> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">ByteString</span> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ByteString" href="#dom-request-method">method</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">USVString</span> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="USVString" href="#dom-request-url">url</a>;
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#headers">Headers</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="Headers" href="#dom-request-headers">headers</a>;

  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#requesttype">RequestType</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="RequestType" href="#dom-request-type">type</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#requestdestination">RequestDestination</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="RequestDestination" href="#dom-request-destination">destination</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">USVString</span> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="USVString" href="#dom-request-referrer">referrer</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://w3c.github.io/webappsec-referrer-policy/#enumdef-referrerpolicy">ReferrerPolicy</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ReferrerPolicy" href="#dom-request-referrerpolicy">referrerPolicy</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#requestmode">RequestMode</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="RequestMode" href="#dom-request-mode">mode</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#requestcredentials">RequestCredentials</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="RequestCredentials" href="#dom-request-credentials">credentials</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#requestcache">RequestCache</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="RequestCache" href="#dom-request-cache">cache</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#requestredirect">RequestRedirect</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="RequestRedirect" href="#dom-request-redirect">redirect</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">DOMString</span> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="DOMString" href="#dom-request-integrity">integrity</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">boolean</span> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="boolean" href="#dom-request-keepalive">keepalive</a>;

  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject">NewObject</a>] <a class="n" data-link-type="idl-name" href="#request">Request</a> <a class="nv idl-code" data-link-type="method" href="#dom-request-clone">clone</a>();
};
<a class="n" data-link-type="idl-name" href="#request">Request</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="#body">Body</a>;
<span class="kt">dictionary</span> <dfn class="nv idl-code" data-dfn-type="dictionary" data-export="" id="requestinit">RequestInit<a class="self-link" href="#requestinit"></a></dfn> {
  <span class="kt">ByteString</span> <dfn class="nv idl-code" data-dfn-for="RequestInit" data-dfn-type="dict-member" data-export="" data-type="ByteString " id="dom-requestinit-method">method<a class="self-link" href="#dom-requestinit-method"></a></dfn>;
  <a class="n" data-link-type="idl-name" href="#headersinit">HeadersInit</a> <dfn class="nv idl-code" data-dfn-for="RequestInit" data-dfn-type="dict-member" data-export="" data-type="HeadersInit " id="dom-requestinit-headers">headers<a class="self-link" href="#dom-requestinit-headers"></a></dfn>;
  <a class="n" data-link-type="idl-name" href="#bodyinit">BodyInit</a>? <dfn class="nv idl-code" data-dfn-for="RequestInit" data-dfn-type="dict-member" data-export="" data-type="BodyInit? " id="dom-requestinit-body">body<a class="self-link" href="#dom-requestinit-body"></a></dfn>;
  <span class="kt">USVString</span> <dfn class="nv idl-code" data-dfn-for="RequestInit" data-dfn-type="dict-member" data-export="" data-type="USVString " id="dom-requestinit-referrer">referrer<a class="self-link" href="#dom-requestinit-referrer"></a></dfn>;
  <a class="n" data-link-type="idl-name" href="https://w3c.github.io/webappsec-referrer-policy/#enumdef-referrerpolicy">ReferrerPolicy</a> <dfn class="nv idl-code" data-dfn-for="RequestInit" data-dfn-type="dict-member" data-export="" data-type="ReferrerPolicy " id="dom-requestinit-referrerpolicy">referrerPolicy<a class="self-link" href="#dom-requestinit-referrerpolicy"></a></dfn>;
  <a class="n" data-link-type="idl-name" href="#requestmode">RequestMode</a> <dfn class="nv idl-code" data-dfn-for="RequestInit" data-dfn-type="dict-member" data-export="" data-type="RequestMode " id="dom-requestinit-mode">mode<a class="self-link" href="#dom-requestinit-mode"></a></dfn>;
  <a class="n" data-link-type="idl-name" href="#requestcredentials">RequestCredentials</a> <dfn class="nv idl-code" data-dfn-for="RequestInit" data-dfn-type="dict-member" data-export="" data-type="RequestCredentials " id="dom-requestinit-credentials">credentials<a class="self-link" href="#dom-requestinit-credentials"></a></dfn>;
  <a class="n" data-link-type="idl-name" href="#requestcache">RequestCache</a> <dfn class="nv idl-code" data-dfn-for="RequestInit" data-dfn-type="dict-member" data-export="" data-type="RequestCache " id="dom-requestinit-cache">cache<a class="self-link" href="#dom-requestinit-cache"></a></dfn>;
  <a class="n" data-link-type="idl-name" href="#requestredirect">RequestRedirect</a> <dfn class="nv idl-code" data-dfn-for="RequestInit" data-dfn-type="dict-member" data-export="" data-type="RequestRedirect " id="dom-requestinit-redirect">redirect<a class="self-link" href="#dom-requestinit-redirect"></a></dfn>;
  <span class="kt">DOMString</span> <dfn class="nv idl-code" data-dfn-for="RequestInit" data-dfn-type="dict-member" data-export="" data-type="DOMString " id="dom-requestinit-integrity">integrity<a class="self-link" href="#dom-requestinit-integrity"></a></dfn>;
  <span class="kt">boolean</span> <dfn class="nv idl-code" data-dfn-for="RequestInit" data-dfn-type="dict-member" data-export="" data-type="boolean " id="dom-requestinit-keepalive">keepalive<a class="self-link" href="#dom-requestinit-keepalive"></a></dfn>;
  <span class="kt">any</span> <dfn class="nv idl-code" data-dfn-for="RequestInit" data-dfn-type="dict-member" data-export="" data-type="any " id="dom-requestinit-window">window<a class="self-link" href="#dom-requestinit-window"></a></dfn>; // can only be set to null
};

<span class="kt">enum</span> <dfn class="nv idl-code" data-dfn-type="enum" data-export="" id="requesttype">RequestType<a class="self-link" href="#requesttype"></a></dfn> { <dfn class="s idl-code" data-dfn-for="RequestType" data-dfn-type="enum-value" data-export="" data-lt="&quot;&quot;|" id="dom-requesttype">""<a class="self-link" href="#dom-requesttype"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestType" data-dfn-type="enum-value" data-export="" data-lt="&quot;audio&quot;|audio" id="dom-requesttype-audio">"audio"<a class="self-link" href="#dom-requesttype-audio"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestType" data-dfn-type="enum-value" data-export="" data-lt="&quot;font&quot;|font" id="dom-requesttype-font">"font"<a class="self-link" href="#dom-requesttype-font"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestType" data-dfn-type="enum-value" data-export="" data-lt="&quot;image&quot;|image" id="dom-requesttype-image">"image"<a class="self-link" href="#dom-requesttype-image"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestType" data-dfn-type="enum-value" data-export="" data-lt="&quot;script&quot;|script" id="dom-requesttype-script">"script"<a class="self-link" href="#dom-requesttype-script"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestType" data-dfn-type="enum-value" data-export="" data-lt="&quot;style&quot;|style" id="dom-requesttype-style">"style"<a class="self-link" href="#dom-requesttype-style"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestType" data-dfn-type="enum-value" data-export="" data-lt="&quot;track&quot;|track" id="dom-requesttype-track">"track"<a class="self-link" href="#dom-requesttype-track"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestType" data-dfn-type="enum-value" data-export="" data-lt="&quot;video&quot;|video" id="dom-requesttype-video">"video"<a class="self-link" href="#dom-requesttype-video"></a></dfn> };
<span class="kt">enum</span> <dfn class="nv idl-code" data-dfn-type="enum" data-export="" id="requestdestination">RequestDestination<a class="self-link" href="#requestdestination"></a></dfn> { <dfn class="s idl-code" data-dfn-for="RequestDestination" data-dfn-type="enum-value" data-export="" data-lt="&quot;&quot;|" id="dom-requestdestination">""<a class="self-link" href="#dom-requestdestination"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestDestination" data-dfn-type="enum-value" data-export="" data-lt="&quot;document&quot;|document" id="dom-requestdestination-document">"document"<a class="self-link" href="#dom-requestdestination-document"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestDestination" data-dfn-type="enum-value" data-export="" data-lt="&quot;embed&quot;|embed" id="dom-requestdestination-embed">"embed"<a class="self-link" href="#dom-requestdestination-embed"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestDestination" data-dfn-type="enum-value" data-export="" data-lt="&quot;font&quot;|font" id="dom-requestdestination-font">"font"<a class="self-link" href="#dom-requestdestination-font"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestDestination" data-dfn-type="enum-value" data-export="" data-lt="&quot;image&quot;|image" id="dom-requestdestination-image">"image"<a class="self-link" href="#dom-requestdestination-image"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestDestination" data-dfn-type="enum-value" data-export="" data-lt="&quot;manifest&quot;|manifest" id="dom-requestdestination-manifest">"manifest"<a class="self-link" href="#dom-requestdestination-manifest"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestDestination" data-dfn-type="enum-value" data-export="" data-lt="&quot;media&quot;|media" id="dom-requestdestination-media">"media"<a class="self-link" href="#dom-requestdestination-media"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestDestination" data-dfn-type="enum-value" data-export="" data-lt="&quot;object&quot;|object" id="dom-requestdestination-object">"object"<a class="self-link" href="#dom-requestdestination-object"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestDestination" data-dfn-type="enum-value" data-export="" data-lt="&quot;report&quot;|report" id="dom-requestdestination-report">"report"<a class="self-link" href="#dom-requestdestination-report"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestDestination" data-dfn-type="enum-value" data-export="" data-lt="&quot;script&quot;|script" id="dom-requestdestination-script">"script"<a class="self-link" href="#dom-requestdestination-script"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestDestination" data-dfn-type="enum-value" data-export="" data-lt="&quot;serviceworker&quot;|serviceworker" id="dom-requestdestination-serviceworker">"serviceworker"<a class="self-link" href="#dom-requestdestination-serviceworker"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestDestination" data-dfn-type="enum-value" data-export="" data-lt="&quot;sharedworker&quot;|sharedworker" id="dom-requestdestination-sharedworker">"sharedworker"<a class="self-link" href="#dom-requestdestination-sharedworker"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestDestination" data-dfn-type="enum-value" data-export="" data-lt="&quot;style&quot;|style" id="dom-requestdestination-style">"style"<a class="self-link" href="#dom-requestdestination-style"></a></dfn>,  <dfn class="s idl-code" data-dfn-for="RequestDestination" data-dfn-type="enum-value" data-export="" data-lt="&quot;worker&quot;|worker" id="dom-requestdestination-worker">"worker"<a class="self-link" href="#dom-requestdestination-worker"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestDestination" data-dfn-type="enum-value" data-export="" data-lt="&quot;xslt&quot;|xslt" id="dom-requestdestination-xslt">"xslt"<a class="self-link" href="#dom-requestdestination-xslt"></a></dfn> };
<span class="kt">enum</span> <dfn class="nv idl-code" data-dfn-type="enum" data-export="" id="requestmode">RequestMode<a class="self-link" href="#requestmode"></a></dfn> { <dfn class="s idl-code" data-dfn-for="RequestMode" data-dfn-type="enum-value" data-export="" data-lt="&quot;navigate&quot;|navigate" id="dom-requestmode-navigate">"navigate"<a class="self-link" href="#dom-requestmode-navigate"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestMode" data-dfn-type="enum-value" data-export="" data-lt="&quot;same-origin&quot;|same-origin" id="dom-requestmode-same-origin">"same-origin"<a class="self-link" href="#dom-requestmode-same-origin"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestMode" data-dfn-type="enum-value" data-export="" data-lt="&quot;no-cors&quot;|no-cors" id="dom-requestmode-no-cors">"no-cors"<a class="self-link" href="#dom-requestmode-no-cors"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestMode" data-dfn-type="enum-value" data-export="" data-lt="&quot;cors&quot;|cors" id="dom-requestmode-cors">"cors"<a class="self-link" href="#dom-requestmode-cors"></a></dfn> };
<span class="kt">enum</span> <dfn class="nv idl-code" data-dfn-type="enum" data-export="" id="requestcredentials">RequestCredentials<a class="self-link" href="#requestcredentials"></a></dfn> { <dfn class="s idl-code" data-dfn-for="RequestCredentials" data-dfn-type="enum-value" data-export="" data-lt="&quot;omit&quot;|omit" id="dom-requestcredentials-omit">"omit"<a class="self-link" href="#dom-requestcredentials-omit"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestCredentials" data-dfn-type="enum-value" data-export="" data-lt="&quot;same-origin&quot;|same-origin" id="dom-requestcredentials-same-origin">"same-origin"<a class="self-link" href="#dom-requestcredentials-same-origin"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestCredentials" data-dfn-type="enum-value" data-export="" data-lt="&quot;include&quot;|include" id="dom-requestcredentials-include">"include"<a class="self-link" href="#dom-requestcredentials-include"></a></dfn> };
<span class="kt">enum</span> <dfn class="nv idl-code" data-dfn-type="enum" data-export="" id="requestcache">RequestCache<a class="self-link" href="#requestcache"></a></dfn> { <dfn class="s idl-code" data-dfn-for="RequestCache" data-dfn-type="enum-value" data-export="" data-lt="&quot;default&quot;|default" id="dom-requestcache-default">"default"<a class="self-link" href="#dom-requestcache-default"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestCache" data-dfn-type="enum-value" data-export="" data-lt="&quot;no-store&quot;|no-store" id="dom-requestcache-no-store">"no-store"<a class="self-link" href="#dom-requestcache-no-store"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestCache" data-dfn-type="enum-value" data-export="" data-lt="&quot;reload&quot;|reload" id="dom-requestcache-reload">"reload"<a class="self-link" href="#dom-requestcache-reload"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestCache" data-dfn-type="enum-value" data-export="" data-lt="&quot;no-cache&quot;|no-cache" id="dom-requestcache-no-cache">"no-cache"<a class="self-link" href="#dom-requestcache-no-cache"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestCache" data-dfn-type="enum-value" data-export="" data-lt="&quot;force-cache&quot;|force-cache" id="dom-requestcache-force-cache">"force-cache"<a class="self-link" href="#dom-requestcache-force-cache"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestCache" data-dfn-type="enum-value" data-export="" data-lt="&quot;only-if-cached&quot;|only-if-cached" id="dom-requestcache-only-if-cached">"only-if-cached"<a class="self-link" href="#dom-requestcache-only-if-cached"></a></dfn> };
<span class="kt">enum</span> <dfn class="nv idl-code" data-dfn-type="enum" data-export="" id="requestredirect">RequestRedirect<a class="self-link" href="#requestredirect"></a></dfn> { <dfn class="s idl-code" data-dfn-for="RequestRedirect" data-dfn-type="enum-value" data-export="" data-lt="&quot;follow&quot;|follow" id="dom-requestredirect-follow">"follow"<a class="self-link" href="#dom-requestredirect-follow"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestRedirect" data-dfn-type="enum-value" data-export="" data-lt="&quot;error&quot;|error" id="dom-requestredirect-error">"error"<a class="self-link" href="#dom-requestredirect-error"></a></dfn>, <dfn class="s idl-code" data-dfn-for="RequestRedirect" data-dfn-type="enum-value" data-export="" data-lt="&quot;manual&quot;|manual" id="dom-requestredirect-manual">"manual"<a class="self-link" href="#dom-requestredirect-manual"></a></dfn> };</pre>
   <p class="note no-backref" role="note">"<code>serviceworker</code>" is omitted from <a class="idl-code" data-link-type="enum" href="#requestdestination"><code>RequestDestination</code></a> as it cannot be observed from JavaScript. Implementations
will still need to support it as a <a data-link-type="dfn" href="#concept-request-destination">destination</a>. "<code>websocket</code>" is
omitted from <a class="idl-code" data-link-type="enum" href="#requestmode"><code>RequestMode</code></a> as it cannot be used nor observed from JavaScript. </p>
   <p>A <code class="idl"><a data-link-type="idl" href="#request">Request</a></code> object has an associated <dfn data-dfn-for="Request" data-dfn-type="dfn" data-noexport="" id="concept-request-request">request<a class="self-link" href="#concept-request-request"></a></dfn> (a <a data-link-type="dfn" href="#concept-request">request</a>). </p>
   <p>A <code class="idl"><a data-link-type="idl" href="#request">Request</a></code> object also has an associated <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object which
is itself associated with <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
   <p>A <code class="idl"><a data-link-type="idl" href="#request">Request</a></code> object’s <a data-link-type="dfn" href="#concept-body-body">body</a> is its <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-body">body</a>. </p>
   <hr>
   <p>The <dfn class="idl-code" data-dfn-for="Request" data-dfn-type="constructor" data-export="" id="dom-request"><code>Request(<var>input</var>, <var>init</var>)</code><a class="self-link" href="#dom-request"></a></dfn> constructor must run these steps: </p>
   <ol>
    <li>
     <p>Let <var>request</var> be null. </p>
    <li>
     <p>Let <var>fallbackMode</var> be null. </p>
    <li>
     <p>Let <var>fallbackCredentials</var> be null. </p>
    <li>
     <p>Let <var>baseURL</var> be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object">current settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url">API base URL</a>. </p>
    <li>
     <p>If <var>input</var> is a string, then run these substeps: </p>
     <ol>
      <li>
       <p>Let <var>parsedURL</var> be the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser">parsing</a> <var>input</var> with <var>baseURL</var>. </p>
      <li>
       <p>If <var>parsedURL</var> is failure, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
      <li>
       <p>If <var>parsedURL</var> <a data-link-type="dfn" href="https://url.spec.whatwg.org/#include-credentials">includes credentials</a>, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
      <li>
       <p>Set <var>request</var> to a new <a data-link-type="dfn" href="#concept-request">request</a> whose <a data-link-type="dfn" href="#concept-request-url">url</a> is <var>parsedURL</var>. </p>
      <li>
       <p>Set <var>fallbackMode</var> to "<code>cors</code>". </p>
      <li>
       <p>Set <var>fallbackCredentials</var> to "<code>omit</code>". </p>
     </ol>
    <li>
     <p>Otherwise (<var>input</var> is a <code class="idl"><a data-link-type="idl" href="#request">Request</a></code> object), run these substeps: </p>
     <ol>
      <li>
       <p>If <var>input</var> is <a data-link-type="dfn" href="#concept-body-disturbed">disturbed</a> or <a data-link-type="dfn" href="#concept-body-locked">locked</a>, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
      <li>
       <p>Set <var>request</var> to <var>input</var>’s <a data-link-type="dfn" href="#concept-request-request">request</a>. </p>
     </ol>
    <li>
     <p>Let <var>origin</var> be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object">current settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin">origin</a>. </p>
    <li>
     <p>Let <var>window</var> be "<code>client</code>". </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-window">window</a> is
 an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a> and its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin">origin</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin">same origin</a> with <var>origin</var>, set <var>window</var> to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-window">window</a>. </p>
    <li>
     <p>If <var>init</var>’s <code>window</code> member is present and it is non-null, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <li>
     <p>If <var>init</var>’s <code>window</code> member is present, set <var>window</var> to "<code>no-window</code>". </p>
    <li>
     <p>Set <var>request</var> to a new <a data-link-type="dfn" href="#concept-request">request</a> whose <a data-link-type="dfn" href="#concept-request-url">url</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-current-url">current url</a>, <a data-link-type="dfn" href="#concept-request-method">method</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-method">method</a>, <a data-link-type="dfn" href="#concept-request-header-list">header list</a> is a copy of <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>, <a data-link-type="dfn" href="#unsafe-request-flag">unsafe-request flag</a> is set, <a data-link-type="dfn" href="#concept-request-client">client</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object">current settings object</a>, <a data-link-type="dfn" href="#concept-request-window">window</a> is <var>window</var>, <a data-link-type="dfn" href="#concept-request-origin">origin</a> is "<code>client</code>", <a data-link-type="dfn" href="#omit-origin-header-flag">omit-<code>Origin</code>-header flag</a> is <var>request</var>’s <a data-link-type="dfn" href="#omit-origin-header-flag">omit-<code>Origin</code>-header flag</a>, <a data-link-type="dfn" href="#concept-request-referrer">referrer</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer">referrer</a>, <a data-link-type="dfn" href="#concept-request-referrer-policy">referrer policy</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer-policy">referrer policy</a>, <a data-link-type="dfn" href="#concept-request-mode">mode</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-mode">mode</a>, <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a>, <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a>, <a data-link-type="dfn" href="#concept-request-redirect-mode">redirect mode</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-redirect-mode">redirect mode</a>, <a data-link-type="dfn" href="#concept-request-integrity-metadata">integrity metadata</a> is <var>request</var>’s <a data-link-type="dfn" href="#concept-request-integrity-metadata">integrity metadata</a>, and <a data-link-type="dfn" href="#keepalive-flag">keepalive flag</a> is <var>request</var>’s <a data-link-type="dfn" href="#keepalive-flag">keepalive flag</a>. </p>
    <li>
     <p>If any of <var>init</var>’s members are present, run these substeps: </p>
     <ol>
      <li>
       <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-mode">mode</a> is
   "<code>navigate</code>", then set it to "<code>same-origin</code>". </p>
      <li>
       <p>Unset <var>request</var>’s <a data-link-type="dfn" href="#omit-origin-header-flag">omit-<code>Origin</code>-header flag</a>. </p>
      <li>
       <p>Set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer">referrer</a> to
   "<code>client</code>" </p>
      <li>
       <p>Set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer-policy">referrer policy</a> to the empty string. </p>
     </ol>
     <p class="note" role="note">This is done to ensure that when a service worker "redirects" a request, .e.g.,
  from an image in a cross-origin stylesheet, and makes modifications, it no longer appears to come
  from the original source (i.e., the cross-origin stylesheet), but instead from the service worker
  that "redirected" the request. This is important as the original source might not even be able to
  generate the same kind of requests as the service worker. Services that trust the original source
  could therefore be exploited were this not done, although that is somewhat farfetched. </p>
    <li>
     <p>If <var>init</var>’s <code>referrer</code> member is present, run these
  substeps: </p>
     <ol>
      <li>
       <p>Let <var>referrer</var> be <var>init</var>’s <code>referrer</code> member. </p>
      <li>
       <p>If <var>referrer</var> is the empty string, set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer">referrer</a> to "<code>no-referrer</code>" and
   terminate these substeps. </p>
      <li>
       <p>Let <var>parsedReferrer</var> be the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser">parsing</a> <var>referrer</var> with <var>baseURL</var>. </p>
      <li>
       <p>If <var>parsedReferrer</var> is failure, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
      <li>
       <p>If one of the following conditions is true, then set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer">referrer</a> to "<code>client</code>": </p>
       <ul class="brief">
        <li><var>parsedReferrer</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#url-cannot-be-a-base-url-flag">cannot-be-a-base-URL flag</a> is set, <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> is "<code>about</code>", and <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path">path</a> contains a single string
     "<code>client</code>". 
        <li><var>parsedReferrer</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin">same origin</a> with <var>origin</var> 
       </ul>
      <li>
       <p>Otherwise, set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer">referrer</a> to <var>parsedReferrer</var>. </p>
     </ol>
    <li>
     <p>If <var>init</var>’s <code>referrerPolicy</code> member is present, set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-referrer-policy">referrer policy</a> to it. </p>
    <li>
     <p>Let <var>mode</var> be <var>init</var>’s <code>mode</code> member if it is present, and <var>fallbackMode</var> otherwise. </p>
    <li>
     <p>If <var>mode</var> is "<code>navigate</code>", then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <li>
     <p>If <var>mode</var> is non-null, set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-mode">mode</a> to <var>mode</var>. </p>
    <li>
     <p>Let <var>credentials</var> be <var>init</var>’s <code>credentials</code> member if it is present, and <var>fallbackCredentials</var> otherwise. </p>
    <li>
     <p>If <var>credentials</var> is non-null, set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> to <var>credentials</var>. </p>
    <li>
     <p>If <var>init</var>’s <code>cache</code> member is present, set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> to
 it. </p>
    <li>
     <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> is "<code>only-if-cached</code>" and <var>request</var>’s <a data-link-type="dfn" href="#concept-request-mode">mode</a> is <em>not</em> "<code>same-origin</code>", then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <li>
     <p>If <var>init</var>’s <code>redirect</code> member is present, set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-redirect-mode">redirect mode</a> to it. </p>
    <li>
     <p>If <var>init</var>’s <code>integrity</code> member is present, set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-integrity-metadata">integrity metadata</a> to it. </p>
    <li>
     <p>If <var>init</var>’s <code>keepalive</code> member is present, then set <var>request</var>’s <a data-link-type="dfn" href="#keepalive-flag">keepalive flag</a> if <var>init</var>’s <code>keepalive</code> member is true, and unset
 it otherwise. </p>
    <li>
     <p>If <var>init</var>’s <code>method</code> member is present, let <var>method</var> be it and run these substeps: </p>
     <ol>
      <li>
       <p>If <var>method</var> is not a <a data-link-type="dfn" href="#concept-method">method</a> or <var>method</var> is a <a data-link-type="dfn" href="#forbidden-method">forbidden method</a>, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
      <li>
       <p><a data-link-type="dfn" href="#concept-method-normalize">Normalize</a> <var>method</var>. </p>
      <li>
       <p>Set <var>request</var>’s <a data-link-type="dfn" href="#concept-request-method">method</a> to <var>method</var>. </p>
     </ol>
    <li>
     <p>Let <var>r</var> be a new <code class="idl"><a data-link-type="idl" href="#request">Request</a></code> object associated with <var>request</var> and
 a new associated <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object whose <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is "<code>request</code>". </p>
    <li>
     <p>Let <var>headers</var> be a copy of <var>r</var>’s <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object and its
 associated <a data-link-type="dfn" href="#concept-headers-header-list">header list</a>. </p>
    <li>
     <p>If <var>init</var>’s <code>headers</code> member is present, set <var>headers</var> to <var>init</var>’s <code>headers</code> member. </p>
    <li>
     <p>Empty <var>r</var>’s <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object’s <a data-link-type="dfn" href="#concept-headers-header-list">header list</a>. </p>
    <li>
     <p>If <var>r</var>’s <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-mode">mode</a> is "<code>no-cors</code>", run these
  substeps: </p>
     <ol>
      <li>
       <p>If <var>r</var>’s <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-method">method</a> is not a <a data-link-type="dfn" href="#cors-safelisted-method">CORS-safelisted method</a>, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
      <li>
       <p>If <var>request</var>’s <a data-link-type="dfn" href="#concept-request-integrity-metadata">integrity metadata</a> is not the empty string,
   then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
      <li>
       <p>Set <var>r</var>’s <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object’s <a data-link-type="dfn" href="#concept-headers-guard">guard</a> to "<code>request-no-cors</code>". </p>
     </ol>
    <li>
     <p><a data-link-type="dfn" href="#concept-headers-fill">Fill</a> <var>r</var>’s <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object with <var>headers</var>. Rethrow any exceptions. </p>
    <li>
     <p>Let <var>inputBody</var> be <var>input</var>’s <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-body">body</a> if <var>input</var> is a <code class="idl"><a data-link-type="idl" href="#request">Request</a></code> object, and null otherwise. </p>
    <li>
     <p>If either <var>init</var>’s <code>body</code> member is present and is non-null or <var>inputBody</var> is non-null, and <var>request</var>’s <a data-link-type="dfn" href="#concept-request-method">method</a> is
 `<code>GET</code>` or `<code>HEAD</code>`, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <li>
     <p>If <var>init</var>’s <code>body</code> member is present and is non-null, run these
  substeps: </p>
     <ol>
      <li>
       <p>Let <var>Content-Type</var> be null. </p>
      <li>
       <p>If <var>init</var>’s <code>keepalive</code> member is present and is true, then set <var>inputBody</var> and <var>Content-Type</var> to the result of <a data-link-type="dfn" href="#concept-bodyinit-extract">extracting</a> <var>init</var>’s <code>body</code> member, with <var>keepalive flag</var> set. Rethrow any exceptions. </p>
      <li>
       <p>Otherwise, set <var>inputBody</var> and <var>Content-Type</var> to the result of <a data-link-type="dfn" href="#concept-bodyinit-extract">extracting</a> <var>init</var>’s <code>body</code> member. Rethrow any exceptions. </p>
      <li>
       <p>If <var>Content-Type</var> is non-null and <var>r</var>’s <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object’s <a data-link-type="dfn" href="#concept-headers-header-list">header list</a> contains no <a data-link-type="dfn" href="#concept-header">header</a> <a data-link-type="dfn" href="#concept-header-name">named</a> `<code>Content-Type</code>`, then <a data-link-type="dfn" href="#concept-headers-append">append</a> `<code>Content-Type</code>`/<var>Content-Type</var> to <var>r</var>’s <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object. Rethrow any exception. </p>
     </ol>
    <li>
     <p>Set <var>r</var>’s <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-body">body</a> to <var>inputBody</var>. </p>
    <li>
     <p>Set <var>r</var>’s <a data-link-type="dfn" href="#concept-body-mime-type">MIME type</a> to
 the result of <a data-link-type="dfn" href="#concept-header-extract-mime-type">extracting a MIME type</a> from <var>r</var>’s <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
    <li>
     <p>If <var>input</var> is a <code class="idl"><a data-link-type="idl" href="#request">Request</a></code> object and <var>input</var>’s <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-body">body</a> is non-null, run these substeps: </p>
     <ol>
      <li>
       <p>Let <var>dummyStream</var> be an <a data-link-type="dfn" href="#concept-empty-readablestream">empty</a> <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object. </p>
      <li>
       <p>Set <var>input</var>’s <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-body">body</a> to a new <a data-link-type="dfn" href="#concept-body">body</a> whose <a data-link-type="dfn" href="#concept-body-stream">stream</a> is <var>dummyStream</var>. </p>
      <li>
       <p>Let <var>reader</var> be the result of <a data-link-type="dfn" href="#concept-get-reader">getting a reader</a> from <var>dummyStream</var>. </p>
       <p class="note no-backref" role="note">This operation will not throw an exception. </p>
      <li>
       <p><a data-link-type="dfn" href="#concept-read-all-bytes-from-readablestream">Read all bytes</a> from <var>dummyStream</var> with <var>reader</var>. </p>
       <p class="note no-backref" role="note">This operation makes <var>dummyStream</var> disturbed. </p>
     </ol>
     <p class="note no-backref" role="note">These substeps are meant to produce the observable equivalent of
  "piping" <var>input</var>’s <a data-link-type="dfn" href="#concept-body-body">body</a>’s <a data-link-type="dfn" href="#concept-body-stream">stream</a> into <var>r</var>. That is, <var>input</var> is
  left with a <a data-link-type="dfn" href="#concept-body">body</a> with a <code class="idl"><a data-link-type="idl" href="#concept-readablestream">ReadableStream</a></code> object that is <a data-link-type="dfn" href="#concept-readablestream-disturbed">disturbed</a> and <a data-link-type="dfn" href="#concept-readablestream-locked">locked</a>, while the data readable from <var>r</var>’s <a data-link-type="dfn" href="#concept-body-body">body</a>’s <a data-link-type="dfn" href="#concept-body-stream">stream</a> is now equal to what used to be <var>input</var>’s,
  if <var>input</var>’s original <a data-link-type="dfn" href="#concept-body-body">body</a> is non-null. </p>
    <li>
     <p>Return <var>r</var>. </p>
   </ol>
   <p>The <dfn class="idl-code" data-dfn-for="Request" data-dfn-type="attribute" data-export="" id="dom-request-method"><code>method</code><a class="self-link" href="#dom-request-method"></a></dfn> attribute’s getter must
return <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-method">method</a>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Request" data-dfn-type="attribute" data-export="" id="dom-request-url"><code>url</code><a class="self-link" href="#dom-request-url"></a></dfn> attribute’s getter must
return <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-url">url</a>, <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer">serialized</a>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Request" data-dfn-type="attribute" data-export="" id="dom-request-headers"><code>headers</code><a class="self-link" href="#dom-request-headers"></a></dfn> attribute’s getter must
return the associated <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Request" data-dfn-type="attribute" data-export="" id="dom-request-type"><code>type</code><a class="self-link" href="#dom-request-type"></a></dfn> attribute’s getter must return <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-type">type</a>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Request" data-dfn-type="attribute" data-export="" id="dom-request-destination"><code>destination</code><a class="self-link" href="#dom-request-destination"></a></dfn> attribute’s
getter must return <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-destination">destination</a>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Request" data-dfn-type="attribute" data-export="" id="dom-request-referrer"><code>referrer</code><a class="self-link" href="#dom-request-referrer"></a></dfn> attribute’s getter must
return the empty string if <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-referrer">referrer</a> is "<code>no-referrer</code>",
"<code>about:client</code>" if <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-referrer">referrer</a> is "<code>client</code>", and <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-referrer">referrer</a>, <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer">serialized</a>, otherwise. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Request" data-dfn-type="attribute" data-export="" id="dom-request-referrerpolicy"><code>referrerPolicy</code><a class="self-link" href="#dom-request-referrerpolicy"></a></dfn> attribute’s
getter must return <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-referrer-policy">referrer policy</a>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Request" data-dfn-type="attribute" data-export="" id="dom-request-mode"><code>mode</code><a class="self-link" href="#dom-request-mode"></a></dfn> attribute’s getter must return <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-mode">mode</a>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Request" data-dfn-type="attribute" data-export="" id="dom-request-credentials"><code>credentials</code><a class="self-link" href="#dom-request-credentials"></a></dfn> attribute’s
getter must return <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Request" data-dfn-type="attribute" data-export="" id="dom-request-cache"><code>cache</code><a class="self-link" href="#dom-request-cache"></a></dfn> attribute’s getter must
return <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Request" data-dfn-type="attribute" data-export="" id="dom-request-redirect"><code>redirect</code><a class="self-link" href="#dom-request-redirect"></a></dfn> attribute’s getter must
return <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-redirect-mode">redirect mode</a>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Request" data-dfn-type="attribute" data-export="" id="dom-request-integrity"><code>integrity</code><a class="self-link" href="#dom-request-integrity"></a></dfn> attribute’s getter
must return <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#concept-request-integrity-metadata">integrity metadata</a>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Request" data-dfn-type="attribute" data-export="" id="dom-request-keepalive"><code>keepalive</code><a class="self-link" href="#dom-request-keepalive"></a></dfn> attribute’s getter
must return true if <a data-link-type="dfn" href="#concept-request-request">request</a>’s <a data-link-type="dfn" href="#keepalive-flag">keepalive flag</a> is set, and false otherwise. </p>
   <hr>
   <p>The <dfn class="idl-code" data-dfn-for="Request" data-dfn-type="method" data-export="" id="dom-request-clone"><code>clone()</code><a class="self-link" href="#dom-request-clone"></a></dfn> method, when invoked, must
run these steps: </p>
   <ol>
    <li>
     <p>If this <code class="idl"><a data-link-type="idl" href="#request">Request</a></code> object is <a data-link-type="dfn" href="#concept-body-disturbed">disturbed</a> or <a data-link-type="dfn" href="#concept-body-locked">locked</a>, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <li>
     <p>Return a new <code class="idl"><a data-link-type="idl" href="#request">Request</a></code> object associated with the result of <a data-link-type="dfn" href="#concept-request-clone">cloning</a> <a data-link-type="dfn" href="#concept-request-request">request</a> and a new associated <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object whose <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object">context object</a>’s <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object’s <a data-link-type="dfn" href="#concept-headers-guard">guard</a>. </p>
   </ol>
   <h3 class="heading settled" data-level="6.4" id="response-class"><span class="secno">6.4. </span><span class="content">Response class</span><a class="self-link" href="#response-class"></a></h3>
<pre class="idl highlight def">[<a class="nv idl-code" data-link-type="constructor" href="#dom-response">Constructor</a>(<span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#responsebodyinit">ResponseBodyInit</a>? <dfn class="nv idl-code" data-dfn-for="Response/Response(body, init)" data-dfn-type="argument" data-export="" id="dom-response-response-body-init-body">body<a class="self-link" href="#dom-response-response-body-init-body"></a></dfn> = <span class="kt">null</span>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#responseinit">ResponseInit</a> <dfn class="nv idl-code" data-dfn-for="Response/Response(body, init)" data-dfn-type="argument" data-export="" id="dom-response-response-body-init-init">init<a class="self-link" href="#dom-response-response-body-init-init"></a></dfn>), <a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<span class="n">Window</span>,<span class="n">Worker</span>)]
<span class="kt">interface</span> <dfn class="nv idl-code" data-dfn-type="interface" data-export="" id="response">Response<a class="self-link" href="#response"></a></dfn> {
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject">NewObject</a>] <span class="kt">static</span> <a class="n" data-link-type="idl-name" href="#response">Response</a> <a class="nv idl-code" data-link-type="method" href="#dom-response-error">error</a>();
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject">NewObject</a>] <span class="kt">static</span> <a class="n" data-link-type="idl-name" href="#response">Response</a> <a class="nv idl-code" data-link-type="method" href="#dom-response-redirect">redirect</a>(<span class="kt">USVString</span> <dfn class="nv idl-code" data-dfn-for="Response/redirect(url, status), Response/redirect(url)" data-dfn-type="argument" data-export="" id="dom-response-redirect-url-status-url">url<a class="self-link" href="#dom-response-redirect-url-status-url"></a></dfn>, <span class="kt">optional</span> <span class="kt">unsigned</span> <span class="kt">short</span> <dfn class="nv idl-code" data-dfn-for="Response/redirect(url, status), Response/redirect(url)" data-dfn-type="argument" data-export="" id="dom-response-redirect-url-status-status">status<a class="self-link" href="#dom-response-redirect-url-status-status"></a></dfn> = 302);

  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#responsetype">ResponseType</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ResponseType" href="#dom-response-type">type</a>;

  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">USVString</span> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="USVString" href="#dom-response-url">url</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">boolean</span> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="boolean" href="#dom-response-redirected">redirected</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">unsigned</span> <span class="kt">short</span> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="unsigned short" href="#dom-response-status">status</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">boolean</span> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="boolean" href="#dom-response-ok">ok</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">ByteString</span> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ByteString" href="#dom-response-statustext">statusText</a>;
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#headers">Headers</a> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="Headers" href="#dom-response-headers">headers</a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#concept-readablestream">ReadableStream</a>? <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="ReadableStream?" href="#dom-response-body">body</a>;
  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#SameObject">SameObject</a>] <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="#headers">Headers</a>> <a class="nv idl-code" data-link-type="attribute" data-readonly="" data-type="Promise<Headers>" href="#dom-response-trailer">trailer</a>;

  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject">NewObject</a>] <a class="n" data-link-type="idl-name" href="#response">Response</a> <a class="nv idl-code" data-link-type="method" href="#dom-response-clone">clone</a>();
};
<a class="n" data-link-type="idl-name" href="#response">Response</a> <span class="kt">implements</span> <a class="n" data-link-type="idl-name" href="#body">Body</a>;

<span class="kt">dictionary</span> <dfn class="nv idl-code" data-dfn-type="dictionary" data-export="" id="responseinit">ResponseInit<a class="self-link" href="#responseinit"></a></dfn> {
  <span class="kt">unsigned</span> <span class="kt">short</span> <dfn class="nv idl-code" data-default="200" data-dfn-for="ResponseInit" data-dfn-type="dict-member" data-export="" data-type="unsigned short " id="dom-responseinit-status">status<a class="self-link" href="#dom-responseinit-status"></a></dfn> = 200;
  <span class="kt">ByteString</span> <dfn class="nv idl-code" data-default="&quot;OK&quot;" data-dfn-for="ResponseInit" data-dfn-type="dict-member" data-export="" data-type="ByteString " id="dom-responseinit-statustext">statusText<a class="self-link" href="#dom-responseinit-statustext"></a></dfn> = "OK";
  <a class="n" data-link-type="idl-name" href="#headersinit">HeadersInit</a> <dfn class="nv idl-code" data-dfn-for="ResponseInit" data-dfn-type="dict-member" data-export="" data-type="HeadersInit " id="dom-responseinit-headers">headers<a class="self-link" href="#dom-responseinit-headers"></a></dfn>;
};

<span class="kt">enum</span> <dfn class="nv idl-code" data-dfn-type="enum" data-export="" id="responsetype">ResponseType<a class="self-link" href="#responsetype"></a></dfn> { <dfn class="s idl-code" data-dfn-for="ResponseType" data-dfn-type="enum-value" data-export="" data-lt="&quot;basic&quot;|basic" id="dom-responsetype-basic">"basic"<a class="self-link" href="#dom-responsetype-basic"></a></dfn>, <dfn class="s idl-code" data-dfn-for="ResponseType" data-dfn-type="enum-value" data-export="" data-lt="&quot;cors&quot;|cors" id="dom-responsetype-cors">"cors"<a class="self-link" href="#dom-responsetype-cors"></a></dfn>, <dfn class="s idl-code" data-dfn-for="ResponseType" data-dfn-type="enum-value" data-export="" data-lt="&quot;default&quot;|default" id="dom-responsetype-default">"default"<a class="self-link" href="#dom-responsetype-default"></a></dfn>, <dfn class="s idl-code" data-dfn-for="ResponseType" data-dfn-type="enum-value" data-export="" data-lt="&quot;error&quot;|error" id="dom-responsetype-error">"error"<a class="self-link" href="#dom-responsetype-error"></a></dfn>, <dfn class="s idl-code" data-dfn-for="ResponseType" data-dfn-type="enum-value" data-export="" data-lt="&quot;opaque&quot;|opaque" id="dom-responsetype-opaque">"opaque"<a class="self-link" href="#dom-responsetype-opaque"></a></dfn>, <dfn class="s idl-code" data-dfn-for="ResponseType" data-dfn-type="enum-value" data-export="" data-lt="&quot;opaqueredirect&quot;|opaqueredirect" id="dom-responsetype-opaqueredirect">"opaqueredirect"<a class="self-link" href="#dom-responsetype-opaqueredirect"></a></dfn> };</pre>
   <p>A <code class="idl"><a data-link-type="idl" href="#response">Response</a></code> object has an associated <dfn data-dfn-for="Response" data-dfn-type="dfn" data-noexport="" id="concept-response-response">response<a class="self-link" href="#concept-response-response"></a></dfn> (a <a data-link-type="dfn" href="#concept-response">response</a>). </p>
   <p>A <code class="idl"><a data-link-type="idl" href="#response">Response</a></code> object also has an associated <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object which
is itself associated with <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
   <p>A <code class="idl"><a data-link-type="idl" href="#response">Response</a></code> object also has an associated <dfn data-dfn-for="Response" data-dfn-type="dfn" data-noexport="" id="concept-response-trailer-promise">trailer promise<a class="self-link" href="#concept-response-trailer-promise"></a></dfn> (a promise). <span class="note">Used
for the <code class="idl"><a data-link-type="idl" href="#dom-response-trailer">trailer</a></code> attribute.</span> </p>
   <p>A <code class="idl"><a data-link-type="idl" href="#response">Response</a></code> object’s <a data-link-type="dfn" href="#concept-body-body">body</a> is its <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-body">body</a>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Response" data-dfn-type="constructor" data-export="" id="dom-response"><code>Response(<var>body</var>, <var>init</var>)</code><a class="self-link" href="#dom-response"></a></dfn> constructor, when invoked, must run these steps: </p>
   <ol>
    <li>
     <p>If <var>init</var>’s <code>status</code> member is not in the range <code>200</code> to <code>599</code>, inclusive, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>RangeError</code>. </p>
    <li>
     <p>If <var>init</var>’s <code>statusText</code> member does not match the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc7230#section-3.1.2">reason-phrase</a> token production, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <li>
     <p>Let <var>r</var> be a new <code class="idl"><a data-link-type="idl" href="#response">Response</a></code> object, associated with a new <a data-link-type="dfn" href="#concept-response">response</a> and a new associated <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object whose <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is "<code>response</code>". </p>
    <li>
     <p>Set <var>r</var>’s <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-status">status</a> to <var>init</var>’s <code>status</code> member. </p>
    <li>
     <p>Set <var>r</var>’s <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-status-message">status message</a> to <var>init</var>’s <code>statusText</code> member. </p>
    <li>
     <p>If <var>init</var>’s <code>headers</code> member is present, run these
  substeps: </p>
     <ol>
      <li>
       <p>Empty <var>r</var>’s <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
      <li>
       <p><a data-link-type="dfn" href="#concept-headers-fill">Fill</a> <var>r</var>’s <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object with <var>init</var>’s <code>headers</code> member. Rethrow any exceptions. </p>
     </ol>
    <li>
     <p>If <var>body</var> is non-null, run these substeps: </p>
     <ol>
      <li>
       <p>If <var>init</var>’s <code>status</code> member is a <a data-link-type="dfn" href="#null-body-status">null body status</a>, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
       <p class="note no-backref" role="note"><code>101</code> is included in <a data-link-type="dfn" href="#null-body-status">null body status</a> due to its use elsewhere. It does not affect this step. </p>
      <li>
       <p>Let <var>Content-Type</var> be null. </p>
      <li>
       <p>Set <var>r</var>’s <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-body">body</a> and <var>Content-Type</var> to the result of <a data-link-type="dfn" href="#concept-bodyinit-extract">extracting</a> <var>body</var>. Rethrow any exceptions. </p>
      <li>
       <p>If <var>Content-Type</var> is non-null and <var>r</var>’s <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a> contains no <a data-link-type="dfn" href="#concept-header">header</a> <a data-link-type="dfn" href="#concept-header-name">named</a> `<code>Content-Type</code>`, <a data-link-type="dfn" href="#concept-header-list-append">append</a> `<code>Content-Type</code>`/<var>Content-Type</var> to <var>r</var>’s <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
     </ol>
    <li>
     <p>Set <var>r</var>’s <a data-link-type="dfn" href="#concept-body-mime-type">MIME type</a> to
 the result of <a data-link-type="dfn" href="#concept-header-extract-mime-type">extracting a MIME type</a> from <var>r</var>’s <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
    <li>
     <p>Set <var>r</var>’s <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-https-state">HTTPS state</a> to <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object">current settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#https-state">HTTPS state</a>. </p>
    <li>
     <p>Resolve <var>r</var>’s <a data-link-type="dfn" href="#concept-response-trailer-promise">trailer promise</a> with a new <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object whose <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is
 "<code>immutable</code>". </p>
    <li>
     <p>Return <var>r</var>. </p>
   </ol>
   <p>The static <dfn class="idl-code" data-dfn-for="Response" data-dfn-type="method" data-export="" id="dom-response-error"><code>error()</code><a class="self-link" href="#dom-response-error"></a></dfn> method, when invoked, must
return a new <code class="idl"><a data-link-type="idl" href="#response">Response</a></code> object, associated with a new <a data-link-type="dfn" href="#concept-network-error">network error</a> and a new associated <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object whose <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is "<code>immutable</code>". </p>
   <p>The static <dfn class="idl-code" data-dfn-for="Response" data-dfn-type="method" data-export="" id="dom-response-redirect"><code>redirect(<var>url</var>, <var>status</var>)</code><a class="self-link" href="#dom-response-redirect"></a></dfn> method, when invoked, must run these steps: </p>
   <ol>
    <li>
     <p>Let <var>parsedURL</var> be the result of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser">parsing</a> <var>url</var> with <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object">current settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url">API base URL</a>. </p>
    <li>
     <p>If <var>parsedURL</var> is failure, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <li>
     <p>If <var>status</var> is not a <a data-link-type="dfn" href="#redirect-status">redirect status</a>, then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>RangeError</code>. </p>
    <li>
     <p>Let <var>r</var> be a new <code class="idl"><a data-link-type="idl" href="#response">Response</a></code> object, associated with a new <a data-link-type="dfn" href="#concept-response">response</a> and a new associated <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object whose <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is "<code>immutable</code>". </p>
    <li>
     <p>Set <var>r</var>’s <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-status">status</a> to <var>status</var>. </p>
    <li>
     <p><a data-link-type="dfn" href="#concept-header-list-set">Set</a> `<code>Location</code>` to <var>parsedURL</var>, <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer">serialized</a> and <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8-encode">utf-8 encoded</a>, in <var>r</var>’s <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-header-list">header list</a>. </p>
    <li>
     <p>Return <var>r</var>. </p>
   </ol>
   <p>The <dfn class="idl-code" data-dfn-for="Response" data-dfn-type="attribute" data-export="" id="dom-response-type"><code>type</code><a class="self-link" href="#dom-response-type"></a></dfn> attribute’s getter must return <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-type">type</a>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Response" data-dfn-type="attribute" data-export="" id="dom-response-url"><code>url</code><a class="self-link" href="#dom-response-url"></a></dfn> attribute’s getter must return
the empty string if <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-url">url</a> is null and <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-url">url</a>, <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer">serialized</a> with the <i>exclude-fragment flag</i> set, otherwise. <a data-link-type="biblio" href="#biblio-url">[URL]</a> </p>
   <p>The <dfn class="idl-code" data-dfn-for="Response" data-dfn-type="attribute" data-export="" id="dom-response-redirected"><code>redirected</code><a class="self-link" href="#dom-response-redirected"></a></dfn> attribute’s getter must
return true if <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-url-list">url list</a> has more than one item, and false otherwise. </p>
   <p class="note" role="note">To filter out <a data-link-type="dfn" href="#concept-response">responses</a> that are the result of a
redirect, do this directly through the API, e.g., <code>fetch(url, { redirect:"error" })</code>.
This way a potentially unsafe <a data-link-type="dfn" href="#concept-response">response</a> cannot accidentally leak. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Response" data-dfn-type="attribute" data-export="" id="dom-response-status"><code>status</code><a class="self-link" href="#dom-response-status"></a></dfn> attribute’s getter must
return <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-status">status</a>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Response" data-dfn-type="attribute" data-export="" id="dom-response-ok"><code>ok</code><a class="self-link" href="#dom-response-ok"></a></dfn> attribute’s getter must
return true if <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-status">status</a> is an <a data-link-type="dfn" href="#ok-status">ok status</a>, and false otherwise. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Response" data-dfn-type="attribute" data-export="" id="dom-response-statustext"><code>statusText</code><a class="self-link" href="#dom-response-statustext"></a></dfn> attribute’s getter
must return <a data-link-type="dfn" href="#concept-response-response">response</a>’s <a data-link-type="dfn" href="#concept-response-status-message">status message</a>. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Response" data-dfn-type="attribute" data-export="" id="dom-response-headers"><code>headers</code><a class="self-link" href="#dom-response-headers"></a></dfn> attribute’s getter must
return the associated <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Response" data-dfn-type="attribute" data-export="" id="dom-response-body"><code>body</code><a class="self-link" href="#dom-response-body"></a></dfn> attribute’s getter must return null if
the associated <a data-link-type="dfn" href="#concept-body-body">body</a> is null and the associated <a data-link-type="dfn" href="#concept-body-body">body</a>’s <a data-link-type="dfn" href="#concept-body-stream">stream</a> otherwise. </p>
   <p>The <dfn class="idl-code" data-dfn-for="Response" data-dfn-type="attribute" data-export="" id="dom-response-trailer"><code>trailer</code><a class="self-link" href="#dom-response-trailer"></a></dfn> attribute’s getter must return the
associated <a data-link-type="dfn" href="#concept-response-trailer-promise">trailer promise</a>. </p>
   <hr>
   <p>The <dfn class="idl-code" data-dfn-for="Response" data-dfn-type="method" data-export="" id="dom-response-clone"><code>clone()</code><a class="self-link" href="#dom-response-clone"></a></dfn> method, when invoked, must
run these steps: </p>
   <ol>
    <li>
     <p>If <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object">context object</a> is <a data-link-type="dfn" href="#concept-body-disturbed">disturbed</a> or <a data-link-type="dfn" href="#concept-body-locked">locked</a>,
 then <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw">throw</a> a <code>TypeError</code>. </p>
    <li>
     <p>Let <var>clonedResponse</var> be a new <code class="idl"><a data-link-type="idl" href="#response">Response</a></code> object associated with the
 result of <a data-link-type="dfn" href="#concept-response-clone">cloning</a> <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object">context object</a>’s <a data-link-type="dfn" href="#concept-response-response">response</a> and a new associated <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object whose <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object">context object</a>’s <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object’s <a data-link-type="dfn" href="#concept-headers-guard">guard</a>. </p>
    <li>
     <p>Upon fulfillment of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object">context object</a>’s <a data-link-type="dfn" href="#concept-response-trailer-promise">trailer promise</a>, resolve <var>clonedResponse</var>’s <a data-link-type="dfn" href="#concept-response-trailer-promise">trailer promise</a> with a new <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object whose <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is
 "<code>immutable</code>" that is associated with <var>clonedResponse</var>’s <a data-link-type="dfn" href="#concept-response-trailer">trailer</a>. </p>
    <li>
     <p>Return <var>clonedResponse</var>. </p>
   </ol>
   <h3 class="heading settled" data-level="6.5" id="fetch-method"><span class="secno">6.5. </span><span class="content">Fetch method</span><a class="self-link" href="#fetch-method"></a></h3>
<pre class="idl highlight def"><span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/webappapis.html#windoworworkerglobalscope">WindowOrWorkerGlobalScope</a> {  [<a class="nv idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#NewObject">NewObject</a>] <span class="kt">Promise</span>&lt;<a class="n" data-link-type="idl-name" href="#response">Response</a>> <a class="nv idl-code" data-link-type="method" href="#dom-global-fetch">fetch</a>(<a class="n" data-link-type="idl-name" href="#requestinfo">RequestInfo</a> <dfn class="nv idl-code" data-dfn-for="WindowOrWorkerGlobalScope/fetch(input, init), WindowOrWorkerGlobalScope/fetch(input)" data-dfn-type="argument" data-export="" id="dom-windoworworkerglobalscope-fetch-input-init-input">input<a class="self-link" href="#dom-windoworworkerglobalscope-fetch-input-init-input"></a></dfn>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#requestinit">RequestInit</a> <dfn class="nv idl-code" data-dfn-for="WindowOrWorkerGlobalScope/fetch(input, init), WindowOrWorkerGlobalScope/fetch(input)" data-dfn-type="argument" data-export="" id="dom-windoworworkerglobalscope-fetch-input-init-init">init<a class="self-link" href="#dom-windoworworkerglobalscope-fetch-input-init-init"></a></dfn>);
};</pre>
   <p>The <dfn class="idl-code" data-dfn-for="WindowOrWorkerGlobalScope" data-dfn-type="method" data-export="" data-lt="fetch(input, init)|fetch(input)" id="dom-global-fetch"><code>fetch(<var>input</var>, <var>init</var>)</code><a class="self-link" href="#dom-global-fetch"></a></dfn> method, must run these steps: </p>
   <ol>
    <li>
     <p>Let <var>p</var> be a new promise. </p>
    <li>
     <p>Let <var>request</var> be the associated <a data-link-type="dfn" href="#concept-request">request</a> of the result of invoking the initial value of <code class="idl"><a data-link-type="idl" href="#request">Request</a></code> as constructor with <var>input</var> and <var>init</var> as arguments. If this throws an exception, reject <var>p</var> with it and return <var>p</var>. </p>
    <li>
     <p>Let <var>responseObject</var> be a new <code class="idl"><a data-link-type="idl" href="#response">Response</a></code> object and a new associated <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object whose <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is
 "<code>immutable</code>". </p>
    <li>
     <p>Run the following <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a>: </p>
     <p><a data-link-type="dfn" href="#concept-fetch">Fetch</a> <var>request</var>. </p>
     <p>To <a data-link-type="dfn" href="#process-response">process response</a> for <var>response</var>, run these substeps: </p>
     <ol>
      <li>
       <p>If <var>response</var>’s <a data-link-type="dfn" href="#concept-response-type">type</a> is
   "<code>error</code>", reject <var>p</var> with a <code>TypeError</code> and terminate
   these substeps. </p>
      <li>
       <p>Associate <var>responseObject</var> with <var>response</var>. </p>
      <li>
       <p>Resolve <var>p</var> with <var>responseObject</var>. </p>
     </ol>
     <p>To <a data-link-type="dfn" href="#process-response-done">process response done</a> for <var>response</var>, run these substeps: </p>
     <ol>
      <li>
       <p>Let <var>trailerObject</var> be a new <code class="idl"><a data-link-type="idl" href="#headers">Headers</a></code> object whose <a data-link-type="dfn" href="#concept-headers-guard">guard</a> is "<code>immutable</code>". </p>
      <li>
       <p>Associate <var>trailerObject</var> with <var>response</var>’s <a data-link-type="dfn" href="#concept-response-trailer">trailer</a>. </p>
      <li>
       <p>Resolve <var>responseObject</var>’s <a data-link-type="dfn" href="#concept-response-trailer-promise">trailer promise</a> with <var>trailerObject</var>. </p>
     </ol>
    <li>
     <p>Return <var>p</var>. </p>
   </ol>
   <h3 class="heading settled" data-level="6.6" id="garbage-collection"><span class="secno">6.6. </span><span class="content">Garbage collection</span><a class="self-link" href="#garbage-collection"></a></h3>
   <p>The user agent may <a data-link-type="dfn" href="#concept-fetch-terminate">terminate</a> an ongoing fetch with
reason <i>garbage collection</i> if that termination is not observable through script. </p>
   <p class="note no-backref" role="note">"Observable through script" means observable through <a data-link-type="functionish" href="#dom-global-fetch"><code>fetch()</code></a>’s arguments and return value. Other ways, such as
communicating with the server through a side-channel are not included. </p>
   <p class="note no-backref" role="note">The server being able to observe garbage collection has precedent, e.g.,
with <code>WebSocket</code> and <code>XMLHttpRequest</code> objects. </p>
   <div class="example no-backref" id="terminate-examples">
    <a class="self-link" href="#terminate-examples"></a> 
    <p>The user agent can terminate the fetch because the termination cannot be observed. </p>
<pre>fetch("https://www.example.com/")</pre>
    <p>The user agent cannot terminate the fetch because the termination can be observed through
 the promise. </p>
<pre>window.promise = fetch("https://www.example.com/")</pre>
    <p>The user agent can terminate the fetch because the associated body is not observable. </p>
<pre>window.promise = fetch("https://www.example.com/").then(res => res.headers)</pre>
    <p>The user agent can terminate the fetch because the termination cannot be observed. </p>
<pre>fetch("https://www.example.com/").then(res => res.body.getReader().closed)</pre>
    <p>The user agent cannot terminate the fetch because one can observe the termination by registering
 a handler for the promise object. </p>
<pre>window.promise = fetch("https://www.example.com/")
  .then(res => res.body.getReader().closed)</pre>
    <p>The user agent cannot terminate the fetch as termination would be observable via the registered
 handler. </p>
<pre>fetch("https://www.example.com/")
  .then(res => {
    res.body.getReader().closed.then(() => console.log("stream closed!"))
  })</pre>
   </div>
   <h2 class="heading settled" data-level="7" id="websocket-protocol"><span class="secno">7. </span><span class="content">WebSocket protocol alterations</span><a class="self-link" href="#websocket-protocol"></a></h2>
   <div class="note" role="note">
    <p>This section replaces part of the WebSocket protocol opening handshake client requirement to
 integrate it with algorithms defined in Fetch. This way CSP, cookies, HSTS, and other Fetch-related
 protocols are handled in a single location. Ideally the RFC would be updated with this language,
 but it is never that easy. The WebSocket API, defined in the HTML Standard, has been updated to use
 this language. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a> <a data-link-type="biblio" href="#biblio-html">[HTML]</a> </p>
    <p>The way this works is by replacing The WebSocket Protocol’s "establish a WebSocket connection"
 algorithm with a new one that integrates with Fetch. "Establish a WebSocket connection" consists of
 three algorithms: setting up a connection, creating and transmiting a handshake request, and
 validating the handshake response. That layering is different from Fetch, which first creates a
 handshake, then sets up a connection and transmits the handshake, and finally validates the
 response. Keep that in mind while reading these alterations. </p>
   </div>
   <h3 class="heading settled" data-level="7.1" id="websocket-connections"><span class="secno">7.1. </span><span class="content">Connections</span><a class="self-link" href="#websocket-connections"></a></h3>
   <p>To <dfn data-dfn-type="dfn" data-noexport="" id="concept-websocket-connection-obtain">obtain a WebSocket connection<a class="self-link" href="#concept-websocket-connection-obtain"></a></dfn>, given a <var>url</var>, run these steps: </p>
   <ol>
    <li>
     <p>Let <var>host</var> be <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host">host</a>. </p>
    <li>
     <p>Let <var>port</var> be <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-port">port</a>. </p>
    <li>
     <p>Let <var>secure</var> be false, if <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> is "<code>http</code>", and true otherwise. </p>
    <li>
     <p>Follow the requirements stated in step 2 to 5, inclusive, of the first set of steps in <a href="http://tools.ietf.org/html/rfc6455#section-4.1">section 4.1</a> of The WebSocket Protocol
 to establish a <a data-link-type="dfn" href="#concept-websocket-connection-obtain">WebSocket connection</a>. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a> </p>
    <li>
     <p>If that established a connection, return it, and return failure otherwise. </p>
   </ol>
   <p class="note" role="note">Although structured a little differently, carrying different properties, and
therefore not shareable, a WebSocket connection is very close to identical to an "ordinary" <a data-link-type="dfn" href="#concept-connection">connection</a>. </p>
   <h3 class="heading settled" data-level="7.2" id="websocket-opening-handshake"><span class="secno">7.2. </span><span class="content">Opening handshake</span><a class="self-link" href="#websocket-opening-handshake"></a></h3>
   <p>To <dfn data-dfn-for="websocket" data-dfn-type="dfn" data-noexport="" id="concept-websocket-establish">establish a WebSocket connection<a class="self-link" href="#concept-websocket-establish"></a></dfn>, given a <var>url</var>, <var>protocols</var>, and <var>client</var>, run these steps: </p>
   <ol>
    <li>
     <p>Let <var>requestURL</var> be a copy of <var>url</var>, with its <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> set to
  "<code>http</code>", if <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> is "<code>ws</code>", and
  to "<code>https</code>" otherwise. </p>
     <p class="note no-backref" role="note">This change of scheme is essential to integrate well with <a data-link-type="dfn" href="#concept-fetch">fetching</a>. E.g., HSTS would not work without it. There is no real
  reason for WebSocket to have distinct schemes, it’s a legacy artefact. <a data-link-type="biblio" href="#biblio-hsts">[HSTS]</a> </p>
    <li>
     <p>Let <var>request</var> be a new <a data-link-type="dfn" href="#concept-request">request</a>, whose <a data-link-type="dfn" href="#concept-request-url">url</a> is <var>requestURL</var>, <a data-link-type="dfn" href="#concept-request-client">client</a> is <var>client</var>, <a data-link-type="dfn" href="#skip-service-worker-flag">skip-service-worker flag</a> is set, <a data-link-type="dfn" href="#synchronous-flag">synchronous flag</a> is set, <a data-link-type="dfn" href="#concept-request-mode">mode</a> is "<code>websocket</code>", <a data-link-type="dfn" href="#concept-request-credentials-mode">credentials mode</a> is
 "<code>include</code>", <a data-link-type="dfn" href="#concept-request-cache-mode">cache mode</a> is "<code>no-store</code>", and <a data-link-type="dfn" href="#concept-request-redirect-mode">redirect mode</a> is "<code>error</code>". </p>
    <li>
     <p><a data-link-type="dfn" href="#concept-header-list-append">Append</a> `<code>Upgrade</code>`/`<code>websocket</code>` to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
    <li>
     <p><a data-link-type="dfn" href="#concept-header-list-append">Append</a> `<code>Connection</code>`/`<code>Upgrade</code>` to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
    <li>
     <p>Let <var>keyValue</var> be a nonce consisting of a randomly selected 16-byte value that has
  been base64-encoded (see <a href="https://tools.ietf.org/html/rfc4648#section-4">section 4</a> of <a data-link-type="biblio" href="#biblio-rfc4648">[RFC4648]</a>). </p>
     <p class="example" id="example-random-value"><a class="self-link" href="#example-random-value"></a>If the randomly selected value was the byte sequence 0x01 0x02 0x03 0x04 0x05
  0x06 0x07 0x08 0x09 0x0a 0x0b 0x0c 0x0d 0x0e 0x0f 0x10, <var>keyValue</var> would be
  `<code>AQIDBAUGBwgJCgsMDQ4PEC==</code>`. </p>
    <li>
     <p><a data-link-type="dfn" href="#concept-header-list-append">Append</a> `<code>Sec-WebSocket-Key</code>`/<var>keyValue</var> to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
    <li>
     <p><a data-link-type="dfn" href="#concept-header-list-append">Append</a> `<code>Sec-WebSocket-Version</code>`/`<code>13</code>` to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
    <li>
     <p>For each <var>protocol</var> in <var>protocols</var>, <a data-link-type="dfn" href="#concept-header-list-combine">combine</a> `<code>Sec-WebSocket-Protocol</code>`/<var>protocol</var> in <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
    <li>
     <p>Let <var>permessageDeflate</var> be a user-agent defined
  "<code>permessage-deflate</code>" extension <a data-link-type="dfn" href="#concept-header">header</a> <a data-link-type="dfn" href="#concept-header-value">value</a>. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a> </p>
     <p class="example" id="example-permessage-deflate"><a class="self-link" href="#example-permessage-deflate"></a>`<code>permessage-deflate; client_max_window_bits</code>` </p>
    <li>
     <p><a data-link-type="dfn" href="#concept-header-list-append">Append</a> `<code>Sec-WebSocket-Extensions</code>`/<var>permessageDeflate</var> to <var>request</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a>. </p>
    <li>
     <p>Let <var>response</var> be the result of <a data-link-type="dfn" href="#concept-fetch">fetching</a> <var>request</var>. </p>
    <li>
     <p>If <var>response</var> is a <a data-link-type="dfn" href="#concept-network-error">network error</a> or its <a data-link-type="dfn" href="#concept-response-status">status</a> is not <code>101</code>, <a data-link-type="dfn" href="#fail-the-websocket-connection">fail the WebSocket connection</a>. </p>
    <li>
     <p>If <var>protocols</var> is not the empty list and <a data-link-type="dfn" href="#concept-header-parse">parsing</a> `<code>Sec-WebSocket-Protocol</code>` in <var>response</var>’s <a data-link-type="dfn" href="#concept-request-header-list">header list</a> results in null, failure, or the empty
  byte sequence, <a data-link-type="dfn" href="#fail-the-websocket-connection">fail the WebSocket connection</a>. </p>
     <p class="note" role="note">This is different from the check on this header defined by The WebSocket Protocol.
  That only covers a subprotocol not requested by the client. This covers a subprotocol requested by
  the client, but not acknowledged by the server. </p>
    <li>
     <p>Follow the requirements stated step 2 to step 6, inclusive, of the last set of steps in <a href="http://tools.ietf.org/html/rfc6455#section-4.1">section 4.1</a> of The WebSocket Protocol
 to validate <var>response</var>. This either results in <a data-link-type="dfn" href="#fail-the-websocket-connection">fail the WebSocket connection</a> or <a data-link-type="dfn" href="#the-websocket-connection-is-established">the WebSocket connection is established</a>. </p>
   </ol>
   <p><dfn data-dfn-type="dfn" data-noexport="" id="fail-the-websocket-connection">Fail the WebSocket connection<a class="self-link" href="#fail-the-websocket-connection"></a></dfn> and <dfn data-dfn-type="dfn" data-noexport="" id="the-websocket-connection-is-established">the WebSocket connection is established<a class="self-link" href="#the-websocket-connection-is-established"></a></dfn> are defined by The WebSocket Protocol. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a> </p>
   <p class="warning">The reason redirects are not followed, HTTP authentication will not function, and
this handshake is generally restricted is because that could introduce serious security problems in
a web browser context. For example, consider a host with a WebSocket server at one path and an open
HTTP redirector at another. Suddenly, any script that can be given a particular WebSocket URL can be
tricked into communicating to (and potentially sharing secrets with) any host on the internet, even
if the script checks that the URL has the right hostname. </p>
   <h2 class="no-num heading settled" id="background-reading"><span class="content">Background reading</span><a class="self-link" href="#background-reading"></a></h2>
   <p><em>This section and its subsections are informative only.</em> </p>
   <h3 class="no-num heading settled" data-dfn-type="dfn" data-noexport="" id="http-header-layer-division"><span class="content">HTTP header layer division</span><a class="self-link" href="#http-header-layer-division"></a></h3>
   <p>For the purposes of fetching, there is an API layer (HTML’s <code>img</code>, CSS' <code>background-image</code>), early fetch layer,
service worker layer, and network &amp; cache layer.
`<code>Accept</code>` and
`<code>Accept-Language</code>` are set in the early fetch layer
(typically by the user agent). Most other headers controlled by the user agent, such as
`<code>Accept-Encoding</code>`,
`<code>Host</code>`, and `<code>Referer</code>`, are
set in the network &amp; cache layer. Developers can set headers either at the API layer
or in the service worker layer (typically through a <a data-link-type="dfn" href="#concept-request"><code>Request</code></a> object).
Developers have almost no control over <a data-link-type="dfn" href="#forbidden-header-name">forbidden headers</a>, but can control
`<code>Accept</code>` and have the means to constrain and omit
`<code>Referer</code>` for instance. </p>
   <h3 class="no-num heading settled" data-dfn-type="dfn" data-noexport="" id="atomic-http-redirect-handling"><span class="content">Atomic HTTP redirect handling</span><a class="self-link" href="#atomic-http-redirect-handling"></a></h3>
   <p>Redirects (a <a data-link-type="dfn" href="#concept-response">response</a> whose <a data-link-type="dfn" href="#concept-response-status">status</a> or <a data-link-type="dfn" href="#concept-internal-response">internal response</a>’s (if any) <a data-link-type="dfn" href="#concept-response-status">status</a> is a <a data-link-type="dfn" href="#redirect-status">redirect status</a>) are not exposed
to APIs. Exposing redirects might leak information not otherwise available through a cross-site
scripting attack. </p>
   <p class="example" id="example-xss-redirect"><a class="self-link" href="#example-xss-redirect"></a>A fetch to <code>https://example.org/auth</code> that includes a <code>Cookie</code> marked <code>HttpOnly</code> could result in a redirect to <code>https://other-origin.invalid/4af955781ea1c84a3b11</code>. This new URL contains a
secret. If we expose redirects that secret would be available through a cross-site
scripting attack. </p>
   <h3 class="no-num heading settled" id="basic-safe-cors-protocol-setup"><span class="content">Basic safe CORS protocol setup</span><a class="self-link" href="#basic-safe-cors-protocol-setup"></a></h3>
   <p>For resources where data is protected through IP authentication or a firewall
(unfortunately relatively common still), using the <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a> is <strong>unsafe</strong>. (This is the reason why the <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a> had to be
invented.) </p>
   <p>However, otherwise using the following <a data-link-type="dfn" href="#concept-header">header</a> is <strong>safe</strong>: </p>
<pre>Access-Control-Allow-Origin: *</pre>
   <p>Even if a resource exposes additional information based on cookie or HTTP
authentication, using the above <a data-link-type="dfn" href="#concept-header">header</a> will not reveal
it. It will share the resource with APIs such as <code class="idl"><a data-link-type="idl" href="https://xhr.spec.whatwg.org/#xmlhttprequest">XMLHttpRequest</a></code>, much like it is already shared with <code>curl</code> and <code>wget</code>. </p>
   <p>Thus in other words, if a resource cannot be accessed from a random device connected to
the web using <code>curl</code> and <code>wget</code> the aforementioned <a data-link-type="dfn" href="#concept-header">header</a> is not to be included. If it can be accessed
however, it is perfectly fine to do so. </p>
   <h3 class="no-num heading settled" id="cors-protocol-and-http-caches"><span class="content">CORS protocol and HTTP caches</span><a class="self-link" href="#cors-protocol-and-http-caches"></a></h3>
   <p>If <a data-link-type="dfn" href="#cors-protocol">CORS protocol</a> requirements are more complicated than setting
`<a data-link-type="dfn" href="#http-access-control-allow-origin"><code>Access-Control-Allow-Origin</code></a>` to <code>*</code> or a static <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin">origin</a>,
`<code>Vary</code>` is to be used. <a data-link-type="biblio" href="#biblio-html">[HTML]</a> <a data-link-type="biblio" href="#biblio-http">[HTTP]</a> <a data-link-type="biblio" href="#biblio-http-semantics">[HTTP-SEMANTICS]</a> <a data-link-type="biblio" href="#biblio-http-cond">[HTTP-COND]</a> <a data-link-type="biblio" href="#biblio-http-caching">[HTTP-CACHING]</a> <a data-link-type="biblio" href="#biblio-http-auth">[HTTP-AUTH]</a> </p>
<pre class="example" id="example-vary-origin"><a class="self-link" href="#example-vary-origin"></a>Vary: Origin</pre>
   <div data-fill-with="references">
    <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
    <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
    <dl>
     <dt id="biblio-abnf">[ABNF]
     <dd>D. Crocker, Ed.; P. Overell. <a href="https://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>. January 2008. Internet Standard. URL: <a href="https://tools.ietf.org/html/rfc5234">https://tools.ietf.org/html/rfc5234</a>
     <dt id="biblio-client-hints">[CLIENT-HINTS]
     <dd>Ilya Grigorik. <a href="https://tools.ietf.org/html/draft-ietf-httpbis-client-hints">HTTP Client Hints</a>. URL: <a href="https://tools.ietf.org/html/draft-ietf-httpbis-client-hints">https://tools.ietf.org/html/draft-ietf-httpbis-client-hints</a>
     <dt id="biblio-cookies">[COOKIES]
     <dd>A. Barth. <a href="https://tools.ietf.org/html/rfc6265">HTTP State Management Mechanism</a>. April 2011. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc6265">https://tools.ietf.org/html/rfc6265</a>
     <dt id="biblio-csp">[CSP]
     <dd>Mike West. <a href="https://w3c.github.io/webappsec-csp/">Content Security Policy Level 3</a>. URL: <a href="https://w3c.github.io/webappsec-csp/">https://w3c.github.io/webappsec-csp/</a>
     <dt id="biblio-dataurl">[DATAURL]
     <dd>Simon Sapin. <a href="https://simonsapin.github.io/data-urls/">The data URL scheme</a>. URL: <a href="https://simonsapin.github.io/data-urls/">https://simonsapin.github.io/data-urls/</a>
     <dt id="biblio-encoding">[ENCODING]
     <dd>Anne van Kesteren. <a href="https://encoding.spec.whatwg.org/">Encoding Standard</a>. Living Standard. URL: <a href="https://encoding.spec.whatwg.org/">https://encoding.spec.whatwg.org/</a>
     <dt id="biblio-fileapi">[FileAPI]
     <dd>Arun Ranganathan; Jonas Sicking. <a href="https://w3c.github.io/FileAPI/">File API</a>. URL: <a href="https://w3c.github.io/FileAPI/">https://w3c.github.io/FileAPI/</a>
     <dt id="biblio-hsts">[HSTS]
     <dd>J. Hodges; C. Jackson; A. Barth. <a href="https://tools.ietf.org/html/rfc6797">HTTP Strict Transport Security (HSTS)</a>. November 2012. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc6797">https://tools.ietf.org/html/rfc6797</a>
     <dt id="biblio-html">[HTML]
     <dd>Ian Hickson. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
     <dt id="biblio-http">[HTTP]
     <dd>R. Fielding, Ed.; J. Reschke, Ed.. <a href="https://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>. June 2014. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7230">https://tools.ietf.org/html/rfc7230</a>
     <dt id="biblio-http-auth">[HTTP-AUTH]
     <dd>R. Fielding, Ed.; J. Reschke, Ed.. <a href="https://tools.ietf.org/html/rfc7235">Hypertext Transfer Protocol (HTTP/1.1): Authentication</a>. June 2014. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7235">https://tools.ietf.org/html/rfc7235</a>
     <dt id="biblio-http-caching">[HTTP-CACHING]
     <dd>R. Fielding, Ed.; M. Nottingham, Ed.; J. Reschke, Ed.. <a href="https://tools.ietf.org/html/rfc7234">Hypertext Transfer Protocol (HTTP/1.1): Caching</a>. June 2014. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7234">https://tools.ietf.org/html/rfc7234</a>
     <dt id="biblio-http-cond">[HTTP-COND]
     <dd>R. Fielding, Ed.; J. Reschke, Ed.. <a href="https://tools.ietf.org/html/rfc7232">Hypertext Transfer Protocol (HTTP/1.1): Conditional Requests</a>. June 2014. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7232">https://tools.ietf.org/html/rfc7232</a>
     <dt id="biblio-http-semantics">[HTTP-SEMANTICS]
     <dd>R. Fielding, Ed.; J. Reschke, Ed.. <a href="https://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>. June 2014. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7231">https://tools.ietf.org/html/rfc7231</a>
     <dt id="biblio-mix">[MIX]
     <dd>Mike West. <a href="https://w3c.github.io/webappsec-mixed-content/">Mixed Content</a>. URL: <a href="https://w3c.github.io/webappsec-mixed-content/">https://w3c.github.io/webappsec-mixed-content/</a>
     <dt id="biblio-referrer">[REFERRER]
     <dd>Jochen Eisinger; Mike West. <a href="https://w3c.github.io/webappsec-referrer-policy/">Referrer Policy</a>. URL: <a href="https://w3c.github.io/webappsec-referrer-policy/">https://w3c.github.io/webappsec-referrer-policy/</a>
     <dt id="biblio-rfc2119">[RFC2119]
     <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
     <dt id="biblio-rfc4648">[RFC4648]
     <dd>S. Josefsson. <a href="https://tools.ietf.org/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>. October 2006. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc4648">https://tools.ietf.org/html/rfc4648</a>
     <dt id="biblio-rfc7578">[RFC7578]
     <dd>L. Masinter. <a href="https://tools.ietf.org/html/rfc7578">Returning Values from Forms: multipart/form-data</a>. July 2015. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7578">https://tools.ietf.org/html/rfc7578</a>
     <dt id="biblio-sri">[SRI]
     <dd>Devdatta Akhawe; et al. <a href="https://w3c.github.io/webappsec-subresource-integrity/">Subresource Integrity</a>. URL: <a href="https://w3c.github.io/webappsec-subresource-integrity/">https://w3c.github.io/webappsec-subresource-integrity/</a>
     <dt id="biblio-streams">[STREAMS]
     <dd>Domenic Denicola. <a href="https://streams.spec.whatwg.org/">Streams Standard</a>. Living Standard. URL: <a href="https://streams.spec.whatwg.org/">https://streams.spec.whatwg.org/</a>
     <dt id="biblio-sw">[SW]
     <dd>Alex Russell; et al. <a href="https://w3c.github.io/ServiceWorker/v1/">Service Workers 1</a>. URL: <a href="https://w3c.github.io/ServiceWorker/v1/">https://w3c.github.io/ServiceWorker/v1/</a>
     <dt id="biblio-tls">[TLS]
     <dd>T. Dierks; E. Rescorla. <a href="https://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>. August 2008. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc5246">https://tools.ietf.org/html/rfc5246</a>
     <dt id="biblio-upgrade">[UPGRADE]
     <dd>Mike West. <a href="https://w3c.github.io/webappsec-upgrade-insecure-requests/">Upgrade Insecure Requests</a>. URL: <a href="https://w3c.github.io/webappsec-upgrade-insecure-requests/">https://w3c.github.io/webappsec-upgrade-insecure-requests/</a>
     <dt id="biblio-url">[URL]
     <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/">URL Standard</a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
     <dt id="biblio-webidl">[WEBIDL]
     <dd>Cameron McCormack; Boris Zbarsky; Tobie Langel. <a href="https://heycam.github.io/webidl/">Web IDL</a>. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
     <dt id="biblio-whatwg-dom">[WHATWG-DOM]
     <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
     <dt id="biblio-wsp">[WSP]
     <dd>C. Holmberg, S. Hakansson, G. Eriksson. <a href="https://tools.ietf.org/id/draft-ietf-hybi-thewebsocketprotocol-09.txt"><cite>The WebSocket protocol.</cite></a> URL: <a href="https://tools.ietf.org/id/draft-ietf-hybi-thewebsocketprotocol-09.txt">https://tools.ietf.org/id/draft-ietf-hybi-thewebsocketprotocol-09.txt</a> 
     <dt id="biblio-xhr">[XHR]
     <dd>Anne van Kesteren. <a href="https://xhr.spec.whatwg.org/">XMLHttpRequest Standard</a>. Living Standard. URL: <a href="https://xhr.spec.whatwg.org/">https://xhr.spec.whatwg.org/</a>
    </dl>
    <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
    <dl>
     <dt id="biblio-cors">[CORS]
     <dd>Anne van Kesteren. <a href="https://www.w3.org/TR/cors/">Cross-Origin Resource Sharing</a>. 16 January 2014. REC. URL: <a href="https://www.w3.org/TR/cors/">https://www.w3.org/TR/cors/</a>
     <dt id="biblio-httpverbsec1">[HTTPVERBSEC1]
     <dd><a href="https://www.kb.cert.org/vuls/id/867593">Multiple vendors' web servers enable HTTP TRACE method by default.</a>. URL: <a href="https://www.kb.cert.org/vuls/id/867593">https://www.kb.cert.org/vuls/id/867593</a>
     <dt id="biblio-httpverbsec2">[HTTPVERBSEC2]
     <dd><a href="https://www.kb.cert.org/vuls/id/288308">Microsoft Internet Information Server (IIS) vulnerable to cross-site scripting via HTTP TRACK method.</a>. URL: <a href="https://www.kb.cert.org/vuls/id/288308">https://www.kb.cert.org/vuls/id/288308</a>
     <dt id="biblio-httpverbsec3">[HTTPVERBSEC3]
     <dd><a href="https://www.kb.cert.org/vuls/id/150227">HTTP proxy default configurations allow arbitrary TCP connections.</a>. URL: <a href="https://www.kb.cert.org/vuls/id/150227">https://www.kb.cert.org/vuls/id/150227</a>
     <dt id="biblio-origin">[ORIGIN]
     <dd>A. Barth. <a href="https://tools.ietf.org/html/rfc6454">The Web Origin Concept</a>. December 2011. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc6454">https://tools.ietf.org/html/rfc6454</a>
    </dl>
   </div>
   <h2 class="no-num heading settled" id="acknowledgments"><span class="content">Acknowledgments</span><a class="self-link" href="#acknowledgments"></a></h2>
   <p>Thanks to
Adam Barth,
Adam Lavin,
Alexey Proskuryakov,
Andrew Sutherland,
Ángel González,
Anssi Kostiainen,
Arkadiusz Michalski,
Arne Johannessen,
Arthur Barstow,
Axel Rauschmayer,
Ben Kelly,
Benjamin Hawkes-Lewis,
Bert Bos,
Björn Höhrmann,
Boris Zbarsky,
Brad Hill,
Brad Porter,
Bryan Smith,
Caitlin Potter,
Cameron McCormack,
Clement Pellerin,
Collin Jackson,
Daniel Robertson,
Daniel Veditz,
David Håsäther,
David Orchard,
Dean Jackson,
Domenic Denicola,
Dominique Hazaël-Massieux,
Doug Turner,
Eero Häkkinen,
Ehsan Akhgari,
Emily Stark,
Eric Lawrence,
François Marier,
Frank Ellerman,
Frederick Hirsch,
Gavin Carothers,
Glenn Maynard,
Graham Klyne,
Hal Lockhart,
Hallvord R. M. Steen,
Henri Sivonen,
Hiroshige Hayashizaki,
Honza Bambas,
Ian Hickson,
Ilya Grigorik,
Jake Archibald,
James Graham,
Janusz Majnert,
Jeena Lee,
Jeff Carpenter,
Jeff Hodges,
Jeffrey Yasskin,
Jesse M. Heines,
Jochen Eisinger,
Jonas Sicking,
Jonathan Kingston,
Jonathan Watt,
최종찬 (Jongchan Choi),
Jörn Zaefferer,
Josh Matthews,
Julian Krispel-Samsel,
Julian Reschke,
송정기 (Jungkee Song),
Jussi Kalliokoski,
Jxck,
Keith Yeung,
Kenji Baheux,
Lachlan Hunt,
Liam Brummitt,
Louis Ryan,
Lucas Gonze,
呂康豪 (Kang-Hao Lu),
Maciej Stachowiak,
Malisa,
Manfred Stock,
Manish Goregaokar,
Marc Silbey,
Marcos Caceres,
Marijn Kruisselbrink,
Mark Nottingham,
Mark S. Miller,
Martin Dürst,
Matt Andrews,
Matt Falkenhagen,
Matt Oshry,
Matt Womer,
Mhano Harkness,
Michael Kohler,
Michael™ Smith,
Mike West,
Mohamed Zergaoui,
Ms2ger,
Nico Schlömer,
Nikhil Marathe,
Nikki Bee,
Nikunj Mehta,
Odin Hørthe Omdal,
Ondřej Žára,
Philip Jägenstedt,
R. Auburn,
Ryan Sleevi,
Rory Hewitt,
Sébastien Cevey,
Sendil Kumar N,
Shao-xuan Kang,
Sharath Udupa,
Shivakumar Jagalur Matt,
Simon Pieters,
Srirama Chandra Sekhar Mogali,
Steven Salat,
Sunava Dutta,
Surya Ismail,
吉野剛史 (Takeshi Yoshino),
Thomas Roessler,
Thomas Wisniewski,
Tobie Langel,
Tom Schuster,
Tomás Aparicio,
保呂毅 (Tsuyoshi Horo),
Tyler Close,
Vignesh Shanmugam,
Vladimir Dzhuvinov,
Wayne Carr,
Xabier Rodríguez,
Yoav Weiss,
Youenn Fablet,
平野裕 (Yutaka Hirano), and
Zhenbin Xu
for being awesome. </p>
   <p>This standard is written by <a href="https://annevankesteren.nl/" lang="nl">Anne van Kesteren</a> (<a href="https://www.mozilla.org/">Mozilla</a>, <a href="mailto:annevk@annevk.nl">annevk@annevk.nl</a>). </p>
   <p>Per <a href="https://creativecommons.org/publicdomain/zero/1.0/" rel="license">CC0</a>, to
the extent possible under law, the editor has waived all copyright and related or
neighboring rights to this work. </p>
  </main>